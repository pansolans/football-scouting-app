"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5652],{2019:(e,t,s)=>{s.d(t,{F:()=>i});var a=s(86190);let n={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,a.U)(n[e])}},9447:(e,t,s)=>{s.d(t,{z:()=>m});var a=s(42977),n=s(54568),i=s(90510),l=s(64786),r=s(90119),o=s(32987),d=s(53600);function c(){let e=(0,a._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return c=function(){return e},e}let u=i.J.div(c());function m(e){let{children:t,className:s,contentClassName:a,sticky:i,fixed:c,mdTitle:m,large:f,narrow:x}=e,{isMobile:h,isExpanded:g}=(0,d.V)(),p=(0,r.V)(l.E_),v=!t&&!m,j=f&&!p;return(0,n.jsxs)("header",{className:(0,o.A)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",c&&"fixed top-0 z-header",p?l.X_:"h-12",p&&[!g&&"pl-[133px]",!v&&l.zo],j&&["mx-auto md:h-24 md:items-end",x?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,children:[!p&&(i||c)&&(0,n.jsx)(u,{}),(0,n.jsx)("div",{className:(0,o.A)("flex w-full items-center justify-between gap-4",p?"pt-0.5":"",p&&!g?"pl-3":"pl-11 lg:pl-8",p&&!(h&&g)&&"draggable",a,j?"px-4 md:pl-8":"pr-3"),children:m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:(0,o.A)("text-text-200 flex items-center gap-2 text-center max-md:hidden min-w-0",p?"font-medium leading-tight tracking-tight":"font-heading",!p&&(j?"text-2xl":"text-lg")),children:(0,n.jsx)("span",{className:"truncate",children:m})}),(0,n.jsx)("div",{}),t]}):t})]})}},11062:(e,t,s)=>{s.d(t,{bl:()=>n});var a=s(16253);async function n(e,t,s,n){let i=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=atob(e),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let l=a._F[t]||"png";return new File([i],"".concat(s,".").concat(l),{type:t})}(e,t,s),i=new FormData;return i.append("file",n),i}(e,t),l=await n("/api/".concat(s,"/upload"),{method:"POST",body:i});if(l.ok)return[await l.json()];throw Error("Failed to upload image: ".concat(l.status," ").concat(l.statusText))}},11480:(e,t,s)=>{s.d(t,{D8:()=>c,DT:()=>m,Ih:()=>r,h4:()=>o,i1:()=>f});var a=s(54568),n=s(32987),i=s(37463),l=s(7620);let r=(e,t)=>!(!["thinking","tool_use","tool_result"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","dolphin","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),o=e=>"tool_result"!==e.type,d=l.createContext({}),c=()=>(0,l.useContext)(d),u=e=>{let[t,s]=(0,l.useState)(void 0),n=(0,l.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:s}),[t,s]);return(0,a.jsx)(d.Provider,{value:n,children:e.children})},m=e=>{let{children:t,isFirstBlockOfMessage:s,isLastBlockOfMessage:l,isStreaming:r}=e;return(0,a.jsx)(i.P.div,{initial:{opacity:+!r},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,n.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",s?"mt-2":"mt-3",l?"mb-2":"mb-3"),children:(0,a.jsx)(u,{children:t})})},f=e=>{let{icon:t,isExpanded:s,isFirstItem:i,isLastItem:l,isActive:r,children:o}=e,d={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,a.jsxs)("div",{className:(0,n.A)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":s},{"hover:bg-always-black hover:bg-opacity-[0.03]":!s}),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,a.jsx)("div",{className:(0,n.A)("transition-all w-[1px]",{"bg-border-300":!i}),style:d}),(0,a.jsx)("div",{className:(0,n.A)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[$16px]":!!t}),children:null!=t?t:(0,a.jsx)("div",{className:(0,n.A)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,a.jsx)("div",{className:(0,n.A)("transition-all grow w-[1px]",{"bg-border-300":!l}),style:d})]}),(0,a.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},13271:(e,t,s)=>{s.d(t,{g:()=>tR,v:()=>tI});var a=s(42977),n=s(54568),i=s(7726),l=s(57931),r=s(97527),o=s(66442),d=s(8974),c=s(57067),u=s(77187),m=s(85644),f=s(45483),x=s(96784),h=s(1761),g=s(2341),p=s(55554),v=s(90510),j=s(22529),b=s(61547),y=s(29242),w=s(54890),_=s(27062),k=s(85544),N=s(21036),M=s(32987),C=s(37463),A=s(70272),S=s.n(A),E=s(68864),z=s(64155),I=s(27261),R=s.n(I),T=s(62942),U=s(7620),L=s(46760),F=s(62971),O=s(75006),D=s(81527),P=s(56147),B=s(80731),W=s(92537),G=s(97652),J=s(84137),V=s(39741);async function H(e,t,s){return[]}function q(e,t,s){let[a,n]=(0,U.useState)([]),[i,l]=(0,U.useState)(!1),[r,o]=(0,U.useState)(null),{activeOrganization:d}=(0,h.YL)(),{value:c}=(0,_.fS)("trials_and_tribulations_of_high_school_football"),u=c&&!1,m=(0,U.useCallback)(async()=>{if(u&&e&&(null==d?void 0:d.uuid)){l(!0),o(null);try{let t=(await H(d.uuid,e,"outputs")).map(e=>{let t=e.split("/").pop()||e;return{path:e,name:t}});n(t)}catch(e){o("Failed to load files")}finally{l(!1)}}},[u,e,null==d?void 0:d.uuid]);return(0,U.useEffect)(()=>{u&&t&&m()},[u,t,m]),{files:a,isLoading:i,error:r,refetch:m}}s(97354);var K=s(70067);function Y(e){var t;return!!X(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function X(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}var Z=s(31417),Q=s(85330);s(60370);var $=s(41417),ee=s(80566),et=s(56273),es=s(11515),ea=s(37711),en=s(9786),ei=s(98769),el=s(69307),er=s(61437),eo=s(76761),ed=s(96377),ec=s(99272),eu=s(58911),em=s(49645),ef=s(89256),ex=s.n(ef),eh=s(94748),eg=s(22134);let ep=e=>{let{onClose:t,onBack:s,onDebug:a,title:i,isHidden:l,className:r}=e;return(0,n.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,n.jsx)($.$,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,n.jsx)(el.Z,{size:16})}),(0,n.jsx)("h2",{className:(0,M.A)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!a&&(0,n.jsx)($.$,{variant:"ghost",size:"icon_sm",onClick:a,disabled:l,children:(0,n.jsx)(er.z,{size:16})})]}),(0,n.jsx)($.$,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,n.jsx)(eo.X,{size:16})})]})};function ev(e){let{compassStatus:t,onOpenSources:s}=e;if(!t.total_sources)return null;let a=(e=>{let t=new Map,s=new Map;for(let a of e)for(let e of a.annotated_snippets)for(let a of e.tool_calls)if("web_search"===a.tool_name||"web_fetch"===a.tool_name){let e=[];if("web_search"===a.tool_name){if(!a.output||"rich_content"!==a.output.type||!a.output.content)continue;e=a.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===a.tool_name){if(!a.output||"rich_link"!==a.output.type||!a.output.link.url)continue;e=[a.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),a="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=s.get(i);s.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,n.jsx)(es.d,{url:a,size:14})})}catch(e){}}else if(a.output){let e=a.integration_name||a.tool_name,s="rich_content"===a.output.type?a.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+s,icon:(null==i?void 0:i.icon)||(0,n.jsx)(eg.r,{canShowLetterIcon:!0,size:14,iconUrl:a.server_icon_url||void 0,integrationName:a.integration_name||void 0,toolName:a.tool_name})})}let a=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(s.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return a.concat(i).slice(0,4-a.length)})(t.agents),i=a.length>0?a[0][1].count:0,l=t.total_sources-a.reduce((e,t)=>t[1].count+e,0);return 0===a.length?null:(0,n.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:(0,n.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[a.map((e,t)=>{let[s,{count:a,icon:l}]=e;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,n.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:s,children:s}),(0,n.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,n.jsx)(F.A,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:a}})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(C.P.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(a/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)}),l>0&&(0,n.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,n.jsx)(ed.H,{size:16,className:"text-text-300 mr-2"}),(0,n.jsx)("p",{children:(0,n.jsx)(F.A,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let ej=e=>{let{title:t,complete:s,className:a}=e;return(0,n.jsx)(C.P.h3,{className:(0,M.A)("text-base text-text-100 font-claude-response",a),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,n.jsx)(ea.N,{children:t})},t)};function eb(e){let{title:t,description:s,numSources:a,onClick:i,complete:l}=e;return(0,n.jsxs)(C.P.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,n.jsx)(ej,{title:null!=s?s:t,complete:l}),(0,n.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===a?(0,n.jsx)(F.A,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,n.jsx)(F.A,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:a}})})]})}function ey(e){let{status:t,allSnippets:s,onOpenSources:a}=e,[i,l]=(0,U.useState)([]);return(0,U.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,J.mk)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,n.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,n.jsx)(ev,{compassStatus:t,onOpenSources:()=>a(!0)}),s&&s.length>0&&(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)(C.P.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,n.jsx)(eb,{...e,onClick:()=>a(!0,e.globalAgentIndex)},t))})})]})}function ew(e){let{data:t,onClose:s}=e,[a,i]=(0,U.useState)(!1),[l,r]=(0,U.useState)({sourcesOpen:!1}),{conversationUUID:o,organizationUUID:d,isShared:c,taskId:u}=t,{compassStatus:m}=(0,J.CH)({organizationUUID:d,conversationUUID:o,taskId:u,isShared:c});if(!m)return null;let f=(e,t)=>{r({sourcesOpen:e,index:t})},x=void 0,h=l.sourcesOpen||a;return(0,n.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,n.jsx)(C.P.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,n.jsx)(e_,{compassStatus:m,onClose:s,onDebug:x,handleOpenSources:f})}),(0,n.jsx)("div",{className:(0,M.A)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,n.jsx)(C.P.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:ei.A.snappyOut},className:(0,M.A)("absolute top-0 left-0 right-0 bottom-0"),children:(0,n.jsx)(eM,{isHidden:!h,compassStatus:m,onBack:a?()=>i(!1):()=>f(!1),onClose:s,onDebug:x,isDebug:a,agentIndex:l.index})})]})}function e_(e){let{compassStatus:t,onClose:s,onDebug:a,handleOpenSources:i}=e,l=(0,L.A)(),r=(0,J.OQ)(t),o=t.status,d=(0,J.Nw)(t),c=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,total_sources:e.total_sources,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),m=k.P5.indexOf(o),f=[{title:o===k.zu.Starting||o===k.zu.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:d?(0,n.jsx)(J.GT,{thought:d,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!d},{title:o===k.zu.InitiatingAgents||o===k.zu.Searching?0===c?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:c}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:c}),titleIcons:(0,n.jsx)(J.mq,{hrefs:(0,J.mk)({agents:t.agents,n:3})}),children:(0,n.jsx)(ey,{allSnippets:u,status:t,onOpenSources:i}),shown:m>=2||t.agents.length>1,expandable:u.length>0},{title:o===k.zu.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:m>=4,expandable:!1}],x=f.filter(e=>e.expandable).length,h=f.findLastIndex(e=>!!e.expandable),g=(0,U.useRef)(h),[p,v]=(0,U.useState)(h),[j,b]=(0,U.useState)(!0),y=(0,U.useCallback)((e,t,s)=>{b(s),t?v(e):v(+(0===e))},[b,v]);(0,U.useEffect)(()=>{h!==g.current&&y(h,!0,!1)},[y,h]);let w=[k.zu.Cancelled,k.zu.Failed,k.zu.TimedOut].includes(t.status),_=f.filter(e=>e.shown).length;return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,n.jsx)(ep,{onClose:s,onDebug:a,title:r,className:"font-medium"}),(0,n.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[f.map((e,s)=>{let{expandable:a,shown:i,title:l,titleIcons:r,children:o}=e,d=w||s<_-1||t.status===k.zu.Completed;return(0,n.jsx)(ek,{title:l,titleIcons:r,noShimmer:d||w,complete:d,isExpanded:a&&p===s,snappyTransition:j,showLine:s<_-1||w||p===s,handleExpand:e=>y(s,e,!0),expandable:a,collapsible:x>1,shown:i,children:o},s)}),w&&(0,n.jsx)(ek,{title:t.status===k.zu.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:ex(),shown:w})]})]})}function ek(e){let{title:t,titleIcons:s,complete:a,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:d,snappyTransition:c,noShimmer:u,isError:m,showLine:f,children:x}=e;return!!r&&(0,n.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,n.jsx)("div",{className:(0,M.A)("transition-all w-2.5 h-2.5 rounded-full shrink-0",m?"bg-danger-200":a?"bg-text-500":"bg-accent-main-200")}),f&&(0,n.jsx)("div",{className:(0,M.A)("transition-all h-full -mb-1 w-[1px]",a?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,n.jsxs)("div",{className:"w-full flex flex-col",children:[(0,n.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>d(!o),disabled:!i||o&&!l,children:(0,n.jsxs)("h4",{className:(0,M.A)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",m&&"!text-danger-200"),children:[u?t:(0,n.jsx)(ea.N,{children:t}),(0,n.jsx)(em.N,{children:!!s&&!o&&(0,n.jsx)(C.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:s})}),!!i&&l&&(0,n.jsx)(ec.a,{className:(0,M.A)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,n.jsx)(eh.NG,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:c,className:"!max-h-none w-full",setIsExpanded:d,children:x})]})]})}function eN(e){var t,s;let{toolCall:a,isHidden:i}=e;if("web_fetch"===a.tool_name&&(null==(t=a.output)?void 0:t.type)==="rich_link"&&a.output.link.url){let{url:e,icon_url:t,title:s,subtitles:l}=a.output.link;return(0,n.jsx)(eh.aX,{isDisabled:i,isStreaming:!1,icon:(0,n.jsx)(es.d,{fadeInOnLoad:!0,url:t,size:16}),text:(0,n.jsx)(F.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:s,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,n.jsx)(eu.B,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return a.output?(0,n.jsx)(eg.K,{integrationName:a.integration_name||void 0,integrationIcon:a.server_icon_url||void 0,message:a.message,isExpandingDisabled:i,result:a.output,isStreaming:!1,isError:a.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null==(s=a.output)?void 0:s.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eM(e){var t;let{isHidden:s,compassStatus:a,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:d}=e,c=(0,U.useRef)(null),u=(0,L.A)(),m=d?!!(null==(t=a.agents[d])?void 0:t.completed_at):a.status===k.zu.Completed,f=void 0===d?null:a.agents[d].description||a.agents[d].name,x=function(e,t){let s=[];for(let a of t?[e.agents[t]]:e.agents)for(let e of a.annotated_snippets)for(let t of e.tool_calls)t.output&&s.push({toolCall:t,timestamp:e.complete&&a.completed_at||a.started_at});return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s.map(e=>{let{toolCall:t}=e;return t})}(a,d),h=void 0===d?a.total_sources:a.agents[d].total_sources;return(0,n.jsxs)("div",{className:(0,M.A)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,n.jsx)(ep,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:m?"":(0,n.jsx)(F.A,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{c.current&&(c.current.scrollTop=0)},500),r()}}),(0,n.jsxs)("div",{ref:c,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!f&&(0,n.jsx)(ej,{title:f,complete:m,className:"pt-1 pb-5"}),x.length>0?(0,n.jsx)("div",{className:"flex flex-col gap-4",children:x.map((e,t)=>(0,n.jsx)(eN,{toolCall:e,isHidden:s},t))}):(0,n.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,n.jsx)(F.A,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}var eC=s(30453),eA=s(7386),eS=s(21777),eE=s(23661),ez=s(18179),eI=s(9122),eR=s(7582),eT=s(34933),eU=s(52584);let eL=e=>{let{type:t,size:s,className:a,isLoading:i=!1}=e;return(0,n.jsx)("div",{className:(0,M.A)("bg-bg-100 text-text-500 flex items-center justify-center rounded-l-[inherit]","default"===s&&"w-14","sm"===s&&"w-11",a),children:i?(0,n.jsx)(ez.Loading,{size:"sm"}):(0,n.jsx)(()=>{switch(t){case w.vU.Markdown:return(0,n.jsx)(eI.O,{size:24});case w.vU.Svg:return(0,n.jsx)(eR.D,{size:24});case w.vU.Html:return(0,n.jsx)(eT.q,{size:24});case w.vU.Code:case w.vU.Text:default:return(0,n.jsx)(eU.C,{size:24})}},{})})};var eF=s(66849);let eO=e=>{let{artifact:t,onClick:s,size:a="default"}=e,i=(0,eF.Q)(),l=(0,n.jsx)(F.A,{defaultMessage:"Click to open {artifactType} • {versionCount, plural, one {# version} other {# versions}}",id:"fBoEKmAB/j",values:{artifactType:i[t.type],versionCount:t.versions.length}});return(0,n.jsx)(eD,{previewContent:(0,n.jsx)(eL,{type:t.type,size:a}),title:t.title||(0,n.jsx)(F.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}),metaContent:l,onClick:s,size:a,index:0})},eD=e=>{let{previewContent:t,title:s,metaContent:a,size:i,onClick:l,onRemove:r,index:o}=e,d=(0,L.A)(),c=l?"button":"div";return(0,n.jsxs)("div",{className:(0,M.A)("relative","sm"===i&&"max-w-[16rem]"),children:[r&&(0,n.jsx)("button",{className:"bg-bg-000 hover:bg-bg-300 shadow-element absolute right-0 top-0 z-10 -translate-y-2 translate-x-2 cursor-pointer rounded-full p-1",onClick:e=>{e.stopPropagation(),r(o)},children:(0,n.jsx)(eo.X,{size:11,weight:"bold"})}),(0,n.jsxs)(c,{className:(0,M.A)("border-0.5 border-border-300 bg-bg-000 flex flex-1 items-stretch overflow-hidden rounded-lg text-left transition-all","default"===i&&"w-full",!r&&"hover:border-border-200 hover:drop-shadow-sm",!r&&l&&"active:scale-[0.9875]"),onClick:l,disabled:!l,"aria-label":d.formatMessage({defaultMessage:"Preview contents",id:"hmKJSoIQ4a"}),children:[t,(0,n.jsxs)("div",{className:(0,M.A)("padding min-w-0 flex-1 pl-3 pr-2","default"===i&&"py-3","sm"===i&&"py-2"),children:[(0,n.jsx)("div",{className:(0,M.A)("break-words text-sm font-medium leading-tight","default"===i&&"line-clamp-2 font-medium","sm"===i&&"line-clamp-1"),children:s}),a&&(0,n.jsx)("div",{className:"text-text-400 line-clamp-1 text-xs",children:a})]})]})]})};var eP=s(49077),eB=s(74744),eW=s(52450),eG=s(29722),eJ=s(89436);let eV=e=>{let{projectUuid:t}=e,{data:s}=(0,D.fo)(t);return s?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(F.A,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-4",children:[(0,n.jsxs)(R(),{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,n.jsx)(eR.D,{size:16,className:"text-text-300 shrink-0"}),(0,n.jsx)("div",{className:"font-claude-response text-text-200 leading-tight tracking-tight",children:s.name})]}),(0,n.jsx)("div",{children:(0,n.jsx)(eJ.t,{project:s,className:"text-text-400 text-xs"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col",children:(0,n.jsx)(eG.b,{isEditable:!1,project:s,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]})}):null};function eH(e){let{conversationUUID:t,onClose:s,projectUuid:a,wiggleFiles:i=[],onRefreshFiles:l}=e,{allModelOptions:r}=(0,m.A9)(),{chatResourceState:{artifacts:o,attachments:d,files:c,syncSources:f},dispatchChatResource:x}=(0,et.i)(),h=(0,u.Z3)(t),g=r.find(e=>e.model===h),{modelConfig:p}=(0,m.fC)(h),v=p.image_in,{imageFiles:j,sanitizedDocumentFiles:b,blobFiles:y,wiggleVMFiles:w}=(0,U.useMemo)(()=>c.reduce((e,t)=>{switch(t.file_kind){case eE.M.Image:e.imageFiles.push(t);break;case eE.M.Blob:e.blobFiles.push(t);break;case eE.M.SanitizedDocument:e.sanitizedDocumentFiles.push(t);break;case eE.M.WiggleVM:e.wiggleVMFiles.push(t)}return e},{imageFiles:[],blobFiles:[],sanitizedDocumentFiles:[],wiggleVMFiles:[]}),[c]),k=Object.values(o),{value:N}=(0,_.fS)("conversation_export"),M=(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-5 text-center",children:[(0,n.jsx)("div",{className:"font-claude-response mb-1",children:(0,n.jsx)(F.A,{defaultMessage:"No content added yet",id:"KWvxczfvCc"})}),(0,n.jsx)("div",{className:"text-text-300 mb-1 text-xs",children:v?(0,n.jsx)(F.A,{defaultMessage:"Add images, PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"HJx5jgEsVM"}):(0,n.jsx)(F.A,{defaultMessage:"Add PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"J0WpDuvvlE"})})]});return(0,n.jsx)("div",{className:"h-full flex flex-col",children:(0,n.jsx)(eS.E,{children:(0,n.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,n.jsxs)("div",{className:"flex items-center draggable pl-7 md:pl-1 pr-0.5",children:[(0,n.jsx)("h2",{className:"font-ui flex-1 text-lg font-medium tracking-tight",children:(0,n.jsx)(F.A,{defaultMessage:"Chat controls",id:"nBvhDBTi6q"})}),(0,n.jsx)($.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:s,children:(0,n.jsx)(eo.X,{size:20})})]}),g&&(0,n.jsxs)("div",{className:"my-2",children:[(0,n.jsx)("div",{className:"text-text-200 text-lg",children:(0,n.jsx)(eP.V,{model:g})}),(0,n.jsxs)("p",{className:"text-text-300 text-sm",children:[g.description,"\xa0",(0,n.jsx)("a",{className:"hover:text-text-000 underline",href:"https://www.anthropic.com/product",target:"_blank",rel:"noopener",children:(0,n.jsx)(F.A,{defaultMessage:"Learn more",id:"TdTXXf940t"})})]})]}),k.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(F.A,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col gap-2",children:k.map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)(eO,{artifact:e,onClick:()=>x({type:"SELECT_ARTIFACT",id:e.id})})},"artifact-".concat(t)))})]}),a&&(0,n.jsx)(eV,{projectUuid:a,dispatchChatResource:x}),"",(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(F.A,{defaultMessage:"Content",id:"Jq3FDzj0/T"})}),j.length+y.length+b.length+w.length+d.length+f.length>0?(0,n.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[[...j,...y,...b,...w].map((e,t)=>(0,n.jsx)(eA.NM,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),d.map((e,t)=>(0,n.jsx)(eA.NM,{size:"stretch",file:e,handleClick:()=>x({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),f.map(e=>(0,n.jsx)(eB.br,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]}):M,N&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-5 text-sm font-medium",children:(0,n.jsx)(F.A,{defaultMessage:"Export conversation",id:"GZQU9SwGHT"})}),(0,n.jsx)(eW.aS,{conversationUUID:t})]})]})})})}var eq=s(41932);let eK=e=>{let{docUuid:t,projectUuid:s,goBack:a,onClose:i}=e,{data:l}=(0,eq.Rn)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:eE.R.UserUpload};return(0,n.jsx)(eC.f,{attachment:r,goBack:a,onClose:i})};var eY=s(51121);s(56370),s(24934),s(61773),s(49146),s(53029),s(19544),s(56340),s(1336),s(89697),s(9234);let eX=(0,U.memo)(function(e){let{conversationUUID:t,onClose:s,isStreaming:a,projectUuid:i,sendMessage:l,isOpen:r,messages:o,isTemporary:d=!1}=e,{activeOrganization:c}=(0,h.YL)(),{chatResourceState:{selectedItem:u,artifacts:m,activeMessageUUID:f,attachments:x,files:g},dispatchChatResource:p}=(0,et.i)(),v=null==c?void 0:c.uuid,{files:j,refetch:b}=q(t,r,d),y=(0,Q.f)({artifactContext:(null==u?void 0:u.type)==="artifact"&&u.versionUUID?{uuid:u.versionUUID,type:"artifact_version"}:void 0}),w=(0,Z.y)(x,g,v,i),_=(0,U.useMemo)(()=>({claudeComplete:y,getFile:w}),[y,w]),k=(0,U.useCallback)(e=>{(null==u?void 0:u.type)==="artifact"&&p({type:"SELECT_ARTIFACT",id:u.id,versionUUID:e})},[u,p]),N=(0,U.useCallback)(e=>p({type:"SELECT_DOC",id:e}),[p]),M=(0,U.useCallback)(()=>p({type:"CLEAR_SELECTED"}),[p]);return(0,n.jsxs)(n.Fragment,{children:[(null==u?void 0:u.type)==="artifact"&&m[u.id]&&(0,n.jsxs)("div",{className:"relative h-full",children:["",(0,n.jsx)(ee.CV,{isStreaming:a,artifact:m[u.id],selectedArtifactMessageUUID:f,selectedArtifactVersionUUID:u.versionUUID,setSelectedArtifactVersionUUID:k,onClose:s,projectUuid:i,selectDoc:N,sendMessage:l,richSandboxCapabilities:_,isOpen:r,isTemporary:d})]}),(null==u?void 0:u.type)==="artifact"&&!m[u.id]&&(0,n.jsx)(ee.CV,{isStreaming:a,artifact:void 0,selectedArtifactMessageUUID:f,selectedArtifactVersionUUID:(null==u?void 0:u.type)==="artifact"?u.versionUUID:void 0,setSelectedArtifactVersionUUID:k,onClose:s,projectUuid:i,selectDoc:N,sendMessage:l,richSandboxCapabilities:_,isOpen:r,isTemporary:d}),(null==u?void 0:u.type)==="attachment"?(0,n.jsx)(eC.f,{goBack:()=>p({type:"CLEAR_SELECTED"}),attachment:u.attachment,onClose:s}):(null==u?void 0:u.type)==="compass"?(0,n.jsx)(ew,{data:u.data,onClose:s,goBack:M}):i&&(null==u?void 0:u.type)==="doc"?(0,n.jsx)(eK,{docUuid:u.id,projectUuid:i,onClose:s,goBack:()=>p({type:"CLEAR_SELECTED"})}):(null==u||u.type,(null==u?void 0:u.type)==="artifact"&&m[u.id]?null:(0,n.jsx)(eH,{conversationUUID:t,onClose:s,projectUuid:i,wiggleFiles:j,onRefreshFiles:b}))]})});var eZ=s(18395);function eQ(e){let{conversationUuid:t,message:s}=e,a=(0,T.useRouter)(),i=(0,eY.Y)(),[l,r]=(0,U.useState)(!1);return(0,n.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-ui tracking-tight z-10 p-6 ",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,n.jsx)("div",{className:"text-lg",children:(0,n.jsx)(F.A,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)($.$,{onClick:()=>a.push("/new"),children:(0,n.jsx)(F.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,n.jsx)($.$,{variant:"secondary",onClick:()=>r(!0),children:(0,n.jsx)(F.A,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,n.jsx)(eZ.B,{conversationUuid:t,message:s,requestedFeedbackType:"chat_ended",setRequestedFeedbackType:()=>{},isOpen:l,onClose:()=>{r(!1)},onSuccess:()=>i.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var e$=s(57383),e0=s(74039),e1=s(77186),e2=s(53248),e3=s(50824),e5=s(56326),e6=s(98518),e4=s(10158),e7=s(46612),e9=s(92075);function e8(){let e=(0,a._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return e8=function(){return e},e}let te=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],tt=e=>{let{long:t}=e;return(0,n.jsx)("a",{className:"underline",href:e7.Z1,target:"_blank",rel:"noreferrer",children:t?(0,n.jsx)(F.A,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,n.jsx)(F.A,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},ts={consumer_restricted_mode:[{isDismissible:!1,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.A,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,n.jsx)(tt,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.A,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,n.jsx)(tt,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.A,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,n.jsx)(tt,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(F.A,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(F.A,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(F.A,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function ta(e){let{isClaudeDot:t,content:s,isDismissible:a,handleDismiss:i}=e;return(0,n.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,n.jsx)(ti,{$isFloating:t,children:(0,n.jsxs)("div",{className:"items-top flex justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:s}),a&&i&&(0,n.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,n.jsx)(eo.X,{size:24})})]})})})}function tn(e){let{conversationUuid:t}=e,s=(0,e6.st)(),a=(0,e4.fZ)(),{account:i,activeOrganization:l}=(0,h.YL)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:d}=(0,e9.iD)(),{data:c}=(0,e9.Nj)(null==l?void 0:l.uuid),u=(0,e4._r)().ipCountry,m=(null==c?void 0:c.active_flags)&&(null==c?void 0:c.active_flags.map(e=>e.type)),{shownFlagType:f,shownFlagDetails:x}=function(e,t){let s=te.findIndex(e=>null==t?void 0:t.includes(e)),a=te[s];if(!a)return{shownFlagType:null,shownFlagDetails:null};let n=ts[a].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===n.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:a,shownFlagDetails:n[0]}}(u,m);if((0,U.useEffect)(()=>{r&&o&&f&&s.track({event_key:"ts.banner.shown",flag_type:f,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,f,t,r,o,u]),!f||!x)return;let{isDismissible:g,content:p}=x,v=async()=>{if(!g)return;let e=[f];"consumer_second_warning"===f&&(null==m?void 0:m.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>d({flagType:e})))};return(0,n.jsx)(ta,{isClaudeDot:a,content:p,isDismissible:g,handleDismiss:v})}let ti=v.J.div(e8(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var tl=s(68020),tr=s(47211),to=s(21599),td=s(26237),tc=s(79900),tu=s(99318),tm=s(8884);let tf=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],tx=e=>{var t;let{selectedLabel:s,disabled:a}=e,l=(0,L.A)(),{track:r}=(0,e6.st)(),o=new Map([["apps_and_websites",l.formatMessage({defaultMessage:"Apps and websites",id:"HC16Tj5QBT"})],["documents_and_templates",l.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",l.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",l.formatMessage({defaultMessage:"Productivity tools",id:"t/RMra2cqp"})],["creative_projects",l.formatMessage({defaultMessage:"Creative projects",id:"gZSnjM59XP"})],["quiz_or_survey",l.formatMessage({defaultMessage:"Quiz or survey",id:"yyPDfhkUT7"})],["start_from_scratch",l.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),d=new Map(Array.from(o,e=>e.reverse())),c=new Map([["apps_and_websites",tl.E],["documents_and_templates",tr.i],["games",to.H],["productivity_tools",td.l],["creative_projects",tc.e],["quiz_or_survey",tu.S],["start_from_scratch",tm.f]]),{sendTransparentMessage:u,conversation:m}=(0,e$.o)(),{mutate:f}=(0,i.HF)(null==m?void 0:m.id),x=null!=(t=d.get(null!=s?s:""))?t:"default",h=async e=>{o.has(e)&&(r({event_key:"artifact.studio.create_mode_selected",create_mode:e}),(null==m?void 0:m.id)&&f({settings:{enabled_monkeys_in_a_barrel:!1}}),await u(o.get(e)))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-claude-response-body pl-2 mt-1",children:(0,n.jsx)(F.A,{defaultMessage:"Let’s get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-stretch w-full",children:tf.map(e=>{let t=c.get(e);return(0,n.jsx)("div",{className:(0,M.A)("relative w-full h-full min-h-[3.5rem] sm:h-28 p-3 sm:p-3.5 font-base bg-bg-000 rounded-lg transition-colors group",x===e&&"border-0.5 text-text-100 bg-bg-000 shadow-sm",("default"!==x&&x!==e||"default"===x&&a)&&"text-text-500 bg-bg-000/50 border-0.5 border-border-300","default"===x&&!a&&"border-0.5 border-border-300 text-text-300 hover:border-text-200 hover:bg-bg-000 hover:text-text-100 cursor-pointer shadow-sm"),onClick:async()=>{"default"!==x||a||await h(e)},children:(0,n.jsxs)("div",{className:"flex flex-row sm:flex-col items-center sm:items-start justify-center sm:justify-start h-full w-full gap-3 sm:gap-0",children:[t&&(0,n.jsx)(t,{size:20,weight:"light",className:(0,M.A)("transition-transform duration-300 ease-out shrink-0 sm:absolute sm:bottom-4 sm:right-4","default"===x&&!a&&"group-hover:-rotate-2 sm:group-hover:rotate-2 group-hover:scale-105")}),(0,n.jsx)("span",{className:"flex-1 text-left",children:o.get(e)})]})},e)})})]})};var th=s(95675);let tg=e=>{var t,s,a,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:d,invalidator:c}=e,[u,m]=(0,U.useState)(0),f=(0,U.useCallback)(()=>{var e,t,s,a;let n=(null==(e=l.lastAssistantMessage.current)?void 0:e.clientHeight)||0,i=(null==(t=l.lastHumanMessage.current)?void 0:t.clientHeight)||0,r=(null==(s=l.chatInput.current)?void 0:s.clientHeight)||0,o=(null==(a=l.extras.current)?void 0:a.clientHeight)||0,d=Math.max(window.innerHeight-i-n-o-r-110,0);d!==u&&m(d)},[l,u]);return(0,U.useLayoutEffect)(()=>{f()},[c,f,null==(t=l.lastAssistantMessage.current)?void 0:t.clientHeight,null==(s=l.lastHumanMessage.current)?void 0:s.clientHeight,null==(a=l.extras.current)?void 0:a.clientHeight,null==(i=l.chatInput.current)?void 0:i.clientHeight]),(0,U.useLayoutEffect)(()=>(window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)),[f]),(0,U.useLayoutEffect)(()=>{r&&(setTimeout(()=>{var e;null==(e=d.current)||e.scrollToBottomIfPinned("smooth")},0),o(!1))},[r,o,d]),(0,U.useEffect)(()=>{var e;null==(e=d.current)||e.scrollToBottomIfPinned("instant")},[d]),(0,n.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function tp(){return(0,n.jsx)(C.P.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-100 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,n.jsxs)("h2",{className:"font-title flex flex-col items-center justify-center gap-2 sm:flex-row",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(b.a,{state:"waiting"})}),(0,n.jsx)(F.A,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var tv=s(71710);let tj="/Spark/",tb=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],ty="".concat(tj,"/Check.svg"),tw=O.z.object({changeTitle:O.z.boolean().optional(),titleDelayMs:O.z.number().optional(),changeFavicon:O.z.boolean().optional(),faviconDelayMs:O.z.number().optional(),playSound:O.z.boolean().optional()}),t_={};var tk=s(98878),tN=s(77763),tM=s(11062);function tC(e){let{chatId:t,chatName:s,onSend:a}=e,{activeOrganization:n}=(0,h.YL)(),i=(0,e1.mn)(),l=(0,U.useRef)(!1);return(0,tk._v)(tN.A.ChatInfo,{getCurrentChatInfo:()=>Promise.resolve({chatId:t,chatName:s}),sendToChatWithPayload:e=>e.chatId===t&&!l.current&&!!n&&(l.current=!0,(async()=>{try{let t=[];if("images"in e)for(let s of e.images)try{t.push(...await (0,tM.bl)(s.base64,s.mimeType,n.uuid,i))}catch(e){}else if(e.imageBase64&&e.imageMimeType)try{t.push(...await (0,tM.bl)(e.imageBase64,e.imageMimeType,n.uuid,i))}catch(e){}return await a({prompt:e.text,files:t}),!0}catch(e){return!1}finally{l.current=!1}})(),!0)},[t,s,n,i,a]),null}var tA=s(58565),tS=s(77336);function tE(){let e=(0,a._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return tE=function(){return e},e}let tz=()=>{let[e,t]=(0,U.useState)(""),s=(0,L.A)(),a=(0,U.useMemo)(()=>[s.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),s.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),s.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[s]),i=(0,U.useMemo)(()=>s.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[s]),l=(0,U.useMemo)(()=>s.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[s]);return(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(a[Math.floor(Math.random()*a.length)])},5e3);return()=>clearTimeout(e)},[a]),(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(i)},15e3);return()=>clearTimeout(e)},[i]),(0,U.useEffect)(()=>{let e=setTimeout(()=>{t(l)},3e4);return()=>clearTimeout(e)},[l]),(0,n.jsx)(C.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:e})};function tI(e){var t,s,a,v,C,A,I,H,Z,Q,$,ee,es,ea,en;let{changeDisplayedConversationPath:ei,conversationTitle:el,conversationUUID:er,editMessage:eo,isStreaming:ed,isTemporary:ec=!1,isLoading:eu,messages:em,name:ef,onRetry:ex,onSend:eh,projectUuid:eg,setPersonalizedStyleCallback:ep,onToolAllow:ev}=e,{account:ej,activeOrganization:eb}=(0,h.YL)(),{selectedTier:ey}=(0,p.t)(),ew=(0,h.mV)(),e_=(0,g.B)(),ek=(0,L.A)(),{value:eN}=(0,_.fS)("claudeai_beam"),eM=(0,N.useExperiment)("smoother_optimization"),eC=(0,U.useRef)(null),eA=(0,U.useRef)(null);eA.current=null==(t=em[em.length-1])?void 0:t.uuid;let{chatResourceState:eS,dispatchChatResource:eE}=(0,et.i)(),{serverLastChatMessageWarningProps:ez,updateServerLastChatMessageWarningPropsForNewMessage:eI}=function(e,t){let[s,a]=(0,U.useState)(null),n=function(e){let{activeOrganization:t}=(0,h.YL)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:a}=(0,e1.L2)(s,"POST",{meta:{noToast:!0}});return(0,U.useCallback)(async e=>{let t=await a(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[a])}(e),i=(0,U.useCallback)(e=>{async function t(){try{a(await n(e))}catch(e){}}a(null),t()},[n]),l=(0,U.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==c.gF?s:null}})},[i]);return function(e){let{chatMessages:t,onLastMessageLoaded:s}=e,a=(0,U.useRef)(t.filter(e=>"human"===e.sender).pop());(0,U.useEffect)(()=>{if(!a.current)return;let e=(0,e2.C)(a.current);e&&s({uuid:a.current.uuid,messageText:e})},[s])}({chatMessages:t,onLastMessageLoaded:(0,U.useCallback)(e=>{let{uuid:t,messageText:s}=e;i({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[i])}),{serverLastChatMessageWarningProps:s,updateServerLastChatMessageWarningPropsForNewMessage:l}}(er,em),{setSandboxState:eR}=(0,r.q)(),eT=(0,T.useSearchParams)(),[eU,eL]=(0,U.useState)(!1),[eF,eO]=(0,U.useState)(null),eD={lastAssistantMessage:(0,U.useRef)(null),lastHumanMessage:(0,U.useRef)(null),chatInput:(0,U.useRef)(null),extras:(0,U.useRef)(null),extraSpace:(0,U.useRef)(null)},eP=(0,U.useCallback)(()=>{let e=eD.lastAssistantMessage.current;if(!e)return!0;let t=e.getBoundingClientRect(),s=window.innerHeight;return t.bottom<s+50},[eD.lastAssistantMessage]);(0,U.useEffect)(()=>eM.get("enabled",!1)?(ed?d.Z.setVisibilityCheck(eP):d.Z.clearVisibilityCheck(),()=>{d.Z.clearVisibilityCheck()}):void d.Z.clearVisibilityCheck(),[ed,eP,eM]);let eB=(0,U.useRef)(null),eW=(0,U.useCallback)(async e=>{let{prompt:t,attachments:s,files:a,syncSources:n,personalized_style:i,compass_mode:l}=e;if(ed)return;eE({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eI({messageText:t,parentMessageUuid:eA.current}),eR(er,{conversationFiles:[...eS.files,...a],allAttachments:[...eS.attachments,...s],projectUuid:eg});let r={prompt:t,attachments:s,files:a,syncSources:n,rethrowErrors:!0,parent_message_uuid:eA.current||c.gF,personalized_style:i,org_type_override:null!=ey?ey:void 0,compass_mode:l};eL(!0),await eh(r)},[ed,eE,eI,eR,er,eS.files,eS.attachments,eh,eg,ey]),eG=(0,U.useCallback)((e,t)=>{eE({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eR(er,{conversationFiles:eS.files,allAttachments:eS.attachments,projectUuid:eg}),ex(e,t)},[eE,eR,er,eS.files,eS.attachments,ex,eg]),eJ=(0,U.useCallback)(async()=>{if(ed)return;let e=ek.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await eh({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eA.current||c.gF})},[ek,ed,eA,eh]),eV=(0,U.useCallback)((e,t)=>{if(eo){var s;eE({type:"CLEAR_SELECTED"}),eo(e,t),eI({messageText:t,parentMessageUuid:null!=(s=e.parent_message_uuid)?s:null})}},[eE,eo,eI]),eH=(0,U.useMemo)(()=>(0,z.A)(),[]);(0,U.useEffect)(()=>(eH.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;eG(t,s)}),eH.on("edit",e=>{let{message:t,text:s}=e;eV(t,s)}),()=>{eH.off("retry"),eH.off("edit")}),[eH,eG,eV]);let[eq,eK]=(0,U.useState)("");(0,U.useEffect)(()=>{ed||eK(em.map(e=>(0,i.Rs)(e)).join(" "))},[em,ed]);let eY=(0,x.F)(eq),{files:eZ,attachments:e6,artifacts:e4}=eS,{isDrawerExpanded:e7,setIsDrawerExpanded:e9}=(0,th.x)(),e8=(0,U.useCallback)(()=>{eE({type:"CLEAR_SELECTED"}),e9(!0)},[eE,e9]),te=(0,U.useCallback)(()=>{e9(!1)},[e9]),tt=(0,tS.V)(em);(0,U.useEffect)(()=>{eE({type:"UPDATE_FILES",files:tt})},[tt,eE]),(0,U.useEffect)(()=>{eE({type:"UPDATE_ATTACHMENTS",attachments:em.flatMap(e=>e.attachments)})},[eE,em]),(0,U.useEffect)(()=>{eE({type:"UPDATE_SYNC_SOURCES",syncSources:em.flatMap(e=>e.sync_sources)})},[eE,em]);let ts=(0,U.useCallback)(e=>{e8(),eE({type:"SELECT_ATTACHMENT",attachment:e})},[eE,e8]),ta=(0,U.useMemo)(()=>!!((null==e_?void 0:e_.preview_feature_uses_artifacts)||em.some(e=>Y(e))),[e_,em]),ti=(0,U.useCallback)((e,t,s)=>{e8(),eE({type:"SELECT_ARTIFACT",id:e,versionUUID:s}),eE({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[eE,e8]),tl=(0,U.useCallback)((e,t)=>{},[eE,e8]),tr=em[em.length-1];(0,U.useEffect)(()=>{if(!ta)return;let e={};em.forEach(t=>{(0,w.Xz)(t).forEach(t=>{var s,a,n;let{id:i,currentVersion:l,type:r,title:o,language:d}=t,c=(0,w.zI)(l,null==(n=e[i])||null==(a=n.versions)||null==(s=a.slice(-1)[0])?void 0:s.resultState),u={...l,resultState:c};e[i]?e[i].versions.push(u):e[i]={id:i,type:r||"document",title:o||"Untitled",language:d||void 0,versions:[u]}})}),eE({type:"UPDATE_ARTIFACTS",artifacts:e})},[em,ta,tr,eE]);let to=tr?(0,w.Xz)(tr):[],td=null!=(es=S()(to))?es:null,tc=null!=(ea=null==td?void 0:td.id)?ea:null,{files:tu,refetch:tm}=q(er,e7,ec);(0,U.useEffect)(()=>{em.length},[em,tm,ec]);let tf=(0,U.useRef)({lastOpenedId:null});(0,U.useEffect)(()=>{tf.current.lastOpenedId},[ed,tl,null,null==tr?void 0:tr.uuid]),(0,U.useEffect)(()=>{let e=tf.current.lastOpenedId===tc;ed&&tc&&!e&&(tf.current.lastOpenedId=tc,ti(tc))},[ed,tc,ti]),(0,U.useEffect)(()=>{let e=eT.get("artifactId");e&&(e8(),eE({type:"SELECT_ARTIFACT",id:e}))},[]);let tk=ed&&tr&&tr.content?tr.content[tr.content.length-1]:void 0,tN=ed&&(!tr||!(null==(s=tr.content)?void 0:s[0])&&0===tr.attachments.length&&0===tr.files.length&&0===tr.files_v2.length),tM=tk&&("tool_use"===tk.type||"tool_result"===tk.type),tE=(0,U.useMemo)(()=>{if(tr){let e=X(tr);if(!e)return;let t=e.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:s}=K.z7.safeParse(t);return null==s?void 0:s.task_id}},[tr]),tI=!ed&&void 0!==tE,{compassStatus:tT}=(0,J.CH)({organizationUUID:null==eb?void 0:eb.uuid,conversationUUID:er,taskId:tE,isShared:!1,enabled:tI}),tU=(0,U.useMemo)(()=>{if(!tr)return!1;let e=X(tr);return!!(e&&!e.is_error&&(0,k.i3)(null==tT?void 0:tT.status)&&!Y(tr))},[tr,tT]),tL=(0,V.Wo)(),tF=(0,V.hG)(),{value:tO}=(0,_.fS)("compass_enable_notifications_web"),tD=(0,U.useMemo)(()=>tN?"thinking":tM||tU?"shimmer":ed?"writing":"static",[tN,tM,ed,tU]);((e,t,s)=>{let a=(0,_.T9)("claude_ai_tabbed_out_notifications","features",t_,tw),n="visible"===(0,tv.f)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=((e,t,s)=>{let a=(0,U.useRef)(null),n=(0,U.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title="Working on it..."},[]),i=(0,U.useCallback)(()=>{if(a.current)return;let t=0;a.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,U.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title=t},[t]);return(0,U.useMemo)(()=>({setThinkingTitle:n,setReceivedTitle:i,resetTitle:l}),[n,i,l])})(["Ready to chat",e],e,a.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:d,resetFavicon:c}=(e=>{let t=(0,U.useRef)(null),s=(0,U.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),a=(0,U.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),n=(0,U.useCallback)(()=>{if(t.current)return;let a=0;t.current=setInterval(()=>{s("".concat(tj,"/").concat(tb[a],".svg")),a=(a+1)%tb.length},e)},[e,s]),i=(0,U.useCallback)(()=>{a(),s(ty)},[s,a]);return(0,U.useMemo)(()=>({setWritingFavicon:n,setCompleteFavicon:i,resetFavicon:a}),[n,i,a])})(a.faviconDelayMs||100),{playSound:u,resetSound:m}=(()=>{let e=(0,U.useRef)(null),t=(0,U.useRef)(!1);(0,U.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,U.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null==(s=e.current)||s.play()}}},[]),a=(0,U.useCallback)(()=>{t.current=!1},[]);return(0,U.useMemo)(()=>({playSound:s,resetSound:a}),[s,a])})(),f=(0,U.useRef)(!1);(0,U.useEffect)(()=>{let e=t&&s,x=!t&&s,h=!t&&!s;e&&!f.current&&(f.current=!0);let g=h&&f.current;if(g&&(f.current=!1),n){a.changeTitle&&r(),a.changeFavicon&&c();return}a.changeTitle&&(e||x?i():g&&l()),a.changeFavicon&&(x?o():g&&(d(),f.current=!1)),a.playSound&&(e?m():g&&u())},[a,t,s,n,i,l,r,o,d,c,u,m])})(el,tN,ed);let{getCreateParamsForConvo:tP}=(0,f.I)();(0,U.useEffect)(()=>{if(eu)return;let e=tP(er);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&eW(e)},[er,eW,tP,eu]);let{data:tB}=(0,D.fo)(eg),tW=(0,B.K)(),tG=(0,P.ED)(eg),{publishedArtifactsByMessageUuid:tJ}=(0,l.rC)({includeDeletedArtifacts:!0}),{mutate:tV,isPending:tH}=(0,i.aC)(er),tq=(0,f.E)(),tK=(0,U.useCallback)((e,t)=>{eE({type:"CLEAR_SELECTED"}),null==ei||ei(e,t)},[ei,eE]),tY=(0,u.Z3)(er);(0,e0.hq)(er);let tX=null==tr||null==(a=tr.content)?void 0:a.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),{activeModelOptions:tZ}=(0,m.A9)(),tQ=O.z.array(O.z.string()),t$=(0,_.T9)("invite_contest_name","model_prefixes",[],tQ),{data:t0}=(0,i.Fn)();(0,U.useEffect)(()=>{var e,t;if(!ed&&2===em.length&&(null==(e=em[0])?void 0:e.sender)==="human"&&(null==(t=em[1])?void 0:t.sender)==="assistant"&&t$.some(e=>null==tY?void 0:tY.startsWith(e))&&t0&&t0.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUUID:er,model:tY}});window.dispatchEvent(e)}},[ed,em,tY,er,t$,t0]);let t1=(0,U.useMemo)(()=>{let e=ek.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tZ.find(e=>e.model===tY);if(!t||!t.knowledgeCutoff)return e;let s=E.c9.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return ek.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:ek.locale});return ek.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tY,tZ,ek]),t2=(0,U.useMemo)(()=>e4,[!ed&&e4]),t3=e7&&eS.selectedItem?eS.selectedItem:void 0,t5=(0,U.useCallback)(e=>(0,n.jsx)(tA.A,{...e,conversationUUID:er,artifacts:t2,onOpenArtifact:ta?ti:void 0,onAllow:e.isLastMessage&&!e.toolResult?ev:void 0,selectedDrawerItem:t3}),[er,t2,ta,ti,ev,t3]),t6=(0,U.useCallback)(()=>{eO({})},[]),t4=(0,U.useMemo)(()=>({id:er,messagesSoFar:em.length,tokensSoFar:eY,files:eZ,attachmentsSoFar:e6.length,isSampling:ed,isStoppingSampling:tH,model:tY,projectKnowledgebaseTokens:null!=tG?tG:0,conversationSettings:e_}),[e6.length,e_,eY,er,eZ,tH,ed,em.length,tY,tG]),t7=(0,U.useMemo)(()=>tr&&"assistant"===tr.sender&&tr.content&&tr.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[tr]),t9=(0,U.useCallback)(()=>{(0,o.OZ)(),tV()},[tV]),t8=(0,U.useCallback)(async e=>{await eW({prompt:e.prompt,attachments:[],files:e.files,syncSources:[]})},[eW]);return ej?(0,n.jsx)(e3.b,{autoscrollDisabled:!0,autoscrollRef:eC,leftSidebarElement:void 0,mainElement:(0,n.jsxs)(e$._,{conversation:t4,projectUuid:eg,onSend:eW,onCreate:tq,onStopSampling:t9,setPersonalizedStyleCallback:ep,children:[(0,n.jsx)(tC,{chatId:er,chatName:ef,onSend:t8}),(0,n.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,n.jsx)(tn,{conversationUuid:er}),eu?(0,n.jsx)(tR,{className:"pt-2",children:(0,n.jsx)(G.d,{})}):0===em.length?(0,n.jsx)(n.Fragment,{children:(null==t4||null==(v=t4.conversationSettings)?void 0:v.create_mode)?(0,n.jsx)(tR,{className:"pt-1",children:(0,n.jsx)(tx,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(tp,{}),(0,n.jsx)(tR,{})]})}):(0,n.jsxs)(tR,{className:"pt-1",children:[(null==t4||null==(C=t4.conversationSettings)?void 0:C.create_mode)&&(0,n.jsx)(tx,{selectedLabel:(null==em||null==(H=em[0])||null==(I=H.content)||null==(A=I[0])?void 0:A.type)==="text"?null==em||null==($=em[0])||null==(Q=$.content)||null==(Z=Q[0])?void 0:Z.text:void 0,disabled:em.length>0}),(0,n.jsx)(e5.$,{renderToolUseCell:t5,children:em.map((e,t)=>(0,n.jsx)(G.c,{lastHumanMessageRef:eD.lastHumanMessage,lastAssistantMessageRef:eD.lastAssistantMessage,previousMessage:t>0?em[t-1]:void 0,message:e,conversationUUID:er,conversationSettings:e_,isStreaming:ed,isLastMessage:t===em.length-1,isLastHumanMessage:t===em.length-2,isFirstAssistantMessage:1===t&&"assistant"===e.sender,messageWarningProps:t===em.length-1&&ez||void 0,onOpenArtifact:ta?ti:void 0,onOpenWiggleFile:t=>{tl(t,e.uuid)},selectAttachment:ts,changeDisplayedConversationPath:tK,editable:!0,publishedArtifacts:null==tJ?void 0:tJ[e.uuid],onResize:t6,actionEmitter:eH,onSendContinue:eJ,isResearchPending:tU,isTemporary:ec},t))}),(0,n.jsx)("div",{ref:eD.extras,children:(0,n.jsxs)("div",{className:(0,M.A)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",ed&&"-translate-y-2.5"),children:[(0,n.jsx)("div",{className:"p-1 -translate-x-px",children:(0,n.jsx)(b.a,{state:tD,className:(0,M.A)(ec&&"!text-text-100")})}),2===em.length&&ed&&(null==(ee=em[1])?void 0:ee.content)&&0===em[1].content.length?(0,n.jsx)(tz,{}):null,(0,n.jsx)("div",{className:(0,M.A)("text-text-500 pt-6 flex-1 text-right text-[0.65rem] leading-[0.85rem] tracking-tighter sm:text-[0.75rem]",ed&&"pointer-events-none"),children:ec?(0,n.jsx)("div",{className:(0,M.A)("inline-block select-none transition-opacity",!ed&&"opacity-100 duration-700",ed&&"opacity-0 duration-0"),children:(0,n.jsxs)(R(),{href:"https://support.anthropic.com/en/articles/11817273-how-does-claude-s-memory-work",target:"_blank",className:"inline-block select-none group",children:[(0,n.jsx)(j.YX,{id:"heroic_sandwich_butterfly"}),(0,n.jsx)("br",{}),(0,n.jsx)("div",{className:"underline-offset-2 decoration-transparent group-hover:decoration-border-200 group-hover:underline transition",children:ew?(0,n.jsx)(F.A,{defaultMessage:"Learn more about how your team manages your data.",id:"c7L+uxOfAq"}):(0,n.jsx)(F.A,{defaultMessage:"Learn more about how your data is used.",id:"kmJ0Kzamee"})})]})}):tU&&tO?(0,n.jsx)("div",{className:"inline-block select-none",children:"default"===tL?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(F.A,{defaultMessage:"Research takes time. Claude can let you know when it’s done.",id:"sPgKzf0LZ9"})}),(0,n.jsx)("button",{onClick:tF,className:"text-text-300 hover:text-text-200 underline",children:(0,n.jsx)(F.A,{defaultMessage:"Enable notifications",id:"AIUVfaT9og"})})]}):(0,n.jsx)(F.A,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,n.jsx)(y.m,{tooltipContent:t1,side:"bottom",align:"end",disableHoverableContent:!0,className:"max-w-full",children:(0,n.jsx)(R(),{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,M.A)("inline-block underline-offset-2 transition hover:underline select-none decoration-transparent hover:decoration-border-200",!ed&&"opacity-100 duration-700",ed&&"opacity-0 duration-0"),children:t7?(0,n.jsx)(F.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}}):(0,n.jsx)(F.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}})})})})]})}),(0,n.jsx)(tg,{newMessageSent:eU,setNewMessageSent:eL,scrollRefs:eD,scrollContainerRef:eC,invalidator:eF})]}),(null==t4||null==(en=t4.conversationSettings)?void 0:en.create_mode)&&0===em.length?null:tX?(0,n.jsx)("div",{ref:eD.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(eQ,{conversationUuid:er,message:tr})}):(0,n.jsx)("div",{ref:eD.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(W.V,{ref:eB,placement:"bottom",disabled:eu})})]})]}),drawerElement:(0,n.jsx)(eX,{conversationUUID:er,isOpen:e7,onClose:te,isStreaming:ed,projectUuid:eg,sendMessage:eW,messages:em,isTemporary:ec}),isDrawerOpen:e7,headerProps:{conversationUUID:er,name:ef,project:tW?tB:void 0,controlsSidebarIsOpen:e7,closeControlsSidebar:te,openControlsSidebar:e8,isStreaming:ed,wiggleFilesCount:0}}):null}let tR=v.J.div(tE())},13625:(e,t,s)=>{s.d(t,{d:()=>v,L:()=>p});var a=s(54568),n=s(8027),i=s(11515),l=s(1761),r=s(46760),o=s(62971),d=s(55563),c=s(94748),u=s(41417),m=s(5060);s(7620);var f=s(32987);function x(e){let{symbol:t,variant:s}=e;return(0,a.jsx)("div",{className:(0,f.$)("inline-flex items-center justify-center rounded px-1 py-0.5 text-xs ml-1","secondary"===s&&"bg-bg-300 text-text-400","primary"===s&&"bg-bg-100 bg-opacity-20 text-bg-100"),children:t})}function h(e){let{disabled:t,submitToolApproval:s,showAlwaysAllowed:n,setIsExpanded:i}=e,l=e=>{s(e),i(!1)};return(0,m.W)("keydown",e=>{if("Escape"===e.key){e.preventDefault(),l("deny");return}if("Enter"===e.key){let t=e.metaKey||e.ctrlKey;t&&n?(e.preventDefault(),l("always")):t||(e.preventDefault(),l("once"))}}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 pb-3 pl-3 pr-6",children:[(0,a.jsx)("div",{className:"flex flex-col justify-center items-start p-3 bg-bg-200 border-0.5 border-border-400/15 rounded-md min-h-[41px]",children:(0,a.jsx)("p",{className:"text-xs",children:(0,a.jsx)(o.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})}),(0,a.jsxs)("div",{className:"self-end flex gap-2",children:[(0,a.jsx)(u.$,{variant:"secondary",onClick:()=>l("deny"),append:(0,a.jsx)(x,{symbol:"esc",variant:"secondary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Deny",id:"htvX+Z11l+"})}),n&&(0,a.jsx)(u.$,{variant:"secondary",disabled:t,onClick:()=>l("always"),append:(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)(x,{symbol:"⌘",variant:"secondary"}),(0,a.jsx)(x,{symbol:"⏎",variant:"secondary"})]}),children:(0,a.jsx)(o.A,{defaultMessage:"Always allow",id:"lr3QX/nctD"})}),(0,a.jsx)(u.$,{variant:"primary",disabled:t,onClick:()=>l("once"),append:(0,a.jsx)(x,{symbol:"⏎",variant:"primary"}),children:(0,a.jsx)(o.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]})]})}var g=s(67532);let p=e=>{let{input:t,toolResult:s}=e,n=(0,r.A)(),{activeOrganization:i}=(0,l.YL)(),o=null==i?void 0:i.uuid,c="";if(void 0!==t){try{c=JSON.stringify(t,null,2)}catch(e){c=String(t)}c=(c=c.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,a.jsx)(d.z,{title:n.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:c}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,a.jsx)(d.z,{title:n.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,a.jsx)("img",{src:"/api/".concat(o,"/files/").concat(e.file_uuid,"/preview"),alt:n.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},v=e=>{let{toolName:t,integrationName:s,integrationIcon:l,approvalData:r,...d}=e,{input:u,toolResult:m,groupItemKey:f}=d,x=!!(null==r?void 0:r.approvalRequired),v=!!(null==r?void 0:r.approvalRequired)&&!(null==r?void 0:r.approved),{isExpanded:j,setIsExpanded:b,snappyTransition:y}=(0,g.a)(x,v?void 0:f),w=v?s?(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName} from {integrationName}",id:"wPBSjwhfE4",values:{toolName:t,integrationName:s}}):(0,a.jsx)(o.A,{defaultMessage:"Claude wants to use {toolName}",id:"ZNLjFNb5bD",values:{toolName:t}}):t;return(0,a.jsx)(c.sH,{isExpanded:j,setIsExpanded:b,isExpandingDisabled:v,text:w,icon:(0,a.jsx)(i.d,{url:l,fallbackSvg:(0,a.jsx)(n.B,{letter:s||t,size:18}),size:18}),...d,children:(0,a.jsx)(c.NG,{isExpanded:j,snappyTransition:y,isScrollable:!0,footer:v?(0,a.jsx)(h,{...r,setIsExpanded:b}):null,children:(0,a.jsx)(p,{input:u,toolResult:m})})})}},18395:(e,t,s)=>{s.d(t,{B:()=>g});var a=s(54568),n=s(7726),i=s(1761),l=s(9537),r=s(41417),o=s(37076),d=s(54890),c=s(27261),u=s.n(c),m=s(7620),f=s(46760),x=s(62971),h=s(77336);function g(e){var t,s,c,g,p,v;let{conversationUuid:j,message:b,requestedFeedbackType:y,setRequestedFeedbackType:w,isOpen:_,onClose:k,onSuccess:N,showOptions:M=!0}=e,C=(0,f.A)(),[A,S]=(0,m.useState)(""),{data:E}=(0,n.Bq)(j),z=null==E?void 0:E.chat_messages.some(e=>(0,d.Xz)(e).length>0),I=(0,h.V)(null!=(c=null==E?void 0:E.chat_messages)?c:[]).length>0,{mutate:R}=(0,n.HA)(j,b,!!z,{onSuccess:N}),T=(0,m.useId)(),U=null!=(g=null==(t=b.content)?void 0:t.some(e=>"thinking"===e.type))&&g,L="raven"===(0,i.$b)(),F=null;return(null==E||null==(s=E.settings)?void 0:s.enabled_web_search)&&(F=null!=(v=null==(p=b.content)?void 0:p.some(e=>"tool_use"===e.type&&"web_search"===e.name))&&v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("option",{value:"flag/web-over",children:(0,a.jsx)(x.A,{defaultMessage:"Shouldn’t have searched the web",id:"T+mr27AakV"})}),(0,a.jsx)("option",{value:"flag/web-sources",children:(0,a.jsx)(x.A,{defaultMessage:"Don’t like the cited sources",id:"MBNotx/VaO"})})]}):(0,a.jsx)("option",{value:"flag/web-under",children:(0,a.jsx)(x.A,{defaultMessage:"Should have searched the web",id:"CS8kdzupd9"})})),(0,a.jsxs)(o.aF,{isOpen:_,title:C.formatMessage({defaultMessage:"Feedback",id:"Ejhdi47Jk5"}),onClose:k,children:[(0,a.jsxs)("div",{className:"mt-4 flex flex-col",children:[(null==y?void 0:y.includes("flag"))&&M&&(0,a.jsxs)(l.l6,{className:"my-2 max-w-md",label:C.formatMessage({defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"}),value:y,onChange:e=>{w(e.target.value||"flag")},children:[(0,a.jsx)("option",{value:"flag",children:(0,a.jsx)(x.A,{defaultMessage:"Select…",id:"q0+99kUbd6"})}),(0,a.jsx)("option",{value:"flag/bug",children:(0,a.jsx)(x.A,{defaultMessage:"UI bug",id:"0uIYueAyDB"})}),(0,a.jsx)("option",{value:"flag/refusal",children:(0,a.jsx)(x.A,{defaultMessage:"Overactive refusal",id:"Jl0Mn6yDBI"})}),I&&(0,a.jsx)("option",{value:"flag/file",children:(0,a.jsx)(x.A,{defaultMessage:"Poor image understanding",id:"227KYxHrx5"})}),(0,a.jsx)("option",{value:"flag/instructions",children:(0,a.jsx)(x.A,{defaultMessage:"Did not fully follow my request",id:"2uOw8LgMwG"})}),(0,a.jsx)("option",{value:"flag/facts",children:(0,a.jsx)(x.A,{defaultMessage:"Not factually correct",id:"topE9Q6MGe"})}),(0,a.jsx)("option",{value:"flag/incomplete",children:(0,a.jsx)(x.A,{defaultMessage:"Incomplete response",id:"ZNEcy7OM5r"})}),U&&(0,a.jsx)("option",{value:"flag/thoughts",children:(0,a.jsx)(x.A,{defaultMessage:"Issue with thought process",id:"zOab+24EWo"})}),F,(0,a.jsx)("option",{value:"flag/other",children:(0,a.jsx)(x.A,{defaultMessage:"Other",id:"/VnDMl81rh"})})]}),(0,a.jsx)("label",{htmlFor:T,className:"text-text-400 mb-2 text-sm",children:(0,a.jsx)(x.A,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),(0,a.jsx)(l.fs,{id:T,className:"text-sm",placeholder:(null==y?void 0:y.includes("flag"))?C.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}):C.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),value:A,onChange:e=>{S(e.target.value)}})]}),(0,a.jsx)("p",{className:"text-text-500 mt-3 italic leading-tight",children:(0,a.jsx)("small",{children:(0,a.jsx)(x.A,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn More</link>",id:"laRJ009b4f",values:{link:e=>(0,a.jsx)(u(),{target:"_blank",rel:"noopener",href:L?"https://privacy.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback":"https://privacy.anthropic.com/en/articles/10023565-how-does-anthropic-use-submitted-feedback",className:"text-accent-secondary-100 font-medium hover:underline",children:e})}})})}),(0,a.jsxs)(o.vW,{children:[(0,a.jsx)(r.$,{onClick:()=>{y&&(R({type:y,reason:A||void 0}),k())},children:(0,a.jsx)(x.A,{defaultMessage:"Submit",id:"wSZR47Y5kj"})}),(0,a.jsx)(r.$,{variant:"secondary",onClick:k,children:(0,a.jsx)(x.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})})]})]})}},20298:(e,t,s)=>{s.d(t,{n:()=>b,M:()=>j});var a=s(7726),n=s(97527),i=s(33200);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]}var r=s(37428),o=s(7620),d=s(99965),c=s(92947),u=s(56147),m=s(16253),f=s(75632);async function x(e,t){let s;try{s=await t.callback(e)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}return{is_error:s.isError,content:s.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return h({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw Error("Missing MIME type for embedded resource");return h({mimeType:t.mimeType,base64Data:t.blob})}}}throw Error("Unsupported content type: ".concat(e.type))})}}function h(e){let{mimeType:t,base64Data:s}=e;if(!m._F[t])throw Error("Unsupported image type: ".concat(t));let a=m._F[t];return{type:"image",file_name:"".concat((0,f.N)(),".").concat(a),source:{media_type:t,type:"base64",data:s}}}var g=s(21155);async function p(e,t){let s=g.zN.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}throw Error("Error parsing input: ".concat(s.error.message))}var v=s(28871);function j(){let{mutateAsync:e}=(0,a.Pt)(),t=function(){let{executeReplCode:e}=(0,n.q)(),{mcpTools:t}=(0,c.gt)();return(0,o.useCallback)(async(s,a)=>{let n=(0,v.p)(a);if("repl"===s)return await p(n,e);{let e=null==t?void 0:t.find(e=>"".concat(e.serverName,":").concat(e.name)===s);if(e)return await x(n,e)}},[e,t])}();return(0,o.useCallback)(async function(s,a,n,i){let{overriddenResult:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};l("Tools: Using tool ".concat(a," with input ").concat(i));try{let o=null!=r?r:await t(a,i);if(void 0===o)return void l("Tools: Unable to find tool with name ".concat(a));l("Tools: Result for tool ".concat(a,": ").concat(o)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,...o})}catch(i){let t=i instanceof Error?i.message:String(i);l("Tools: Error for tool ".concat(a,": ").concat(t)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,content:[{type:"text",text:t}]})}},[t,e])}let b=(e,t)=>{let s=(0,r.wc)(),{servers:a}=(0,c.gt)(),{value:n}=(0,i.N)(null!=e?e:{}),l=(0,d.p9)(),m=(0,u.Pb)(t);return(0,o.useCallback)(()=>{let t=[];for(let s of a)for(let a of s.tools){var i,o;if((null==e||null==(i=e.enabled_mcp_tools)?void 0:i[a.enabledKey])!==!1){if(l&&"remote"===s.type)continue;t.push({name:a.name,description:null!=(o=a.description)?o:a.name,input_schema:a.inputSchema,integration_name:s.name,...(null==s?void 0:s.type)==="remote"&&{mcp_server_uuid:s.uuid,integration_icon_url:s.url}})}}let d=null==s?void 0:s[r.U3];return d&&t.push({type:(null==s?void 0:s[r.$6])||"",name:d}),t.push({type:"artifacts_v0",name:"artifacts"}),n&&t.push({type:"repl_v0",name:"repl"}),m&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[a,null==e?void 0:e.enabled_mcp_tools,n,s,m,l])}},22134:(e,t,s)=>{s.d(t,{K:()=>g,r:()=>v});var a=s(54568),n=s(8027),i=s(11515),l=s(33395),r=s(60370),o=s(34059),d=s(77101),c=s(32987),u=s(37463),m=s(46760),f=s(55563),x=s(94748),h=s(67532);function g(e){var t,s,n;let i,{integrationName:l,icon:r,integrationIcon:o,message:d,result:c,isStreaming:u,isError:f,isExpandingDisabled:g,isFirstBlockOfMessage:p,isLastBlockOfMessage:w,wrapperClassName:_,contentClassName:k,defaultExpanded:N=!1,toolName:M,renderMode:C,groupItemKey:A,isFirstItemInGroup:S,isLastItemInGroup:E}=e,z=(0,m.A)(),{isExpanded:I,setIsExpanded:R}=(0,h.a)(N,A),T=!!c&&!g&&!u&&("rich_content"!==c.type||(null==(t=c.content)?void 0:t.length)>0);return i=c?"rich_content"===c.type?z.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(n=null==(s=c.content)?void 0:s.length)?n:0}):"JSON":void 0,(0,a.jsx)(x.sH,{isError:f,isExpandingDisabled:!T,isExpanded:I,setIsExpanded:R,isStreaming:!!u,text:null!=d?d:u?z.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):z.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:u?void 0:i,icon:r||(0,a.jsx)(v,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:p,isLastBlockOfMessage:w,wrapperClassName:_,renderMode:C,isFirstItemInGroup:S,isLastItemInGroup:E,children:(0,a.jsxs)(x.NG,{isExpanded:I,snappyTransition:!0,isScrollable:!0,className:k,children:[T&&(null==c?void 0:c.type)==="rich_content"&&(0,a.jsx)(j,{disabled:!I||u,result:c,integrationName:l,toolName:M}),T&&(null==c?void 0:c.type)==="table"&&(0,a.jsx)(b,{result:c}),T&&(null==c?void 0:c.type)==="json_block"&&(0,a.jsx)(y,{result:c})]})})}let p=["Google Calendar","Gmail","Google Drive","Search Project Knowledge","Search Past Conversations"],v=e=>{let{canShowLetterIcon:t,integrationName:s,toolName:l,iconUrl:c,size:u=16}=e;switch(s){case"Google Drive":return(0,a.jsx)(o.A9,{type:d.v8.GDRIVE,size:u});case"Google Calendar":return(0,a.jsx)(o.A9,{type:d.v8.GCAL,size:u});case"Gmail":return(0,a.jsx)(o.A9,{type:d.v8.GMAIL,size:u});case"Search Project Knowledge":return(0,a.jsx)(r.JtL,{vectorSizeOverride:u});case"Search Past Conversations":return(0,a.jsx)(r.ce8,{vectorSizeOverride:u})}return(0,a.jsx)(i.d,{fadeInOnLoad:!0,url:c,size:u,fallbackSvg:(s||l)&&t?(0,a.jsx)(n.B,{size:u,letter:s||l}):(0,a.jsx)(r.qzq,{vectorSizeOverride:u,className:"text-text-500"})})},j=e=>{let{disabled:t,integrationName:s,result:n,toolName:i}=e,r=i?i.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,o=!!s&&p.includes(s)&&2039!==r&&2010!==r;return(0,a.jsx)(u.P.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:n.content.map((e,n)=>{let{title:i,subtitles:r,url:d,resource_type:c,icon_url:u}=e;return(0,a.jsx)(l.$,{disabled:t,icon:o?void 0:(0,a.jsx)(v,{integrationName:s,iconUrl:u}),title:i,subtitles:r,url:d,tag:c},n)})})},b=e=>{let{result:t}=e;return(0,a.jsx)(w,{table:t.table})},y=e=>{let{result:t}=e,s=(0,m.A)();return(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,a.jsx)(f.z,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},w=e=>{let{table:t}=e;return(0,a.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[n,i]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,c.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"font-medium text-text-300 text-xs",children:n})}),(0,a.jsx)("div",{className:(0,c.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},24934:(e,t,s)=>{s.d(t,{g:()=>u});var a=s(42977),n=s(54568),i=s(90510),l=s(60370),r=s(32987),o=s(26631);function d(){let e=(0,a._)(["\n  z-dropdown\n  bg-bg-100\n  border-0.5\n  border-border-300\n  backdrop-blur-xl\n  rounded-lg\n  min-w-[8rem]\n  overflow-hidden\n  p-1\n  text-text-200\n  shadow-element\n"]);return d=function(){return e},e}function c(e,t){if(!t)return e;if("string"==typeof t)return t;let{add:s="",remove:a=""}=t,n=a.split(" ").filter(Boolean),i=e.split(" ").filter(Boolean).filter(e=>!n.includes(e));return(0,r.A)(i,s)}function u(e){var t;let{children:s,open:a,defaultButtonLabel:i,onClickDefaultButton:d,onOpenChange:u,buttonClassName:f,triggerButtonClassName:x,wrapperClassName:h,...g}=e,p=(0,r.A)("py-1 px-2 border-r border-border-300 hover:bg-bg-200",a&&"bg-bg-200");return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(o.bL,{open:a,onOpenChange:u,children:[(0,n.jsxs)("div",{className:c("flex font-medium rounded-lg overflow-hidden border border-border-300 h-8 rounded-md whitespace-nowrap",h),children:[(0,n.jsx)("button",{className:c(p,f),onClick:d,children:i}),(0,n.jsx)(o.l9,{asChild:!0,children:(0,n.jsx)("button",{className:c("py-1 px-1 hover:bg-bg-200",x),children:(0,n.jsx)(l.biH,{size:16})})})]}),(0,n.jsx)(o.ZL,{children:(0,n.jsx)(m,{sideOffset:null!=(t=g.sideOffset)?t:4,...g,children:s})})]})})}s(7620);let m=(0,i.J)(o.UC)(d())},25243:(e,t,s)=>{s.d(t,{W:()=>n});var a=s(7620);function n(e,t,s){let n=(0,a.useRef)(void 0),i=(0,a.useCallback)(e,t),l=(0,a.useCallback)(()=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(i,s)},[i,s]);return(0,a.useEffect)(()=>{l()},[...t,i,s]),l}},28871:(e,t,s)=>{s.d(t,{p:()=>a});function a(e){let t;try{t=JSON.parse(e)}catch(e){}return t}},30453:(e,t,s)=>{s.d(t,{f:()=>c});var a=s(54568),n=s(36906),i=s(34098),l=s(41417),r=s(43989),o=s(76761),d=s(7620);let c=e=>{let{attachment:t,goBack:s,onClose:c}=e,u=(0,d.useMemo)(()=>(0,i.E)(t),[t]);return(0,a.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,a.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,a.jsx)(l.$,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,a.jsx)(r.n,{size:20})}),(0,a.jsx)("h2",{className:"font-ui tracking-tight flex-1 truncate text-lg font-medium",children:u.title}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:c,"data-testid":"close-file-preview",children:(0,a.jsx)(o.X,{size:20})})]}),(0,a.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,a.jsx)(n.G,{metaData:u.metaData}),(0,a.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},31417:(e,t,s)=>{s.d(t,{w:()=>o,y:()=>d});var a=s(77186),n=s(23661),i=s(7620);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let a=null!=(t=s.get(e.file_name))?t:[];a.push(e),s.set(e.file_name,a)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s.filter(e=>e.file_kind===n.M.Blob);return 0===a.length?null:a[a.length-1]}function o(){let e=function(){let e=(0,a.mn)();return(0,i.useCallback)(async(t,s,a,n,i)=>{let l=r(t,s);if(!l&&n){let s=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(a,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(a,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>0x80000000-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,a,n,i,r)=>{if(!n)return null;let o=function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s[s.length-1];if(a){let e=a.extracted_content;return new TextEncoder().encode(e)}return null}(t,s);return o||await e(t,a,n,i,r)},[e])}function d(e,t,s,a,n){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,a,n),[e,t,s,a,l,n])}},33792:(e,t,s)=>{s.d(t,{l:()=>a});var a=function(e){return e.Standard="Standard",e.TimelineGroup="TimelineGroup",e}({})},39741:(e,t,s)=>{s.d(t,{NotificationListener:()=>S,hG:()=>A,Wo:()=>M});var a=s(98518),n=s(1761),i=s(89598),l=s(70825),r=s(20996),o=s(9801),d=s(7620),c=s(42071),u=s(24478),m=s(27511),f=s(65988);let x=(0,u.w)("CiRhbnRocm9waWMvY2xhdWRlL3B1c2gvZW52ZWxvcGUucHJvdG8SFWFudGhyb3BpYy5jbGF1ZGUucHVzaCJfChVQdXNoT3BlcmF0aW9uRW52ZWxvcGUSDwoHc2VydmljZRgBIAEoCRIOCgZtZXRob2QYAiABKAkSJQoHcmVxdWVzdBgDIAEoCzIULmdvb2dsZS5wcm90b2J1Zi5BbnlC4wEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCDUVudmVsb3BlUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[f.f]),h=(0,m.Z)(x,0);var g=s(48021);let p=(0,u.w)("CiZhbnRocm9waWMvY2xhdWRlL3B1c2gvb3BlcmF0aW9ucy5wcm90bxIVYW50aHJvcGljLmNsYXVkZS5wdXNoIpEBCg9PcGVuQ2hhdFJlcXVlc3QSIgoMYWNjb3VudF91dWlkGAEgASgJUgxhY2NvdW50X3V1aWQSLAoRb3JnYW5pemF0aW9uX3V1aWQYAiABKAlSEW9yZ2FuaXphdGlvbl91dWlkEiwKEWNvbnZlcnNhdGlvbl91dWlkGAMgASgJUhFjb252ZXJzYXRpb25fdXVpZDJrCh1Mb2dnZWRJblB1c2hPcGVyYXRpb25zU2VydmljZRJKCghPcGVuQ2hhdBImLmFudGhyb3BpYy5jbGF1ZGUucHVzaC5PcGVuQ2hhdFJlcXVlc3QaFi5nb29nbGUucHJvdG9idWYuRW1wdHlC5QEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCD09wZXJhdGlvbnNQcm90b1ABWkFnaXRodWIuY29tL2FudGhyb3BpY3MvbW9iaWxlLWFwcHMvZ28vcHJvdG9zL2FudGhyb3BpYy9jbGF1ZGUvcHVzaKICA0FDUKoCFUFudGhyb3BpYy5DbGF1ZGUuUHVzaMoCFUFudGhyb3BpY1xDbGF1ZGVcUHVzaOICIUFudGhyb3BpY1xDbGF1ZGVcUHVzaFxHUEJNZXRhZGF0YeoCF0FudGhyb3BpYzo6Q2xhdWRlOjpQdXNoYgZwcm90bzM",[g.t]),v=(0,m.Z)(p,0);var j=s(95084),b=s(49642),y=s(66612);let w=(0,j.Iq)(p);var _=s(40459);let k={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:_.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:_.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},N="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",M=()=>{let[e,t]=(0,d.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,d.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,i.M)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},C=async(e,t)=>{if(!("Notification"in window))return!1;try{let s=await Notification.requestPermission();if(t&&t({event_key:"claudeai.notification.permission.result",permission:s}),"granted"!==s)return t&&t({event_key:"claudeai.notification.permission.result",permission:s}),!1;{let t,s;if(t=0===(0,r.Dk)().length?(0,r.Wp)(k):(0,r.Sx)(),!await (0,o.TT)())return!1;try{s=(0,o.dG)(t)}catch(e){return!1}let a=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!a&&1)try{a=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,l.Cp)(e,{tags:{action:"registerServiceWorker"}})}try{let t=await (0,o.gf)(s,{vapidKey:N,serviceWorkerRegistration:a});if(t)e(t);else throw(0,l.Cp)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,l.Cp)(e,{tags:{action:"getToken"}}),e}}return"granted"===s}catch(e){return(0,l.Cp)(e,{tags:{action:"requestPermission"}}),!1}},A=()=>{let{track:e}=(0,a.st)(),{mutate:t}=(0,c.E)();return(0,d.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await C(e=>{t({channel_type:c.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},e)),[t,e])},S=()=>{let e=(0,d.useRef)(null),{account:t}=(0,n.YL)(),{mutate:s}=(0,c.E)(),a=async()=>{let t;if(t=0===(0,r.Dk)().length?(0,r.Wp)(k):(0,r.Sx)(),!await (0,o.TT)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let s=(0,o.dG)(t);return e.current=s,{app:t,messaging:s}},i=async e=>{try{return await (0,o.gf)(e,{vapidKey:N})}catch(e){return(0,l.Cp)(e,{tags:{action:"getFCMToken"}}),null}},u=(0,d.useCallback)(e=>{s({channel_type:c.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[s]);return(0,d.useEffect)(()=>{var e;let t=!0,s=null;(async()=>{if("Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await a();if(!e||!t)return;let n=await i(e);n&&t&&u(n),s=(0,o.xD)(e,e=>{var t,s;let a=(null==(t=e.data)?void 0:t.title)||"Claude",n={body:null==(s=e.data)?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},i=new Notification(a,n);i.onclick=()=>{var t;if(window.focus(),i.close(),null==(t=e.data)?void 0:t.payload){let t=function(e){if(!e)return null;try{let t=(0,b.Rf)(h,JSON.parse(e),{registry:w});if(!t.request||!t.method)return null;if("OpenChat"===t.method){let e=(0,y.rW)(t.request,v);if(null==e?void 0:e.conversationUuid){let t=e.conversationUuid;if(t.startsWith("/code/"))return{method:"OpenChat",targetUrl:t};return{method:"OpenChat",targetUrl:"/chat/".concat(t)}}}return null}catch(e){return null}}(e.data.payload);if(t){window.location.href=t.targetUrl;return}}window.location.href="/"}})}catch(e){(0,l.Cp)(e,{tags:{action:"setupNotifications"}})}})();let n=e=>{let t=e.data;(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl)};return null==(e=navigator.serviceWorker)||e.addEventListener("message",n),()=>{var e;t=!1,s&&s(),null==(e=navigator.serviceWorker)||e.removeEventListener("message",n)}},[t,u]),null}},42071:(e,t,s)=>{s.d(t,{E:()=>u,Hg:()=>o,gT:()=>d,vn:()=>c,zZ:()=>r});var a=s(77186),n=s(1761),i=s(87606);let l="notificationPreferences";var r=function(e){return e.FCM="FCM",e.APNS="APNS",e}({});let o=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid;return(0,a.Sk)("/api/organizations/".concat(t,"/notification/preferences"),{queryKey:[l,{orgUUID:t}],enabled:!!t})},d=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUUID:t}]})}})},c=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/preferences"),"PATCH",{onSuccess:()=>{s.invalidateQueries({queryKey:[l,{orgUUID:t}]})}})},u=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:["notificationChannels",{orgUUID:t}]})},meta:{noToast:!0}})}},49146:(e,t,s)=>{s(54568)},50824:(e,t,s)=>{s.d(t,{b:()=>$});var a=s(54568),n=s(9234),i=s(2019),l=s(94390),r=s(32987),o=s(7620),d=s(7877),c=s(7726),u=s(22529),m=s(60370),f=s(21740),x=s(41417),h=s(64786),g=s(90119),p=s(27261),v=s.n(p),j=s(62971),b=s(50582),y=s(9447),w=s(98518),_=s(29242),k=s(27062),N=s(46760),M=s(79746),C=s(95675),A=s(70028),S=s(1761),E=s(51121),z=s(56370),I=s(18179),R=s(37076),T=s(9786),U=s(93681),L=s(38583),F=s(17937),O=s(83755),D=s(11582),P=s(57622),B=s(34933),W=s(11134),G=s(75032),J=s(99513),V=s(81527);function H(e){let{conversationUUID:t,snapshot:s,closeShareModal:n,showShareModal:i,disabled:l,disabledReason:r}=e,d=(0,N.A)(),u=!!s,{addError:m}=(0,E.Y)(),{account:f,activeOrganization:h}=(0,S.YL)(),g=(0,S.mV)(),p=(0,c.mz)(t),v=null==p?void 0:p.project_uuid,{data:b}=(0,V.fo)(v),y=(null==s?void 0:s.uuid)?q(s.uuid):"",{copyToClipboard:_,didCopy:k}=(0,T.C)(),{mutateAsync:M,isPending:C}=(0,c.Du)(t),{mutate:z,isPending:D}=(0,c.gG)(t,null==s?void 0:s.uuid),P=(0,o.useCallback)(async()=>{try{await M({project_uuid:null==p?void 0:p.project_uuid})}catch(e){m(d.formatMessage({defaultMessage:"Something went wrong while sharing this conversation. Please refresh the page.",id:"bMqfGRVujK"}))}},[M,m,null==p?void 0:p.project_uuid,d]),{track:B}=(0,w.st)(),W=(0,o.useCallback)(()=>{u?(B({event_key:"chat.share.modal.unshare_button.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),z()):(B({event_key:"chat.share.modal.share_button.clicked",conversation_uuid:t}),P())},[u,z,P,B,t,null==s?void 0:s.uuid]);return(0,a.jsx)(R.aF,{title:u?d.formatMessage({defaultMessage:"Chat shared",id:"svB/EMJSZy"}):d.formatMessage({defaultMessage:"Share chat",id:"bXa+lJhlYV"}),isOpen:i,onClose:n,modalSize:"lg",hasCloseButton:!0,children:f?(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)(X,{upToDate:null==s?void 0:s.up_to_date,upsertSnapshot:P,isShared:!!u,disabled:l,disabledReason:r,isRaven:g})}),(0,a.jsx)(K,{isShared:u,project:b,orgName:null==h?void 0:h.name,toggleShare:W,isRaven:g}),u&&(0,a.jsxs)("button",{className:"w-full flex items-center justify-between bg-inherit h-auto text-text-300 border border-border-300 rounded-md px-3 py-2 cursor-pointer hover:bg-bg-300/50",onClick:()=>{B({event_key:"chat.share.open_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),window.open(q((null==s?void 0:s.uuid)||""),"_blank")},children:[(0,a.jsx)("span",{className:"truncate",children:q((null==s?void 0:s.uuid)||"")}),(0,a.jsx)(U.F,{size:16})]}),!g&&(0,a.jsxs)("div",{className:"flex flex-row gap-1.5 rounded-lg bg-bg-400 p-2 text-text-300 text-xs",children:[(0,a.jsx)(L.R,{size:16,className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(j.A,{defaultMessage:"Don’t share personal information or third-party content without permission, and see our <usagePolicyLink>Usage Policy</usagePolicyLink>.",id:"RkAGrm1doc",values:{usagePolicyLink:e=>(0,a.jsx)(A.LegalLink,{type:"aup",className:"hover:text-text-100 underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-2 flex w-full items-center gap-2",children:u?(0,a.jsx)(x.$,{size:"lg",variant:k?"outline":"primary",onClick:()=>{B({event_key:"chat.share.copy_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),_(y)},prepend:k?(0,a.jsx)(F.r,{size:16}):(0,a.jsx)(O.N,{size:16}),children:k?(0,a.jsx)(j.A,{defaultMessage:"Copied",id:"p556q3uvbn"}):(0,a.jsx)(j.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}):(0,a.jsx)(x.$,{size:"lg",loading:C||D,onClick:W,children:(0,a.jsx)(j.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})]}):(0,a.jsx)("div",{className:"mb-4 mt-8 flex h-full w-full items-center justify-center",children:(0,a.jsx)(I.Loading,{})})})}let q=e=>new URL("/share/".concat(e),window.location.origin).toString();function K(e){let{isShared:t,orgName:s,project:n,toggleShare:i,isRaven:l}=e,o=(0,a.jsxs)("button",{className:(0,r.A)("border-border-300 relative flex flex-row items-center justify-between gap-2 w-full rounded-xl border text-left !py-2 !px-3",t?"!bg-bg-000 text-text-000 cursor-pointer":"text-text-300 cursor-default"),children:[(0,a.jsx)(Y,{state:t?"shared":"private",orgName:s,project:n,isRaven:l}),t&&(0,a.jsx)(G.a,{size:14,className:"right-3.5 top-3.5 text-text-000"})]});return t?(0,a.jsxs)(z.ms,{align:"start",trigger:o,children:[(0,a.jsx)(z.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(Y,{state:"private",isCurrentState:!t,orgName:s,project:n,isRaven:l})}),(0,a.jsx)(z.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(Y,{state:"shared",isCurrentState:t,orgName:s,project:n,isRaven:l})})]}):(0,a.jsx)("div",{children:o})}function Y(e){let{state:t,isCurrentState:s,orgName:n,project:i,isRaven:l}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("span",{className:"inline-flex flex-row items-center justify-between gap-3 max-w-full overflow-hidden",children:[(0,a.jsxs)("span",{className:"inline-flex flex-row items-center gap-1.5 max-w-full",children:[(0,a.jsxs)("span",{className:"text-text-300 shrink-0",children:["private"===t&&(0,a.jsx)(D.c,{size:18}),"shared"===t&&l&&(0,a.jsx)(P.m,{size:18}),"shared"===t&&!l&&(0,a.jsx)(B.q,{size:18})]}),(0,a.jsxs)("p",{className:(0,r.A)("text-ellipsis overflow-hidden",s&&"font-medium text-text-000"),children:["private"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{defaultMessage:"Private (only you have access)",id:"EsW/fizDS4"}),"\xa0",s&&"private"!==t&&(0,a.jsx)("span",{className:"text-text-300 text-sm font-normal",children:(0,a.jsx)(j.A,{defaultMessage:"(Unshare this chat)",id:"EZEp1AdoRv"})})]}),"shared"===t&&l&&(0,a.jsx)(j.A,{defaultMessage:"Shared (anyone in {scope} can view)",id:"mG1NQd3Jzv",values:{scope:(null==i?void 0:i.is_private)?i.name:n}}),"shared"===t&&!l&&(0,a.jsx)(j.A,{defaultMessage:"Public (anyone on the web can view)",id:"no0TFMuRD0"})]})]}),s&&(0,a.jsx)(J.J,{size:16,weight:"bold",className:"text-accent-secondary-100 shrink-0"})]})})}function X(e){let{upToDate:t,isShared:s,upsertSnapshot:n,disabled:i,disabledReason:l="",isRaven:r}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,a.jsx)("div",{className:"text-text-300 flex flex-row items-center gap-1 text-sm",children:s?(0,a.jsx)(a.Fragment,{children:r&&(t?(0,a.jsx)(j.A,{defaultMessage:"Future messages aren’t included",id:"YiRN6e1JBr"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{defaultMessage:"New messages since last shared",id:"RnySEeXsUF"}),(0,a.jsx)(_.m,{tooltipContent:i?l:(0,a.jsx)(j.A,{defaultMessage:"Share the most recent chat content",id:"oAf7Y+LN9j"}),children:(0,a.jsx)(x.$,{variant:"underline",size:"unset",className:"ml-1 gap-1",onClick:n,prepend:(0,a.jsx)(W.P,{}),disabled:i,children:(0,a.jsx)(j.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})]}))}):(0,a.jsx)(j.A,{defaultMessage:"Only messages up until now will be shared",id:"OUOkOQvr8p"})})})}function Z(e){let{controlsSidebarIsOpen:t,closeControlsSidebar:s,openControlsSidebar:n,conversationUUID:i,isStreaming:l,wiggleFilesCount:d=0,isTemporary:u}=e,f=(0,N.A)(),p=(0,k.fS)("claudeai_beam").value,v=(0,g.V)(h.E_),b=function(e){let{track:t}=(0,w.st)(),{data:s}=(0,c.O2)(e.conversationUUID),[a,n]=(0,o.useState)(!1),i=(0,o.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUUID}),n(!0)},[t,e.conversationUUID]),l=!!(null==s?void 0:s.snapshot),r=l||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),d=e.isStreaming||!l&&!(null==s?void 0:s.shareable);return{conversationUUID:e.conversationUUID,showShareModal:a,openShareModal:i,closeShareModal:()=>n(!1),isShared:l,showShareFlow:r,disabled:d,...s}}({conversationUUID:i,isStreaming:l}),{setIsDrawerExpanded:y}=(0,C.x)(),A=!!n&&!!s&&!t;return(0,a.jsxs)("div",{className:(0,r.A)("flex items-center gap-1","transition-opacity duration-300",t?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!A&&"hidden"),children:[b.showShareFlow&&!u&&(0,a.jsx)(M.U,{variant:"ghost",className:"font-medium text-sm !text-text-100",onClick:b.openShareModal,disabled:b.disabled||!A,prepend:(0,a.jsx)(m.SYj,{size:16,className:"mx-0.5"}),disabledReason:b.disabled_reason,children:(0,a.jsx)(j.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),d>0?(0,a.jsx)(_.m,{tooltipContent:f.formatMessage({defaultMessage:"Open sidebar",id:"+G35mRWa75"}),delayDuration:500,side:"bottom",children:(0,a.jsx)(x.$,{variant:"ghost",size:v?"icon_sm":"icon",onClick:()=>{y(!0)},disabled:!A,children:p?(0,a.jsx)(m.EZs,{}):(0,a.jsx)(m.nkM,{})})}):null,v&&(0,a.jsx)(M.U,{href:"/new",prepend:(0,a.jsx)(m.OMN,{size:16}),variant:"flat",disabled:!A,className:"ml-1",children:(0,a.jsx)(j.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),b.showShareFlow&&(0,a.jsx)(H,{...b})]})}let Q=(0,o.memo)(function(e){let{conversationUUID:t,name:s,isInteractive:n=!0,sharedBy:i,project:l,controlsSidebarIsOpen:o,openControlsSidebar:d,closeControlsSidebar:p,isStreaming:w,isSharedChat:_,wiggleFilesCount:k=0}=e,{data:N}=(0,c.Bq)(t,{enabled:!_}),M=!!l&&!l.is_harmony_project,C=(0,g.V)(h.E_);return(0,a.jsxs)(y.z,{className:(0,r.A)("h-12",!C&&"-mb-6"),contentClassName:"gap-6 pr-2",sticky:!0,children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 shrink flex-col md:flex-row md:items-center",children:[M&&(0,a.jsx)(v(),{href:"/project/".concat(l.uuid),className:"text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 max-md:font-base font-large",children:(0,a.jsxs)("div",{className:"truncate",children:[l.name," ",(0,a.jsx)("span",{className:"opacity-50",children:"/"})]})}),(0,a.jsx)("div",{className:"flex min-w-0 shrink-1 items-center max-md:font-base font-large group",children:n&&N?N.is_temporary?(0,a.jsxs)("div",{className:"flex flex-row items-center text-text-300 gap-2 cursor-default",children:[(0,a.jsx)(f.X3,{}),(0,a.jsx)(u.YX,{id:"jasmine_sapphire_rocket"})]}):(0,a.jsx)(b.p,{conversation:N,initialName:s,trigger:(0,a.jsx)(x.$,{variant:"ghost",size:"default",className:"!text-text-000 !shrink gap-1 !px-1 !py-0 !scale-100 !h-7",append:(0,a.jsx)(m.biH,{size:16}),"data-testid":"chat-menu-trigger",children:(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"truncate",children:s.length>0?s:(0,a.jsx)(j.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}):(0,a.jsx)("div",{className:"truncate",children:s.length>0?s:(0,a.jsx)(j.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,a.jsxs)("div",{className:"right-3 flex gap-2",children:[i&&(0,a.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 font-base",children:(0,a.jsx)(j.A,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!_&&(0,a.jsx)(Z,{conversationUUID:t,controlsSidebarIsOpen:o,openControlsSidebar:d,closeControlsSidebar:p,isStreaming:w,wiggleFilesCount:k,isTemporary:null==N?void 0:N.is_temporary})]})]})});function $(e){let{headerProps:t,mainElement:s,drawerElement:c,auxilaryElement:u,isDrawerOpen:m,autoscrollRef:f,autoscrollDisabled:x,leftSidebarElement:h}=e,[g,p]=(0,o.useState)(!1),v=(0,o.useRef)(null),j=(0,o.useRef)(null),b=(0,o.useRef)(null),y=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:w}=(0,C.x)(),_=(0,i.F)("md");(0,o.useEffect)(function(){let e=!0;if(!j.current||!v.current||!k.current||!b.current)return;let t=v.current,s=j.current,a=b.current;if(_){let e=m?window.innerWidth/2-d.r:s.getBoundingClientRect().width;a.style.width="".concat(e,"px")}let n=Date.now(),i=m?0:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return m&&(requestAnimationFrame(function i(){if(!e)return;let l=(Date.now()-n)/220,r=50*l;if(l>=1||!_){t.style.flex=String(50),s.style.flex=String(50),a.style.width="auto";return}t.style.flex=String(100-r),s.style.flex=String(r),requestAnimationFrame(i)}),y.current.interacted=!0),!m&&y.current.interacted&&requestAnimationFrame(function l(){if(!e)return;let r=(Date.now()-n)/220,o=i-r*i;if(r>=1||!_){t.style.flex=String(100),s.style.flex=String(0),a.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(l)}),()=>{e=!1}},[m]);let[k,N]=(0,l.w)();return(0,o.useEffect)(()=>{if(!j.current||!v.current||!k.current)return;let e=k.current.getBoundingClientRect(),t=v.current.getBoundingClientRect();if(window.innerWidth<768||t.width>420)return;let s=420/e.width*100;v.current.style.flex=String(s),j.current.style.flex=String(100-s)},[N.width,N.height,k]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,r.A)("flex flex-1 h-screen w-full overflow-hidden relative",g&&"select-none"),ref:k,onMouseUp:function(){p(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{var t;if(!g||!j.current||!v.current||!k.current)return;let s=k.current.getBoundingClientRect(),a=v.current.getBoundingClientRect(),n=(t=e.clientX-a.left,Math.min(Math.max(t,420),s.width-240)/s.width*100);v.current.style.flex=String(n),j.current.style.flex=String(100-n)},children:[h,(0,a.jsxs)("div",{ref:v,className:"h-screen flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,a.jsx)(Q,{...t}),(0,a.jsx)(n.Z,{ref:f,disabled:x,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,a.jsxs)("div",{className:(0,r.A)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!m&&"hidden"),onMouseDown:function(){p(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,a.jsx)("div",{className:(0,r.A)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",g&&"!bg-accent-secondary-000")}),(0,a.jsx)("div",{className:(0,r.A)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",g&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,a.jsx)("div",{ref:j,className:(0,r.A)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",m?"max-md:flex-1":"max-md:hidden",g&&"pointer-events-none"),style:{flex:"0 0"},children:(0,a.jsxs)("div",{ref:b,className:"flex flex-col h-full overflow-hidden",children:[(0,a.jsx)("div",{className:"h-12 md:hidden bg-bg-500 bg-opacity-60",onClick:()=>{w(!1)}}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:c})]})})]}),null!=u?u:null]})}},52450:(e,t,s)=>{s.d(t,{aS:()=>f,xW:()=>u});var a=s(42977),n=s(54568),i=s(7726),l=s(90510),r=s(41417),o=s(7620),d=s(62971);function c(){let e=(0,a._)(["\n  w-full\n  tabular-nums\n  text-left\n  text-base\n  disabled:pointer-events-none\n  disabled:shadow-none\n  disabled:drop-shadow-none"]);return c=function(){return e},e}let u=(0,o.forwardRef)((e,t)=>{let[s,a]=(0,o.useState)(!1),[l,r]=(0,o.useState)(null),{totalConversations:c,numExported:u,numFailed:f,startExporting:x}=(e=>{let[t,s]=(0,o.useState)([]),[a,n]=(0,o.useState)(null),{data:l}=(0,i.EV)({limit:i.dy,enabled:!!a}),[r,d]=(0,o.useState)([]),{data:c,error:u}=(0,i.Bq)(null!=a?a:"");return(0,o.useEffect)(()=>{if(!l)return;if(c&&c.uuid===a)t.some(e=>e.uuid===c.uuid)||s(e=>[...e,c]);else{if(!u)return;d(e=>[...e,a])}let i=l.find(e=>!t.some(t=>t.uuid===e.uuid)&&!r.includes(e.uuid));i?n(i.uuid):e(t)},[c,u,r,a,t,l,e]),{totalConversations:null==l?void 0:l.length,numExported:t.length,numFailed:r.length,startExporting:()=>{l&&l.length&&n(l[0].uuid)}}})(e=>{a(!1),r(JSON.stringify(e,null,2))});return s?(0,n.jsx)(m,{ref:t,disabled:!0,...e,children:f>0?(0,n.jsx)(d.A,{defaultMessage:"Exporting: {numExported} / {totalConversations} ({numFailed} failed)",id:"hKNwlNeKOf",values:{numExported:u,totalConversations:c,numFailed:f}}):(0,n.jsx)(d.A,{defaultMessage:"Exporting: {numExported} / {totalConversations}",id:"EAIBTT4RJD",values:{numExported:u,totalConversations:c}})}):l?(0,n.jsx)(m,{ref:t,...e,onClick:()=>{let e=new Blob([l],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="conversations.json",s.click()},children:(0,n.jsx)(d.A,{defaultMessage:"Download conversations",id:"BS3OuP1PiM"})}):(0,n.jsx)(m,{ref:t,...e,onClick:()=>{a(!0),x()},children:(0,n.jsx)(d.A,{defaultMessage:"Export conversations",id:"0GrSEx4ynQ"})})});u.displayName="ExportConversationsWidget";let m=l.J.button(c()),f=e=>{let{conversationUUID:t}=e,{data:s}=(0,i.$z)(t);return(0,n.jsx)(r.$,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="conversation.json",a.click()},children:(0,n.jsx)(d.A,{defaultMessage:"Download conversation",id:"VBmA8/nsFU"})})}},55563:(e,t,s)=>{s.d(t,{z:()=>f});var a=s(54568),n=s(56340),i=s(89697),l=s(41417),r=s(29242),o=s(9786),d=s(32987),c=s(46760),u=s(62971),m=s(92479);let f=e=>{let{className:t,code:s,codeTagProps:l,language:r,title:c}=e,{codeStyle:u}=(0,i.V)(),{didCopy:f,copyToClipboard:h}=(0,o.C)();return(0,a.jsxs)("div",{className:(0,d.A)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,a.jsx)(x,{language:r,title:c,handleCopy:()=>{h(s)},didCopy:f}),(0,a.jsx)(m.A,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:l,language:r,PreTag:"div",style:u,renderer:n.G,wrapLongLines:!0,children:s})]})},x=e=>{let{handleCopy:t,didCopy:s,language:n,title:i}=e,m=(0,c.A)();return(0,a.jsxs)("div",{className:"flex justify-between items-center h-3",children:[(0,a.jsx)("p",{className:(0,d.A)("text-text-300 text-[0.6875rem]",i?"font-ui font-medium tracking-tight":"font-mono font-[450]"),children:i||n}),(0,a.jsx)(r.m,{side:"bottom",tooltipContent:(0,a.jsx)(u.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),children:(0,a.jsx)(l.$,{"aria-label":m.formatMessage({defaultMessage:"Copy to clipboard",id:"aCdAsIsVv0"}),size:"icon_sm",variant:"ghost",className:"!-mr-1 !w-6 !h-6",onClick:t,children:(0,a.jsx)(o.u,{didCopy:s,size:12,className:"text-text-500"})})})]})}},56326:(e,t,s)=>{s.d(t,{$:()=>r,Q:()=>l});var a=s(54568),n=s(7620);let i=n.createContext({renderToolUseCell:void 0}),l=()=>n.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,n.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,a.jsx)(i.Provider,{value:l,children:s})}},58565:(e,t,s)=>{s.d(t,{A:()=>Z});var a=s(54568),n=s(27062),i=s(77101),l=s(7620),r=s(85717),o=s(43156),d=s(64039),c=s(62971);let u=()=>(0,a.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,a.jsx)(d.R,{size:24}),(0,a.jsx)("p",{className:"font-base ml-3",children:(0,a.jsx)(c.A,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var m=s(94649),f=s(11515),x=s(91961),h=s(85544),g=s(58911),p=s(75006),v=s(94748);let j=p.z.object({url:p.z.string()}),b=e=>{let t,{input:s,toolResult:n,isStreaming:i}=e,r=null==n?void 0:n.is_error,[o,d]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),p=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let s of e.content)if("text"===s.type){let e=function(e){try{return JSON.parse(e)}catch(e){return null}}(s.text);if(null===e)t.push({error_type:"UNKNOWN_ERROR",error_message:s.text});else{let s=h.kS.safeParse(e);s.success&&t.push(s.data)}}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.tD.safeParse(e);if(!t.success)return null;{let e=h.kS.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),b=function(e){switch(e){case"INVALID_URL":return(0,a.jsx)(c.A,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,a.jsx)(c.A,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,a.jsx)(c.A,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,a.jsx)(c.A,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,a.jsx)(c.A,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,a.jsx)(c.A,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,a.jsx)(c.A,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,a.jsx)(c.A,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==p?void 0:p.error_type),{data:y}=j.safeParse(s);if(!y)return;let w=y.url,_=(null==u?void 0:u.title)||w,k=(0,x.Nj)(w);return t=i?k?(0,a.jsx)(c.A,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:k}}):(0,a.jsx)(c.A,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,a.jsx)(c.A,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}):(0,a.jsx)(c.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.aX,{isError:r,errorMessage:b,text:t,secondaryText:i?void 0:k,handleClick:()=>d(!0),icon:(0,a.jsx)(f.d,{fadeInOnLoad:!0,url:w,size:16}),secondaryIcon:(0,a.jsx)(g.B,{size:16,className:"text-text-300"}),...e}),(0,a.jsx)(m.v,{isOpen:o,url:w,onClose:()=>d(!1),onConfirm:()=>{window.open(w,"_blank"),d(!1)}})]})};var y=s(33395),w=s(34059),_=s(34933),k=s(37463),N=s(45376),M=s.n(N),C=s(46760),A=s(74744),S=s(67532);function E(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let z=e=>{let{isExpanded:t,toolName:s,results:n}=e;return(null==n?void 0:n.length)?(0,a.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,a.jsx)(R,{results:n,isExpanded:t}):(0,a.jsx)(T,{results:n,isExpanded:t})}):null},I={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},R=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,a.jsx)(k.P.div,{variants:I,children:(0,a.jsx)(y.$,{disabled:!t,icon:(0,a.jsx)(f.d,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!=(s=e.knowledge.url)?s:void 0})},e.knowledge.url):null})})},T=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(k.P.div,{variants:I,children:(0,a.jsx)(U,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},U=e=>{let{disabled:t,knowledge:s}=e,n=(e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.cI)();return(0,r.yy)()?s?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED})({isError:!s});return(0,a.jsx)(A.Tc,{syncSourceType:i.v8.GDRIVE,syncStatus:n,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},L=p.z.object({query:p.z.string(),n:p.z.number().int().optional()}),F=e=>{var t;let{toolName:s,syncSourceType:n,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:d}=i,{isExpanded:c,setIsExpanded:u,snappyTransition:m}=(0,S.a)(!1,d),f=(0,C.A)(),x=null==r?void 0:r.is_error,g=x?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:E(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return M()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),a=(Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:E(e),knowledge:e}));return M()(a,e=>e.uuid)}catch(e){return[]}}(r),{data:p}=L.safeParse(l),j="web_search"===s?f.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):f.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!p)return;let b=f.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(t=null==g?void 0:g.length)?t:0}),y=!g&&o?j:p.query;return(0,a.jsx)(v.sH,{isExpandingDisabled:!!o,isExpanded:c,setIsExpanded:u,isError:x,text:y,secondaryText:o?void 0:b,icon:"web_search"===s?(0,a.jsx)(_.q,{size:16}):!!n&&(0,a.jsx)(w.A9,{type:n,size:14}),...i,children:(0,a.jsx)(v.NG,{isExpanded:c,snappyTransition:m,isScrollable:!0,children:!x&&!!(null==g?void 0:g.length)&&(0,a.jsx)(z,{isExpanded:c,toolName:s,results:g})})})};var O=s(70067);s(1761),p.z.object({prompt:p.z.string()});var D=s(33792),P=s(1336),B=s(54890),W=s(32987);function G(e){var t,s,n,i;let{input:r,toolResult:o,isStreaming:d,isLastMessage:c,onOpenArtifact:u,artifacts:m,message:f,artifactCellType:x,selectedArtifactId:h,selectedArtifactVersion:g,isFirstBlockOfMessage:p,isLastBlockOfMessage:v}=e,j=B.oE.parse(r),{versions:b,...y}=null!=(n=m[null!=(s=j.id)?s:""])?n:{},w=(0,l.useMemo)(()=>{let e=null==b?void 0:b.findIndex(e=>e.uuid===j.version_uuid);if(-1!==e)return e},[b,j.version_uuid]),_=null==(t=null!=(i=j.content)?i:j.new_str)?void 0:t.slice(0,250),k={isClosed:void 0!==o,...y,...j},N=h===k.id&&g===j.version_uuid,M="individual_cell_create"===x||"multi_edit_not_last"!==x;return(0,a.jsx)("div",{className:(0,W.A)(M&&(p?"pt-2":"pt-3"),M&&(v?"pb-2":"pb-3"),"multi_edit_not_last"===x&&"h-0"),children:(0,a.jsx)(P.uL,{versionNum:w?w+1:void 0,preview:_,versionCount:null==b?void 0:b.length,properties:k,isStreaming:d,isEdit:"individual_cell_create"!==x,isNotLastEdit:"multi_edit_not_last"===x,isLastMessage:c,onOpenArtifact:e=>{u&&u(e,f.uuid,j.version_uuid)},isExpanded:N})})}var J=s(22134);s(41417);var V=s(13625),H=s(82199),q=s(70825),K=s(55563);let Y=p.z.object({code:p.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),X=e=>{var t;let{input:s,toolResult:n,isStreaming:i,groupItemKey:r}=e,o=(0,C.A)(),{isExpanded:d,setIsExpanded:c,snappyTransition:u}=(0,S.a)(i,r),m=null!=(t=Y.parse(s).code)?t:"",{toolResultLogs:f,toolResultErrors:x}=(0,l.useMemo)(()=>n?(e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,q.Cp)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}})(n):{toolResultLogs:"",toolResultErrors:""},[n]);return(0,a.jsx)(v.sH,{isExpanded:d,setIsExpanded:c,icon:(0,a.jsx)(H.N,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,a.jsx)(v.NG,{isExpanded:d,snappyTransition:u,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)(K.z,{language:"javascript",code:m}),(0,a.jsx)(K.z,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:f}),!!x&&(0,a.jsx)(K.z,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:x,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};function Z(e){let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:d,input:c,message:m,onOpenArtifact:f,publishedArtifacts:x,toolResult:h,artifacts:g,onAllow:p,artifactCellType:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,selectedDrawerItem:_,isShared:k,displayData:N,approvalData:M,context:C,renderMode:A=D.l.Standard,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z}=e,I=(0,r.fb)(),R=(0,o.be)(),{value:T}=(0,n.fS)("prism_enabled"),U={input:c,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:A,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z,message:m};if("end_conversation"===d)return(0,a.jsx)(u,{});let L=(null==_?void 0:_.type)==="artifact"?_:void 0,P=!!h&&!!_&&"compass"===_.type&&_.data.toolUseId===h.tool_use_id;switch(d){case"artifacts":return(0,a.jsx)(G,{input:c,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:f,publishedArtifacts:x,artifacts:g,message:m,artifactCellType:v,selectedArtifactId:null==L?void 0:L.id,selectedArtifactVersion:null==L?void 0:L.versionUUID,isFirstBlockOfMessage:j,isLastBlockOfMessage:y});case"dolphin":return(0,a.jsx)(a.Fragment,{});case"repl":return(0,a.jsx)(X,{...U});case"drive_search":if(!I)break;return(0,a.jsx)(F,{syncSourceType:i.v8.GDRIVE,toolName:d,...U});case"web_search":if(!R)break;return(0,a.jsx)(F,{toolName:d,...U});case"web_fetch":return(0,a.jsx)(b,{...U});case"launch_extended_search_task":return(0,a.jsx)(O.wD,{toolUseId:t,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,toolResult:h,isShared:k,isExpanded:P,isStreaming:l,context:C})}let B=d.includes(":");return!B&&(null==N?void 0:N.integrationName)?(0,a.jsx)(J.K,{...N,toolName:d,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:A,groupItemKey:S,isFirstItemInGroup:E,isLastItemInGroup:z}):(0,a.jsx)(V.d,{toolName:B?d.split(":")[1]:d,integrationName:null==N?void 0:N.integrationName,integrationIcon:null==N?void 0:N.integrationIcon,approvalData:M,...U})}s(37711),p.z.object({returncode:p.z.number().int(),stdout:p.z.string(),stderr:p.z.string()}),s(60370),s(95675),s(56273),s(49146)},65755:(e,t,s)=>{s.d(t,{u:()=>l});var a=s(40169),n=s(7904),i=s(57259);function l(e){let t=e.trim();return(0,a.yt)(t,{extensions:[(0,n.x)()],htmlExtensions:[(0,i.k)()]})}},67532:(e,t,s)=>{s.d(t,{a:()=>i});var a=s(7620),n=s(11480);let i=(e,t)=>{let s=(0,a.useRef)(!!e),[i,l]=(0,a.useState)(!!e),[r,o]=(0,a.useState)(!e),{expandedItemKey:d,setExpandedItemKey:c}=(0,n.D8)(),u=t&&c,m=(0,a.useCallback)(e=>{u&&c(e?t:void 0),l(e)},[u,c,l,t]),f=u?d===t:i;return(0,a.useEffect)(()=>{!e&&s.current&&setTimeout(()=>{l(!1),setTimeout(()=>{o(!0)},600)},2e3)},[e]),{isExpanded:f,setIsExpanded:m,snappyTransition:r}}},70067:(e,t,s)=>{s.d(t,{wD:()=>P,z7:()=>D});var a=s(54568),n=s(94275),i=s.n(n),l=s(8027),r=s(11515),o=s(77186),d=s(1761),c=s(41417),u=s(37076),m=s(98411),f=s(37711),x=s(98769),h=s(27062),g=s(85544),p=s(4705),v=s(67902),j=s(32987),b=s(37463),y=s(49645),w=s(7620),_=s(46760),k=s(62971),N=s(75006),M=s(92947),C=s(73325),A=s(93271),S=s(73817),E=s(38807),z=s(16310),I=s(33562);function R(e){let{onCancel:t,onConfirm:s}=e,n=(0,w.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,z.$3)(),r=(0,I.Cn)({setMcpDirectoryModalIsOpen:T,setStyleModalOpenWithScreen:T,setCreateProjectModalIsOpen:T,setGithubModalIsOpen:T,setGmailAuthModalIsOpen:T,setCreatePromptArgumentModalIsOpen:T}),o=(0,E._9)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,w.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()})},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(u.aF,{isOpen:!0,modalSize:"2lg",onClose:t,className:"!px-4 !py-6",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:(0,a.jsx)(k.A,{defaultMessage:"Enable integrations for Claude to use in research",id:"OW3ZJC49V0"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.s,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,a.jsx)(A.$,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key,countDisplayVariant:"verbose"},e.key))]}),(0,a.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,a.jsx)(k.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,a.jsx)("a",{href:"https://support.anthropic.com/",className:"underline",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-2 mt-4",children:[(0,a.jsx)(c.$,{variant:"outline",onClick:t,children:(0,a.jsx)(k.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsxs)(c.$,{ref:n,onClick:function(){s({tools:l()})},children:[(0,a.jsx)(k.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,a.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,a.jsx)(C.y,{size:12})})]})]})]})})})}function T(){}var U=s(95675),L=s(56273),F=s(84137),O=s(73347);let D=N.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},N.z.object({task_id:N.z.string()}));function P(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:n=!1,conversationUUID:i,toolResult:l,isShared:r,isExpanded:c=!1,isStreaming:u=!1,context:m}=e,{value:f}=(0,h.fS)("papi_mcp"),{activeOrganization:x}=(0,d.YL)(),{dispatchChatResource:p}=(0,L.i)(),{setIsDrawerExpanded:v}=(0,U.x)(),{decisionState:b,approveTool:y,denyTool:k}=function(e,t,s,a){let[n,i]=(0,w.useState)("pending"),l=!!(e&&t&&a),{isPending:r}=(0,o.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:l}),d=(0,o.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!r),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:r,approveTool:(0,w.useCallback)(e=>{let{tools:t}=e;d({tool_use_id:s,is_approved:!0,params:{tools:t}})},[d,s]),denyTool:(0,w.useCallback)(()=>{d({tool_use_id:s,is_approved:!1})},[d,s])}}(null==x?void 0:x.uuid,i,t,u),N=u?"approved"===b:l&&!(null==l?void 0:l.is_error),M=f&&(null==m?void 0:m.tools.length)&&u&&"pending"===b,C=(0,w.useMemo)(()=>{if(!(null==l?void 0:l.content))return;let e=l.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=D.safeParse(e);return null==t?void 0:t.task_id},[null==l?void 0:l.content]),{compassStatus:A,isLoading:S,error:E}=(0,F.CH)({organizationUUID:null==x?void 0:x.uuid,conversationUUID:i,taskId:C,isShared:r,enabled:N});(0,F.IK)(i,null==A?void 0:A.status);let z=!A,I=(0,w.useCallback)(()=>{z||(v(!0),p({type:"OPEN_COMPASS_STATUS",data:{conversationUUID:i,organizationUUID:null==x?void 0:x.uuid,isShared:r,toolUseId:null==l?void 0:l.tool_use_id,taskId:C}}))},[z,p,i,null==x?void 0:x.uuid,v,r,l,C]),T=(null==A?void 0:A.status)||g.zu.Starting,O=!!E||!!(null==l?void 0:l.is_error),P=(0,_.A)(),{title:B,subtitle:J}=(0,w.useMemo)(()=>{let e,t;if(O)return{title:P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})};let s=(null==A?void 0:A.total_sources)||0,a=0===s?P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:s}),n=P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:s}),i=(0,F.Ui)(A),l=i||P.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),r=i||P.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(T){case g.zu.Starting:{let t=[P.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),P.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),P.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),P.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),P.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),P.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),P.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),P.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),P.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),P.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),P.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case g.zu.Planning:e=l,t=P.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case g.zu.InitiatingAgents:e=l,t=P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case g.zu.Searching:e=l,t=a;break;case g.zu.CreatingArtifact:e=l,t=P.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case g.zu.Completed:t=n,e=r;break;case g.zu.Cancelled:e=l,t=P.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case g.zu.TimedOut:case g.zu.Failed:e=P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),t=n}return{title:e,subtitle:t}},[P,T,A,O]);return M&&(null==m?void 0:m.use_finegrained_approval)?(0,a.jsx)(R,{onCancel:k,onConfirm:e=>{let{tools:t}=e;y({tools:t})}}):M?(0,a.jsx)(V,{tools:m.tools,onCancel:k,onApprove:()=>{y({tools:[]})}}):(0,a.jsx)("div",{className:(0,j.A)("my-3",s?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:S?(0,a.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui tracking-tight rounded-xl border border-border-300 shadow-xs",children:[(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,a.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,a.jsxs)("button",{className:(0,j.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui tracking-tight rounded-xl border shadow-xs overflow-hidden",!z&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",c?"!border-accent-secondary-200":"border-border-300"),disabled:z,onClick:I,children:[(0,a.jsx)(W,{title:B,compassStatus:A,useShimmer:T===g.zu.Starting,isError:O||T===g.zu.Failed||T===g.zu.TimedOut,isExpanded:c}),(0,a.jsx)(G,{subtitle:J,compassStatus:A,isError:T===g.zu.Cancelled,useShimmer:!c&&!!A&&![g.zu.CreatingArtifact,g.zu.Completed,g.zu.Cancelled,g.zu.TimedOut,g.zu.Failed].includes(A.status)})]})})}function B(e){let{className:t,text:s,useShimmer:n}=e,[l,r]=(0,w.useState)(s),[o,d]=(0,w.useState)(!1),[c,u]=(0,w.useState)("");return(0,w.useEffect)(()=>{if(s!==l){u(l),r(s),d(!0);let e=setTimeout(()=>{d(!1)},300);return()=>clearTimeout(e)}},[s,l]),(0,a.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,j.A)("relative overflow-hidden",t)||""),children:[(0,a.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@keyframes slideUpFadeOut{0%{transform:translatey(0);opacity:1}100%{transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeIn{0%{transform:translatey(100%);opacity:0}100%{transform:translatey(0);opacity:1}}"}),o&&(0,a.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(f.N,{children:c}):c}),(0,a.jsx)("div",{style:o?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(f.N,{children:l}):l})]})}function W(e){let{title:t,isError:s,compassStatus:n,useShimmer:i,isExpanded:l}=e,[r,o]=(0,w.useState)(!1),d=(0,F.Nw)(n),c=(0,w.useRef)(d);(0,w.useEffect)(()=>{d&&!c.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*d.length+.5),c.current=d)},[d]);let u=!l&&r;return(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,a.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[u&&!!d&&(0,a.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,a.jsx)(J,{thought:d})}),(0,a.jsx)(y.N,{initial:!1,children:!(u&&d)&&(0,a.jsxs)(b.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:x.A.inOutQuart},className:(0,j.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,a.jsx)(p.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,a.jsx)("p",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,a.jsx)(B,{text:t,useShimmer:!!i&&!s})})]})})]}),!!n&&(0,a.jsx)(v.K,{size:12,className:"text-text-500 mt-4"})]})}function G(e){var t,s;let{subtitle:n,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,w.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,F.mk)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return n?(0,a.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,a.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,a.jsx)(F.mq,{hrefs:o})}),(null==l?void 0:l.status)===g.zu.Completed&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,a.jsx)(B,{text:n,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,a.jsx)("div",{className:"text-text-500",children:(0,a.jsx)(F.YE,{startedAt:null!=(t=null==l?void 0:l.started_at)?t:null,completedAt:null!=(s=null==l?void 0:l.finished_at)?s:null})})]})]}):null}function J(e){let{thought:t}=e;return(0,a.jsx)("div",{className:"h-9 w-full",children:(0,a.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,a.jsx)(b.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:x.A.inOutBase},children:(0,a.jsx)(F.GT,{thought:t})})})})}function V(e){let{tools:t,onCancel:s,onApprove:n}=e,{servers:i}=(0,M.gt)();return(0,a.jsx)(u.aF,{modalSize:"xl",isOpen:!0,onClose:s,title:(0,a.jsx)(k.A,{defaultMessage:"Claude may use the following custom integrations while researching",id:"OKJu4YENMc"}),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 rounded-lg my-4 relative",children:[(0,a.jsx)("div",{className:"flex flex-col gap-4 p-4 max-h-[300px] overflow-y-auto",children:i.map(e=>{let s=t.filter(t=>t.server_uuid===e.uuid).map(e=>e.tool_name),n=e.tools.filter(e=>s.includes(e.name));return n.length?n.map(t=>(0,a.jsx)(m.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,a.jsx)(r.d,{url:e.url,fallbackSvg:(0,a.jsx)(l.B,{letter:e.name,size:30,fontSize:11,className:"shrink-0 font-medium mt-1"}),size:30}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"text-sm font-mono",style:{fontWeight:700},children:t.name}),(0,a.jsx)(O.M,{text:t.description,className:"text-[0.9rem] !text-text-500"})]})]})},t.name)):null})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-2 right-2 h-6 bg-gradient-to-t from-bg-200 to-bg-200/0 pointer-events-none z-10"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-accent-secondary-900 rounded-lg bg-accent-secondary-900/30",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(p.N,{className:"text-accent-secondary-000",size:16,weight:"bold"}),(0,a.jsx)("h4",{className:"text-accent-secondary-000 font-medium",children:(0,a.jsx)(k.A,{defaultMessage:"You are enabling Claude to retrieve content from your connected apps.",id:"RPQTc1f34V"})})]}),(0,a.jsx)("p",{className:"text-text-300",children:(0,a.jsx)(k.A,{defaultMessage:"Please ensure you have all appropriate permissions and trust these tools before continuing. <link>Learn more</link> about safely using Research with connected apps.",id:"b86SF7HKhH",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/11175166-about-custom-integrations-using-remote-mcp",target:"_blank",rel:"noopener noreferrer",children:e})}})})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(c.$,{variant:"outline",onClick:s,children:(0,a.jsx)(k.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,a.jsx)(c.$,{onClick:n,children:(0,a.jsx)(k.A,{defaultMessage:"Research with {count, plural, one {# tool} other {# tools}}",id:"H0wjvrIsuM",values:{count:t.length}})})]})]})})}},77336:(e,t,s)=>{s.d(t,{E:()=>n,V:()=>i});var a=s(7620);function n(e){let t=[];for(let a of e){var s;for(let e of null!=(s=a.files_v2)?s:a.files)"file_kind"in e&&t.push(e)}return t}let i=e=>(0,a.useMemo)(()=>n(e),[e])},79746:(e,t,s)=>{s.d(t,{U:()=>d});var a=s(54568),n=s(41417),i=s(29242),l=s(64786),r=s(90119),o=s(46760);function d(e){let{children:t,disabledReason:s,...d}=e,c=(0,r.V)(l.E_),u=(0,o.A)(),m={defaultMessage:t.props.defaultMessage,id:t.props.id};if(!c)return(0,a.jsx)(i.m,{tooltipContent:s,side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{...d,children:t})})});let f=u.formatMessage(m);return(0,a.jsx)(i.m,{tooltipContent:null!=s?s:f,side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{...d,size:"icon_sm"})})})}},80566:(e,t,s)=>{s.d(t,{CV:()=>eo});var a=s(42977),n=s(54568),i=s(68096),l=s(57931),r=s(27143),o=s(57067),d=s(98518),c=s(1761),u=s(51121),m=s(9537),f=s(90510),x=s(60370),h=s(41417),g=s(56370),p=s(24934),v=s(18179),j=s(37076),b=s(29242),y=s(9786),w=s(54890),_=s(64786),k=s(90119),N=s(61670),M=s(32987),C=s(49645),A=s(37463),S=s(20591),E=s.n(S),z=s(27261),I=s.n(z),R=s(7620),T=s(62971),U=s(46760),L=s(93901),F=s(41932),O=s(81527),D=s(56273),P=s(65755),B=s(42153),W=s(67048),G=s(7845);function J(){let e=(0,a._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return J=function(){return e},e}function V(e){let t,{onClose:s,onSubmitRating:a,onSubmitNotes:i}=e,l=(0,U.A)(),[r,o]=(0,R.useState)(!1),[d,c]=(0,R.useState)(""),u=e=>{a(e),o(!0)},f=()=>{s()};return t=r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("div",{className:"ml-1",children:(0,n.jsx)(T.A,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsx)("button",{onClick:f,children:(0,n.jsx)(B.X,{size:20})})})]}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(d),f()},children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(m.ks,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:d,onChange:e=>c(e.target.value)})}),(0,n.jsx)("div",{children:(0,n.jsx)(h.$,{variant:"primary",type:"submit",children:(0,n.jsx)(T.A,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(T.A,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,n.jsx)(W.t,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,n.jsx)(G.S,{size:20})}),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:f,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,n.jsx)(B.X,{size:20})})]})]}),(0,n.jsxs)(H,{children:[(0,n.jsx)("div",{className:"p-3",children:t}),(0,n.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,n.jsx)("a",{className:"hover:underline",href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,n.jsx)(T.A,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let H=f.J.div(J());var q=s(66849),K=s(26631);let Y=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:a}=e,i=(0,R.useCallback)(()=>{a(!1)},[a]),{chatResourceState:{artifacts:l},dispatchChatResource:r}=(0,D.i)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),d=(0,R.useRef)(t),c=(0,R.useRef)(!1),u=(0,R.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUUID:e.versions[e.versions.length-1].uuid})})},[r]);(0,R.useEffect)(()=>{let e=d.current;return()=>{e&&!c.current&&(null==t?void 0:t.id)!==e.id&&u(e),c.current=!1}},[]);let m=(0,q.w)(),f=(0,U.A)();return o.length<2?null:(0,n.jsxs)(K.bL,{open:s,onOpenChange:e=>a(e),children:[(0,n.jsx)(K.l9,{asChild:!0,children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,n.jsx)(b.m,{side:"right",className:"ml-2",tooltipContent:s?"":f.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,n.jsx)(x.zDc,{size:20})})})}),(0,n.jsx)(K.UC,{align:"start",asChild:!0,children:(0,n.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>d.current&&u(d.current),children:o.map((e,t)=>{var s;let a=e.type?m[e.type]:null,l=(null==(s=d.current)?void 0:s.id)===e.id,r=f.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),x=e.versions.length>1?"".concat(e.versions.length):"",h=e.versions.length>1&&a?" \xb7 ":"";return(0,n.jsx)(A.P.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,n.jsxs)(K.q7,{className:(0,M.A)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",l?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>(e=>{c.current=!0,i();let t=o[e];d.current=t,u(t)})(t),onMouseEnter:()=>{u(e)},"aria-label":"".concat(e.title).concat(a?", ".concat(a):"").concat(x?", ".concat(x," ").concat(r):""),children:[(0,n.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,n.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,n.jsxs)(n.Fragment,{children:[x," ",r]}):null,h?(0,n.jsx)(n.Fragment,{children:h}):null,a]})]},e.id)},e.id)})})})]})};var X=s(96900),Z=s(10158),Q=s(91961);s(92012);var $=s(61773);let ee=e=>{var t;let{artifact:s,selectedVersion:a,messageUuid:i,isOpen:r,richSandboxRef:o,copyToClipboard:c}=e,{track:u}=(0,d.st)(),{publishedArtifactsBaseUrl:m}=(0,Z._r)(),{mutateAsync:f,isPending:g}=(0,l.yx)(),[p,v]=(0,R.useState)(),j=(0,R.useCallback)(async()=>{var e;let t=await (null==(e=o.current)?void 0:e.getScreenshot());t&&v(t)},[o]);return(0,R.useEffect)(()=>{r&&o.current&&j()},[o,r,j]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,n.jsx)("p",{children:(0,n.jsx)(T.A,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet and potentially visible in search engine results. Your chat will remain private.",id:"zG4O5rdNXZ"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[(0,n.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,n.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[p?(0,n.jsx)("img",{src:p,alt:s.title,className:"w-full h-auto bg-always-white"}):(0,n.jsx)($.default,{src:"/images/claude_ogimage.png",alt:s.title,className:"w-full h-auto",width:1138,height:640}),!p&&(0,n.jsx)(en,{handleCapture:()=>void j()})]}),p&&(0,n.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,n.jsx)(ea,{handleRemove:()=>v(void 0)})})]}),(0,n.jsx)("div",{children:null!=(t=s.title)?t:(0,n.jsx)(T.A,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,n.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,n.jsx)(x.R2D,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)("span",{children:(0,n.jsx)(T.A,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Don’t share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,n.jsx)(I(),{href:"https://www.anthropic.com/legal/aup",target:"_blank",className:"underline",children:e})}})})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(h.$,{size:"lg",loading:g,onClick:()=>{var e;f({title:s.title,artifact_type:s.type,code_language:s.language,message_uuid:i,artifact_identifier:s.id,content:null!=(e=s.versions[a].resultState)?e:"",screenshot:p,artifact_version_uuid:s.versions[a].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return c("".concat(m,"/public/artifacts/").concat(t))}),u({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:i,artifact_type:null==s?void 0:s.type,artifact_language:null==s?void 0:s.language})},children:(0,n.jsx)(T.A,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})},et=e=>{let{artifactUuid:t,publishedLink:s,didCopy:a,copyToClipboard:i,onClose:r}=e,{mutateAsync:o,isPending:d}=(0,l.lT)(t),c=async()=>{await o({}),r()};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(x.qzq,{className:"mt-1",size:16})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(T.A,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,n.jsx)("p",{className:"text-text-300 tracking-tight",children:(0,n.jsx)(T.A,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(I(),{className:"text-text-300 truncate text-sm",href:s,children:s}),(0,n.jsx)("div",{children:(0,n.jsx)(h.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{i(s)},prepend:a?(0,n.jsx)(x.rAV,{size:16}):(0,n.jsx)(x.Xq1,{size:16}),children:a?(0,n.jsx)(T.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)(T.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(h.$,{size:"lg",variant:"secondary",loading:d,onClick:c,children:(0,n.jsx)(T.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,n.jsxs)("p",{className:"text-text-400 text-xs tracking-tight",children:[(0,n.jsx)(T.A,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,n.jsx)("br",{}),(0,n.jsx)(T.A,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]})},es=e=>{let t,s,{onClose:a,isOpen:i,artifact:l,selectedVersion:r,messageUuid:o,publishedArtifactUuid:d,richSandboxRef:c}=e,u=(0,U.A)(),{publishedArtifactsBaseUrl:m,publishedArtifactsEmbedBaseUrl:f}=(0,Z._r)(),x=!!d,[h,g]=(0,R.useState)(!1),p="".concat(m,"/public/artifacts/").concat(d);"".concat(f,"/public/artifacts/").concat(d,"/embed");let[v,b]=(0,R.useState)("");(0,R.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>b(""),5e3);return()=>clearTimeout(e)},[v]);let{copyToClipboard:w,didCopy:_}=(0,y.C)(),k=x?"shared":"private",N=(0,R.useRef)(k);N.current!==k&&("private"===k&&b(u.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),N.current=k);let M=()=>{b(""),g(!1),a()};return h?(t=(0,n.jsx)(n.Fragment,{children:""}),s=(0,n.jsx)(n.Fragment,{children:""})):x?(t=(0,n.jsx)(T.A,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}),s=(0,n.jsx)(et,{artifactUuid:null!=d?d:"",publishedLink:p,didCopy:_,copyToClipboard:w,onClose:M})):(t=(0,n.jsx)(T.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"}),s=(0,n.jsx)(ee,{artifact:l,selectedVersion:r,messageUuid:o,isOpen:i,richSandboxRef:c,copyToClipboard:w})),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(j.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:t}),isOpen:i,onClose:M,modalSize:"lg",hasCloseButton:!0,children:[(0,n.jsxs)("div",{className:"mt-2 flex flex-col gap-2.5",children:[v&&(0,n.jsx)("div",{className:"bg-accent-secondary-900 text-accent-secondary-000 rounded-lg px-3 py-2 text-sm",children:v}),s]}),""]})})},ea=e=>{let{handleRemove:t}=e;return(0,n.jsx)(b.m,{tooltipContent:(0,n.jsx)(T.A,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,n.jsx)("button",{className:(0,M.A)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,Q.Fr)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,n.jsx)(x.X,{size:12})})})},en=e=>{let{handleCapture:t}=e;return(0,n.jsx)("div",{className:"absolute inset-0 items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,n.jsx)(b.m,{tooltipContent:(0,n.jsx)(T.A,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,n.jsx)(h.$,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,n.jsx)(x.i7d,{})})})})};async function ei(e){if(e.type!==w.vU.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return new Promise((s,a)=>{try{var n;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null==(n=l.contentWindow)?void 0:n.document);if(!r){document.body.removeChild(l),a(Error("Could not access iframe document"));return}let o=(null==e?void 0:e.title)||"Artifact";r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(o,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                * Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(t.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let d=document.title,c=()=>{try{document.title=d,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var t,n;document.title="".concat((null==e?void 0:e.title)||"Markdown Artifact");try{null==(t=l.contentWindow)||t.print()}catch(e){null==(n=l.contentDocument)||n.execCommand("print")}setTimeout(()=>{c(),s()},100)}catch(e){c(),a(e)}},l.onerror=e=>{c(),a(e)}}catch(e){a(e)}})}function el(){let e=(0,a._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return el=function(){return e},e}function er(){let e=(0,a._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return er=function(){return e},e}let eo=e=>{var t,s,a,u,m,f,x,h,g,p,v;let{onClose:j,artifact:b,isStreaming:y,selectedArtifactMessageUUID:_,selectedArtifactVersionUUID:k,setSelectedArtifactVersionUUID:S,projectUuid:E,selectDoc:z,disablePublishing:I,sendMessage:T,richSandboxCapabilities:U,isOpen:F,isTemporary:P=!1}=e,{account:B}=(0,c.YL)(),W=(0,d.st)(),[G,J]=(0,R.useState)("normal"),H=(0,R.useRef)(null),[q,K]=(0,R.useState)(!1),Y=(0,c.mV)(),[Z,Q]=(0,R.useState)(!0),{data:$}=(0,O.fo)(E),{data:ee}=(0,L.m)({entityId:k,artifactEntityType:"artifact_version"}),et=(0,R.useMemo)(()=>(null==ee?void 0:ee.mcp_servers)||[],[ee]),ea=!I&&!Y,[en,{open:ei,close:el}]=(0,N.j)(!1),er=(0,R.useCallback)(()=>{Q(!1)},[]),{data:eo}=(0,l.rC)({includeDeletedArtifacts:!0}),ec=y&&!(null==b||null==(t=b.versions[b.versions.length-1])?void 0:t.isClosed),em=(0,R.useMemo)(()=>{if(!b)return 0;if(!ec&&k&&_!==o.gv){let e=b.versions.findIndex(e=>e.uuid===k);if(-1!==e)return e}return!ec&&_&&_!==o.gv?b.versions.findIndex(e=>e.message===_):b.versions.length-1},[_,k,ec,b]),ef=null==b||null==(s=b.versions[em])?void 0:s.uuid;(0,R.useEffect)(()=>{ef&&ef!==k&&S(ef),J("normal")},[null==b?void 0:b.id,ef,S,k]);let ex=Y&&!P,[eh,{open:eg,close:ep}]=(0,N.j)(!1),ev=b&&(null==eo||null==(a=eo.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===b.id&&s===b.versions[em].message}))?void 0:a.published_artifact_uuid),ej=null!=(h=null==eo?void 0:eo.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ev&&s}))&&h,eb=null==b||null==(u=b.versions[em])?void 0:u.message,[ey,ew]=(0,R.useState)(!1);(0,R.useEffect)(()=>ew(ey||y),[ey,y]);let[e_,ek]=(0,R.useState)(!1);(0,R.useEffect)(()=>ek(!1),[_,eb]);let[eN,eM]=(0,R.useState)(!1),{data:eC}=(0,l.SN)(),{mutate:eA}=(0,i.Jy)(),{track:eS}=(0,d.st)(),eE=null!=(g=(0,D.i)().chatResourceState.conversationUUID)?g:"",{mutateAsync:ez}=(0,l._2)(eE),eI=(0,R.useCallback)(async()=>{if(!k)try{var e;let{artifactVersionUUID:t}=await ez({version_index:em,artifact_identifier:null!=(e=null==b?void 0:b.id)?e:""});S(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}eS({event_key:"artifact.share_button_clicked",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eg()},[k,eg,ez,em,null==b?void 0:b.id,S,eS,eb,null==b?void 0:b.type,null==b?void 0:b.language]),eR=(0,R.useCallback)(()=>{eS({event_key:"artifact.publish_button_clicked",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),ei()},[ei,eS,eb,null==b?void 0:b.type,null==b?void 0:b.language]),eT=(null==b?void 0:b.type)===w.vU.Text,eU=(null==b?void 0:b.type)===w.vU.Markdown||(null==b?void 0:b.type)===w.vU.Code,eL=(null==b?void 0:b.type)===w.vU.Html||(null==b?void 0:b.type)===w.vU.React,eF=(null==b?void 0:b.type)!==w.vU.Text&&!(ec&&((null==b?void 0:b.type)===w.vU.Svg||(null==b?void 0:b.type)===w.vU.Mermaid||(null==b?void 0:b.type)===w.vU.React||(null==b?void 0:b.type)===w.vU.Html)),eO=!eF||"raw"===G,eD=e_||ey&&!y&&!eN&&!(null==B?void 0:B.settings.dismissed_artifact_feedback_form)&&eC,eP=null!=(p=null==b?void 0:b.versions.length)?p:0,[eB,eW]=(0,R.useState)(!1),eG=E&&b?{show:!ec&&!(null==$?void 0:$.is_starter_project),artifact:b,projectUuid:E,selectedVersion:em,selectDoc:z}:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)(b?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eB&&eW(!1),children:[(0,n.jsx)(ed,{versionCount:eP,selectedVersion:em,artifact:b,canRenderNormal:eF,canOnlyRenderRaw:eT,canOnlyRenderNormal:eU,viewing:G,setViewing:J,showRaw:eO,canRefresh:eL,isSandboxLoading:Z,handleRefresh:()=>{Q(!0),H.current&&H.current.refresh()},canShare:ex,handleOpenShareModal:eI,isStreaming:y,onClose:j,hasMenuOpen:eB,setHasMenuOpen:eW,canPublish:ea,wasUnpublished:ej,publishedArtifactUuid:ev,openPublishModal:eR,projectParams:eG,richSandboxRef:H,hasArtifactToolConfig:!!(null==ee||null==(m=ee.mcp_servers)?void 0:m.length),setShowArtifactMcpModal:K,handleVersionSelect:e=>{let t=null==b?void 0:b.versions[e].uuid;t&&S(t)}}),(0,n.jsx)(r.k,{isOpen:F,content:null!=(v=null==b||null==(f=b.versions[em])?void 0:f.resultState)?v:"",type:null==b?void 0:b.type,citations:null==b||null==(x=b.versions[em])?void 0:x.citations,language:void 0===b?void 0:b.language||w.K5[b.type].syntaxName,showRaw:eO,richSandboxRef:H,isCurrentStreaming:ec,isChatStreaming:y,onSandboxConfirmation:er,sendMessage:T,richSandboxCapabilities:U,isLatestVersion:!!b&&em===b.versions.length-1,artifactId:null==b?void 0:b.id,artifactContext:k?{uuid:k,type:"artifact_version"}:void 0,artifactVersion:em,onArtifactRuntimeError:e=>{W.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==k?void 0:k.toString(),error_type:e.type,source:null==b?void 0:b.versions[em].source})},artifact:b,hasMenuOpen:eB,ArtifactMcpModal:X.I}),(0,n.jsx)(C.N,{children:eD&&(0,n.jsx)(A.P.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,n.jsx)("div",{children:(0,n.jsx)(V,{onSubmitNotes:e=>{eS({event_key:"artifact.feedback.note",note:e,message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),ek(!1)},onSubmitRating:e=>{eS({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:eb,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eA({...null==B?void 0:B.settings,dismissed_artifact_feedback_form:!0}),ek(!0)},onClose:()=>{eM(!0),eA({...null==B?void 0:B.settings,dismissed_artifact_feedback_form:!0}),ek(!1)}})})})})]}),(null==b?void 0:b.versions[em])&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(es,{messageUuid:b.versions[em].message,isOpen:en&&!ej,onClose:el,artifact:b,selectedVersion:em,publishedArtifactUuid:ev,richSandboxRef:H}),ex&&k&&(0,n.jsx)(eu,{isOpen:eh,onClose:ep,artifactVersionUuid:k,artifact:b,messageUuid:b.versions[em].message,isProjectArtifact:!!(null==$?void 0:$.is_private)})]}),q&&k&&(0,n.jsx)(X.I,{isOpen:q,requestedServers:et,onClose:()=>K(!1),artifactContext:{uuid:k,type:"artifact_version"}})]})};function ed(e){var t;let{versionCount:s,selectedVersion:a,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:d,setViewing:c,showRaw:f,canRefresh:j,isSandboxLoading:N,handleRefresh:C,canShare:A,handleOpenShareModal:S,isStreaming:z,canPublish:I,wasUnpublished:L,publishedArtifactUuid:O,projectParams:D,onClose:B,openPublishModal:W,handleVersionSelect:G,hasMenuOpen:J,setHasMenuOpen:V,richSandboxRef:H,hasArtifactToolConfig:q,setShowArtifactMcpModal:K}=e,X=(0,U.A)(),Z=(0,k.V)(_.E_),{copyToClipboard:Q,didCopy:$}=(0,y.C)(),{copyToProject:ee,isCopiedToProject:et}=function(e){let{projectUuid:t,artifact:s,selectedVersion:a}=e,[i,l]=(0,R.useState)(!1),{mutateAsync:r,data:o}=(0,F.fh)(null!=t?t:""),{addError:d}=(0,u.Y)();return(0,R.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(w.K5[s.type].extension()),content:null!=(e=s.versions[a].resultState)?e:""})}catch(e){d((0,n.jsx)(T.A,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}))}},isCopiedToProject:i}}({artifact:i,projectUuid:null!=(t=null==D?void 0:D.projectUuid)?t:"",selectedVersion:a});async function es(){var e,t;if(!i)return;let s=i.type===w.vU.Markdown,n=i.type===w.vU.React,l=null!=(e=i.versions[a].resultState)?e:"";if(n&&H.current){let e=await (null==(t=H.current)?void 0:t.copyHtmlContent());e?await Q({text:e,html:e}):await Q(l)}else if(s)try{let e=(0,P.u)(l);await Q({text:l,html:e})}catch(e){await Q(l)}else await Q(l)}let{ref:ea,width:en}=function(){let e=(0,R.useRef)(null),[t,s]=(0,R.useState)(()=>{var t,s;return null!=(s=null==(t=e.current)?void 0:t.offsetWidth)?s:null});return(0,R.useEffect)(()=>{let t=E()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),a=new ResizeObserver(t);if(e.current){let s=e.current;return t(),a.observe(s),()=>a.disconnect()}},[]),{ref:e,width:t}}(),el=en&&en<480,er=!f&&j,{addError:eo}=(0,u.Y)(),ed=(null==i?void 0:i.type)===w.vU.Markdown&&"raw"!==d?(0,n.jsx)(g.tJ,{onSelect:async()=>{try{await ei(i)}catch(e){eo((0,n.jsx)(T.A,{defaultMessage:"Error saving as PDF",id:"kemaiSh7+2"}))}},children:(0,n.jsx)(T.A,{defaultMessage:"Save as PDF",id:"rv9NrWszM1"})},"saveAsPdf"):null,eu=i?(0,n.jsx)(g.tJ,{asChild:!0,"data-testid":"export-download",children:(0,n.jsx)(ec,{artifact:i,selectedVersion:a})},"download"):null;return(0,n.jsxs)("div",{ref:ea,className:(0,M.A)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",Z?[_.X_,_.zo,"draggable"]:"py-2"),children:[i&&(0,n.jsx)(Y,{currentArtifact:i,hasMenuOpen:J,setHasMenuOpen:V}),J?(0,n.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,n.jsx)(T.A,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!f&&er&&N?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,M.A)("flex items-center flex-1 gap-2",""),children:[!(!l||r||o)&&(0,n.jsx)(m.Iz,{options:[{key:"normal",label:(0,n.jsx)(x.kU3,{size:16}),ariaLabel:X.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,n.jsx)(x.CyN,{size:16}),ariaLabel:X.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===d?"normal":"code",onSelect:e=>{c("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===d?"normal":"code"),s>1?(0,n.jsx)(g.ms,{align:"start",trigger:(0,n.jsxs)(h.$,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",a+1,el||a!==s-1?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"∙"}),(0,n.jsx)(T.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,n.jsx)(x.biH,{size:16,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,n.jsxs)(g.tJ,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>G(e-1),children:[(0,n.jsx)(T.A,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,n.jsxs)(n.Fragment,{children:[" - ",(0,n.jsx)(T.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===a?(0,n.jsx)(x.Jlk,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,n.jsxs)("div",{className:(0,M.A)("flex gap-2 items-center text-sm"),children:[el?(0,n.jsxs)(g.ms,{align:"end",trigger:(0,n.jsx)(h.$,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger","aria-label":X.formatMessage({defaultMessage:"More options for artifact",id:"O91Ji7GVP2"}),children:(0,n.jsx)(x.txq,{size:16})}),children:[er&&(0,n.jsx)(g.tJ,{disabled:N,onSelect:C,children:(0,n.jsx)(T.A,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),q&&!f&&(0,n.jsx)(g.tJ,{onSelect:()=>K(!0),children:(0,n.jsx)(T.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"})},"manage-connectors"),(0,n.jsx)(g.tJ,{onSelect:es,children:(0,n.jsx)(T.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),A?(0,n.jsx)(g.tJ,{onSelect:S,children:(0,n.jsx)(T.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,L?(0,n.jsx)(g.tJ,{disabled:!0,onSelect:W,children:(0,n.jsx)(T.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):I?(0,n.jsx)(g.tJ,{onSelect:W,children:(0,n.jsx)(T.A,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,eu,ed]}):(()=>{let e=!f&&er&&(N?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(v.Loading,{size:"sm"})}):(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:C,children:(0,n.jsx)(x.MvQ,{size:16})})),t=A&&(0,n.jsx)(h.$,{onClick:S,variant:"primary",size:"sm",disabled:z,prepend:(0,n.jsx)(x.SYj,{size:16,className:"mr-0.5"}),children:(0,n.jsx)("span",{className:"text-sm",children:(0,n.jsx)(T.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})}),s=I&&(0,n.jsx)(b.m,{open:!!L&&void 0,tooltipContent:(0,n.jsx)(T.A,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,n.jsx)(h.$,{onClick:W,variant:"primary",size:"sm",disabled:L||z,className:(0,M.A)(L&&"!pointer-events-auto"),children:(0,n.jsx)("span",{className:"text-sm",children:void 0===O||L?(0,n.jsx)(T.A,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,n.jsx)(T.A,{defaultMessage:"Published",id:"w7tf2zwi6+"})})})}),a=(0,n.jsxs)(p.g,{align:"end",defaultButtonLabel:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:(0,M.A)($?"invisible":""),children:(0,n.jsx)(T.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),$?(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(x.Jlk,{size:16})}):null]}),onClickDefaultButton:es,children:[(null==D?void 0:D.show)?et?(0,n.jsx)(g.tJ,{disabled:!0,children:(0,n.jsx)(T.A,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,n.jsx)(g.tJ,{onSelect:ee,children:(0,n.jsx)(T.A,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,eu,ed]}),i=q&&!f&&(0,n.jsx)(b.m,{tooltipContent:(0,n.jsx)(T.A,{defaultMessage:"Manage connectors",id:"cqx+RdJnHp"}),children:(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:()=>K(!0),children:(0,n.jsx)(x.wB_,{size:16})})});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex gap-1 items-center",children:[e,i]}),a,t,s]})})(),(0,n.jsx)(h.$,{variant:"ghost",size:"icon_sm",onClick:B,children:(0,n.jsx)(x.X,{size:16})})]})]})]})}function ec(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:a,filename:i}=((e,t)=>{let[s,a]=(0,R.useState)(""),[n,i]=(0,R.useState)("");return(0,R.useEffect)(()=>{var s;let n=null!=(s=e.versions[t].resultState)?s:"",l=(0,w.eg)(e),r=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(r);return a(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:n}})(t,s),l=function(e){switch(e.type){case w.vU.Markdown:return"Markdown";case w.vU.Html:return"HTML";case w.vU.React:return"TSX";case w.vU.Svg:return"SVG";case w.vU.Text:return"TXT";case w.vU.Mermaid:return"Mermaid";case w.vU.Code:var t;return null!=(t=w.K5[e.type].extension(e))?t:null;default:return null}}(t);return(0,n.jsx)("a",{href:a,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000",children:l?(0,n.jsx)(T.A,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,n.jsx)(T.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}f.J.div(el()),f.J.div(er());let eu=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:a,artifact:i,messageUuid:r,isProjectArtifact:o}=e,c=(0,U.A)(),{track:u}=(0,d.st)(),{mutateAsync:m,isPending:f}=(0,l.yE)(a),{data:g,isLoading:p}=(0,l.EC)(a),v=(null==g?void 0:g.visibility)==="shared",b=f||p,[w,_]=(0,R.useState)("");(0,R.useEffect)(()=>{if(""===w)return;let e=setTimeout(()=>_(""),5e3);return()=>clearTimeout(e)},[w]);let k="".concat(window.location.origin,"/artifacts/").concat(a),{copyToClipboard:N,didCopy:M}=(0,y.C)(),C=b?"loading":v?"shared":"private",A=(0,R.useRef)(C);A.current!==C&&("loading"!==A.current&&"private"===C&&_(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),A.current=C);let S=e=>{"private"===e&&v&&m({visibility:"private"}).then(()=>t()),"shared"!==e||v||m({visibility:"shared"}).then(()=>N(k))};return(0,n.jsx)(j.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:v?(0,n.jsx)(T.A,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,n.jsx)(T.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:s,onClose:t,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(x.qzq,{className:"mt-1",size:16})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(T.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,n.jsx)("p",{className:"text-text-300 tracking-tight",children:o?(0,n.jsx)(T.A,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,n.jsx)(T.A,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(I(),{className:"text-text-300 truncate text-sm",href:k,children:k}),(0,n.jsx)(h.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{N(k)},prepend:M?(0,n.jsx)(x.rAV,{size:16}):(0,n.jsx)(x.Xq1,{size:16}),children:M?(0,n.jsx)(T.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)(T.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(h.$,{size:"lg",variant:"secondary",loading:b,onClick:()=>S("private"),children:(0,n.jsx)(T.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}),!v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:o?(0,n.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,n.jsx)(x.R2D,{size:16,className:"mt-0.5 shrink-0"}),(0,n.jsx)(T.A,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,n.jsx)("p",{children:(0,n.jsx)(T.A,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,n.jsx)(x.c_I,{className:"mt-0.5",size:16}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)(T.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,n.jsx)("p",{className:"text-text tracking-tight-300",children:(0,n.jsx)(T.A,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(h.$,{size:"lg",loading:b,onClick:()=>{S("shared"),u({event_key:"artifact.share.modal.share_button_clicked",message_uuid:r,artifact_type:i.type,artifact_language:i.language})},children:(0,n.jsx)(T.A,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})]})})}},84137:(e,t,s)=>{s.d(t,{CH:()=>b,GT:()=>C,IK:()=>j,Nw:()=>k,OQ:()=>w,Ui:()=>y,YE:()=>M,mk:()=>v,mq:()=>p});var a=s(54568),n=s(7726),i=s(11515),l=s(1336),r=s(77186),o=s(85544),d=s(21036),c=s(32987),u=s(37463),m=s(68864),f=s(7620),x=s(46760),h=s(75006),g=s(57383);function p(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,a.jsx)(u.P.div,{className:(0,c.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,a.jsx)(i.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,a.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function v(e){let{agents:t,n:s=5}=e,a=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(a.add(e.origin),a.size>=s)return Array.from(a).slice(0,s)}catch(e){}}}return Array.from(a)}function j(e,t){let s=!t||t===o.zu.Completed,a=(0,f.useRef)(s),{mutate:i}=(0,n.HF)(e,{refetchOnSettled:!0});(0,f.useEffect)(()=>{s&&!a.current&&i({settings:{compass_mode:null}}),a.current=s},[i,s,e])}function b(e){var t,s;let{organizationUUID:a,conversationUUID:i,taskId:l,isShared:c,enabled:u}=e,[x,h]=(0,f.useState)(!0),[,p]=(0,f.useState)(0),v=(0,d.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),j=null!=(s=null==(t=v[0])?void 0:t.intervalSeconds)?s:30,[b,y]=(0,f.useState)(j),w=(0,n._W)(i),{setCurrentCompassTask:_}=(0,g.o)(),k=c?"/api/organizations/".concat(a,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(a,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:N,isLoading:M,error:C}=(0,r.Sk)(k,{refetchInterval:!!x&&1e3*b,enabled:!!(u&&i&&a&&l),meta:{noToast:!0}}),A=(null==N?void 0:N.status)!==void 0&&!(0,o.i3)(null==N?void 0:N.status);return(0,f.useEffect)(()=>{if(u&&i&&a&&l)if(A)h(!1),_(void 0),w(),p(0);else if(C){if(!(null==N?void 0:N.started_at))return void h(!1);p(e=>{let t=e+1,s=m.c9.fromISO(N.started_at).plus({hours:3}),a=m.c9.now();return h(t<3&&a<s),t})}else N&&!A&&(p(0),_(l))},[u,l,A,C,w,a,i,N,_]),(0,f.useEffect)(()=>{if(!(null==N?void 0:N.started_at)||!x)return;let e=setInterval(()=>{let e=function(e,t){let s=m.c9.fromISO(e),a=m.c9.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||a<e.durationSeconds)return e.intervalSeconds;return 30}(N.started_at,v);e!==b&&y(e)},1e3*b);return()=>clearInterval(e)},[null==N?void 0:N.started_at,x,v,b]),{compassStatus:N,isLoading:M,error:C,completed:A}}let y=e=>{var t;return null==e||null==(t=e.agents[0])?void 0:t.name};function w(e){let t=(0,x.A)(),s=y(e);return s||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=h.z.object({thought:h.z.string()});function k(e){let t=null==e?void 0:e.agents[0];return(0,f.useMemo)(()=>{var e,s,a;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,i=n&&n.length>0?n[0]:void 0;if(i)return i.thinking;let l=null==t||null==(a=t.annotated_snippets[0])||null==(s=a.tool_calls)?void 0:s.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function N(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function M(e){let{startedAt:t,completedAt:s}=e,[n,i]=(0,f.useState)(()=>m.c9.now());if((0,f.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(m.c9.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=m.c9.fromISO(t);if(s){let e=m.c9.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,a.jsx)(a.Fragment,{children:N(e)})}let r=n.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,a.jsx)(a.Fragment,{children:N(r)})}function C(e){let{thought:t,className:s}=e;return t?(0,a.jsx)("div",{className:(0,c.A)("text-text-100 font-claude-response-body",s),children:(0,a.jsx)(l.fP,{text:t})}):null}},89436:(e,t,s)=>{s.d(t,{t:()=>l});var a=s(54568),n=s(1761),i=s(62971);function l(e){let t,{project:s,className:l}=e,{account:r}=(0,n.YL)();if(s.is_starter_project)t=(0,a.jsx)(i.A,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var o;t=(null==(o=s.creator)?void 0:o.full_name)?s.creator.uuid===(null==r?void 0:r.uuid)?(0,a.jsx)(i.A,{defaultMessage:"Created by you",id:"WEhuQZAqE6"}):(0,a.jsx)(i.A,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,a.jsx)(i.A,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,a.jsx)("span",{className:l,children:t})}},93901:(e,t,s)=>{s.d(t,{X:()=>o,m:()=>r});var a=s(77186),n=s(1761),i=s(87606);let l="artifact_tool_configuration",r=e=>{let{entityId:t,artifactEntityType:s}=e,{activeOrganization:i}=(0,n.YL)(),r=null==i?void 0:i.uuid;return(0,a.Sk)("/api/organizations/".concat(r,"/artifacts/").concat(s,"/").concat(t,"/tools"),{queryKey:[l,{orgUuid:r,entityId:t,artifactEntityType:s}],enabled:!!r&&!!t,meta:{noToast:!0}})},o=e=>{let{entityId:t,artifactEntityType:s}=e,{activeOrganization:r}=(0,n.YL)(),o=null==r?void 0:r.uuid,d=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(o,"/artifacts/").concat(s,"/").concat(t,"/tools"),"POST",{enabled:!!o&&!!t,onSuccess:()=>{d.invalidateQueries({queryKey:[l,{orgUuid:o,entityId:t,artifactEntityType:s}]})},meta:{noToast:!0}})}},94748:(e,t,s)=>{s.d(t,{NG:()=>x,aX:()=>h,sH:()=>g});var a=s(54568),n=s(60370),i=s(64359),l=s(37711),r=s(29242),o=s(98769),d=s(32987),c=s(37463),u=s(7620),m=s(33792),f=s(11480);let x=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:n,children:l,className:r,onTransitionEnd:m,collapsesHalfway:f,setIsExpanded:x,footer:h}=e,g=(0,u.useRef)(t),p=!!(f&&!t&&x),v=f&&!t;return(0,a.jsxs)(c.P.div,{className:(0,d.A)("overflow-hidden shrink-0",!t&&p&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:g.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:.6*!!f,height:72*!!f}},whileHover:{opacity:1},transition:n?{ease:o.A.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:m,onClick:p?()=>x(!0):void 0,children:[(0,a.jsx)(i.r,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,d.A)("h-full",s&&"!max-h-[238px]",r,v&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l}),h]})},h=e=>{let{handleClick:t,isDisabled:s,isExpanded:i,isStreaming:o,isError:u,errorMessage:x,icon:h,text:g,secondaryIcon:p,secondaryText:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,className:y,wrapperClassName:w,children:_,renderMode:k=m.l.Standard,isFirstItemInGroup:N,isLastItemInGroup:M}=e,C=s||!t,A=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:t,className:(0,d.A)("group/row flex flex-row items-center justify-between gap-4 transition-colors duration-200 rounded-lg text-text-300 hover:text-text-200 h-[2.625rem] py-2 px-3",C?"cursor-default":"cursor-pointer hover:text-text-000",y),disabled:C,children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[h&&k!==m.l.TimelineGroup&&(0,a.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:h}),(0,a.jsx)("div",{className:"relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:o?(0,a.jsx)(l.N,{children:g}):g})]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:u?(0,a.jsx)(r.m,{tooltipContent:x,align:"center",children:(0,a.jsx)(n.N5l,{size:16,className:"text-danger-000"})}):(0,a.jsxs)(a.Fragment,{children:[!!v&&(0,a.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap",children:v}),p]})})]},o?"streaming":"non-streaming"),_]});return k===m.l.TimelineGroup?(0,a.jsx)(f.i1,{icon:h,isExpanded:i,isFirstItem:!!N,isLastItem:!!M,isActive:o&&b&&M,children:A}):(0,a.jsx)(c.P.div,{initial:{opacity:+!o},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,d.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!i&&"hover:bg-bg-000 hover:shadow-sm",j?"mt-2":"mt-3",b?"mb-2":"mb-3",i&&"bg-bg-000 shadow-sm",w),children:A})},g=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...i}=e,{isExpanded:l,isError:r,secondaryIcon:o}=i,c=t||r;return(0,a.jsx)(h,{...i,isDisabled:c,handleClick:()=>s(!l),secondaryIcon:(0,a.jsxs)(a.Fragment,{children:[o,!c&&(0,a.jsx)(n.biH,{className:(0,d.A)("relative bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",l?"-rotate-180":"rotate-0",c&&"opacity-15"),size:16})]})})}},96900:(e,t,s)=>{s.d(t,{I:()=>U});var a=s(42977),n=s(54568),i=s(18472),l=s(8027),r=s(11515),o=s(51121),d=s(86030),c=s(9537),u=s(90510),m=s(22529),f=s(60370),x=s(41417),h=s(64359),g=s(37076),p=s(29242),v=s(62094),j=s(43989),b=s(32987),y=s(27261),w=s.n(y),_=s(7620),k=s(62971),N=s(46760),M=s(93901),C=s(92075),A=s(92947),S=s(45078),E=s(93271),z=s(88185);function I(){let e=(0,a._)(["\n  bg-bg-000 \n  border-0.5 \n  border-border-300 \n  rounded-lg \n  shadow-sm\n  p-5\n  flex \n  flex-col \n  gap-4\n  items-stretch\n  self-stretch\n"]);return I=function(){return e},e}let R=u.J.div(I()),T=e=>{let{server:t,variant:s,onClick:a,enabledToolsCount:o}=e,{isRemoteServerInDirectory:c}=(0,z.hW)(),u=(0,A.QD)(),[m,f]=(0,_.useState)(!1),h=!!t&&"remote"===t.type&&c(t);return(0,n.jsxs)("div",{className:(0,b.A)("w-full flex items-center justify-between rounded-lg bg-bg-000",a&&"connect"!==s&&"cursor-pointer hover:bg-bg-100 transition-colors"),onClick:"connect"===s?void 0:a,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,n.jsx)(i.O,{size:28,className:"flex-shrink-0",children:(0,n.jsx)(r.d,{url:t.url,fallbackSvg:(0,n.jsx)(l.B,{letter:t.name||t.url||"",size:16}),size:16})}),(0,n.jsxs)("div",{className:"flex gap-2 items-center min-w-0 flex-1",children:[(0,n.jsx)(p.m,{tooltipContent:t.url||t.name||"",children:(0,n.jsx)("div",{className:"font-medium text-sm truncate",children:t.name||t.url||""})}),!h&&(0,n.jsx)(d.E,{className:"flex-shrink-0",children:(0,n.jsx)(k.A,{defaultMessage:"CUSTOM",id:"Jg/zGahNtM"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:"connect"===s?(0,n.jsx)(x.$,{variant:"secondary",size:"sm",onClick:e=>{e.stopPropagation(),f(!0),u({uuid:t.uuid||"",url:t.url})},loading:m,className:"ml-2",children:(0,n.jsx)(k.A,{defaultMessage:"Connect",id:"+vVZ/G11Zg"})}):(0,n.jsxs)(n.Fragment,{children:[o&&o>0?(0,n.jsx)("span",{className:"text-sm text-accent-secondary-100",children:(0,n.jsx)(k.A,{defaultMessage:"{count} enabled",id:"yA/nbBqm+9",values:{count:o}})}):(0,n.jsx)("span",{className:"text-sm text-fg-400",children:(0,n.jsx)(k.A,{defaultMessage:"Disabled",id:"tthToSLF5Z"})}),(0,n.jsx)(v.J,{className:"w-4 h-4 text-fg-400"})]})})]})},U=e=>{let{isOpen:t,requestedServers:s,onClose:a,artifactContext:i}=e,r=(0,N.A)(),{servers:d}=(0,A.gt)(),{addError:u}=(0,o.Y)(),p=r.formatMessage({defaultMessage:"Failed to save tool configuration. Please try again.",id:"ZohwwHXd08"}),{data:v}=(0,C.rX)(),b=!!v&&!(null==v?void 0:v.disabled_features.includes("mcp_artifacts")),[y,z]=(0,_.useState)(null),[I,U]=(0,_.useState)(""),[L,F]=(0,_.useState)({}),{knownServers:O,unknownServers:D}=(0,_.useMemo)(()=>{if(!s||!d)return{knownServers:void 0,unknownServers:[]};let e=[],t=[];return s.forEach(s=>{let a=d.find(e=>{let t="remote"===e.type,a=e.url===s.url;return t&&a});a?e.push(a):t.push(s)}),{knownServers:e,unknownServers:t}},[s,d]),{data:P}=(0,M.m)({entityId:i.uuid,artifactEntityType:i.type}),B=(0,S.vP)("enabled_mcp_tools"),W=(0,_.useMemo)(()=>B||{},[B]),{mutateAsync:G}=(0,M.X)({entityId:i.uuid,artifactEntityType:i.type}),J=(0,_.useCallback)(e=>e.tools?I?e.tools.filter(e=>e.name.toLowerCase().includes(I.toLowerCase())):e.tools:[],[I]);if((0,_.useEffect)(()=>{if((null==P?void 0:P.mcp_servers)&&(null==O?void 0:O.length)){let e={};P.mcp_servers.forEach(t=>{let s=O.find(e=>e.url===t.url);(null==s?void 0:s.tools)&&s.tools.forEach(s=>{let a=t.allowed_tools.includes(s.name);e[s.enabledKey]=a})}),F(e)}else Object.keys(W).length>0&&F(W)},[P,O,W]),!(null==O?void 0:O.length))return a(),null;let V=O.filter(e=>e.isConnected||e.isAuthless||e.isLoading),H=async e=>{try{await q(e),a()}catch(e){u(p)}},q=async e=>{let t=O.map(t=>{let s=t.tools||[],a=[],n=[],i=t.isConnected||t.isAuthless;return e&&s.length>0&&i?s.forEach(e=>{!1!==L[e.enabledKey]?a.push(e.name):n.push(e.name)}):!e&&s.length>0&&s.forEach(e=>{n.push(e.name)}),{name:t.name||"",url:t.url||"",allowed_tools:a,disallowed_tools:n,pending_tool_section:!!e&&!i}}),s=D.map(e=>({name:e.name||"",url:e.url||"",allowed_tools:[],disallowed_tools:[],pending_tool_section:!1}));await G({mcp_servers:[...t,...s]})},K=e=>!!e.tools&&0!==e.tools.length&&e.tools.filter(e=>!1!==L[e.enabledKey]).length>0;return y?(0,n.jsx)(g.aF,{title:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>z(null),className:"hover:bg-bg-200 rounded transition-colors",children:(0,n.jsx)(j.A,{className:"w-5 h-5"})}),(0,n.jsx)("span",{children:(0,n.jsx)(k.A,{defaultMessage:"Customize {serverName}",id:"xtLJnxdHqO",values:{serverName:y.name||y.url||""}})})]}),isOpen:t,onClose:a,children:(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(m.YX,{id:"crystal_muffin_bicycle"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)(R,{className:"!gap-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2.5 px-1.5",children:[(0,n.jsx)(f.vji,{className:"w-4 h-4 text-text-500/50"}),(0,n.jsx)(c.ks,{placeholder:r.formatMessage({defaultMessage:"Search tools",id:"QVlai1/dYD"}),value:I,onChange:e=>U(e.target.value),className:"flex-1 !border-none !outline-none !p-0 !text-sm text-text-300 placeholder:text-text-500/70"})]}),y.tools&&y.tools.length>1&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(E.$,{item:{key:"select-all",type:"switch",label:K(y)?r.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):r.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"}),icon:(0,n.jsx)(l.p,{letter:y.tools[0].name,size:16}),isChecked:K(y),onClick:()=>{let e=!K(y);if(y.tools){let t={...L};y.tools.forEach(s=>{t[s.enabledKey]=e}),F(t)}}}}),(0,n.jsx)("div",{className:"border-t border-border-300"})]}),J(y).map(e=>{let t=e.enabledKey,s=!1!==L[t];return(0,n.jsx)(E.$,{item:{key:t,type:"switch",label:e.name,icon:(0,n.jsx)(l.B,{letter:e.name,size:16}),isChecked:s,onClick:()=>{F(e=>({...e,[t]:!s}))}}},t)})]})})]})}):b?(0,n.jsxs)(g.aF,{title:r.formatMessage({defaultMessage:"Allow access to {count} connectors",id:"gqJuzJIhGT"},{count:O.length}),isOpen:t,onClose:a,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-3 py-3",children:[(0,n.jsx)("p",{className:"text-sm description-text-300",children:(0,n.jsx)(m.YX,{id:"penguin_tomato_umbrella"})}),(0,n.jsx)(h.r,{gradientHeight:24,className:"max-h-[500px]",children:(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsxs)(R,{children:[O.map(e=>(0,n.jsx)(T,{server:e,variant:V.includes(e)?"tools":"connect",onClick:()=>z(e),enabledToolsCount:(e=>e.tools&&0!==e.tools.length?e.tools.filter(e=>!1!==L[e.enabledKey]).length:null)(e)},e.uuid||e.url)),D.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"border-t-0.5 border-border-300 -mx-5"}),(0,n.jsx)("p",{className:"text-xs text-text-500",children:(0,n.jsx)(k.A,{defaultMessage:"{count, plural, one {# requested connector is not in your connector settings and has been} other {# requested connectors are not in your connector settings and have been}} hidden. Some functionality may be limited. {link}",id:"vGNkIa04SK",values:{count:D.length,link:(0,n.jsx)(w(),{href:"/settings/connectors",className:"hover:underline",children:(0,n.jsx)(k.A,{defaultMessage:"Manage connectors.",id:"0+FF8HZw5G"})})}})})]})]}),(0,n.jsx)(R,{className:"bg-bg-100",children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:(0,n.jsx)(k.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})})]})})]}),(0,n.jsxs)(g.vW,{children:[(0,n.jsx)(x.$,{variant:"secondary",onClick:()=>H(!1),children:(0,n.jsx)(k.A,{defaultMessage:"Disallow all tools",id:"Vm8mYnmEt3"})}),(0,n.jsx)(x.$,{onClick:()=>H(!0),variant:"primary",children:(0,n.jsx)(k.A,{defaultMessage:"Allow enabled tools",id:"n/BchMToVR"})})]})]}):(0,n.jsxs)(g.aF,{title:r.formatMessage({defaultMessage:"Connectors required",id:"z3l0UT9nBK"}),isOpen:t,onClose:a,children:[(0,n.jsx)("div",{className:"flex flex-col gap-3 py-3",children:(0,n.jsx)(R,{className:"bg-bg-100",children:(0,n.jsx)("p",{className:"text-sm text-text-500",children:(0,n.jsx)(k.A,{defaultMessage:"Your organization admin has disabled connectors in artifacts. To use this feature, ask your admin to enable connectors in artifacts.",id:"+0AXIvgEHO"})})})}),(0,n.jsx)(g.vW,{children:(0,n.jsx)(x.$,{variant:"primary",onClick:a,children:(0,n.jsx)(k.A,{defaultMessage:"Close",id:"rbrahOGMC3"})})})]})}},97527:(e,t,s)=>{s.d(t,{I:()=>n,q:()=>i});var a=s(7620);let n=(0,a.createContext)(null),i=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}},97652:(e,t,s)=>{s.d(t,{c:()=>tm,d:()=>tf});var a=s(42977),n=s(54568),i=s(7620),l=s(50787),r=s(57322);r.A.blockRegex;let o=r.A.defaultRules,d=r.A.parserFor;r.A.defaultBlockParse;let c=r.A.outputFor,u=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(u);if(i.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){let t=e.props.children,s=u(t);if(s!==t)return i.cloneElement(e,void 0,s)}return e}if((e=>"object"==typeof e&&null!==e&&"$$typeof"in e&&"type"in e&&"props"in e)(e)){let{type:t,props:s,key:a}=e,n={};return s&&"object"==typeof s&&(Object.assign(n,s),"children"in s&&(n.children=u(s.children))),null!=a&&(n.key=a),i.createElement(t,n)}return e};var m=s(56340);let f={...{fence:{...o.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,n.jsx)(m.I.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...o.blockQuote,react:(e,t,s)=>(0,n.jsx)(m.I.blockQuote,{children:t(e.content,s)})},list:{...o.list,react:(e,t,s)=>{let a=e.ordered?m.I.ol:m.I.ul;return(0,n.jsx)(a,{children:e.items.map((e,a)=>(0,n.jsx)(m.I.li,{children:t(e,s)},a))},s.key)}},newline:o.newline,paragraph:{...o.paragraph,react:(e,t,s)=>(0,n.jsx)(m.I.p,{children:t(e.content,s)},s.key)},u:o.u,del:o.del,inlineCode:{...o.inlineCode,react:e=>{let t=e.content;if(t&&l.yT.test(t)){var s;if((null==(s=t.match(l.yT))?void 0:s[0])===t)return(0,n.jsxs)(m.I.code,{children:[(0,n.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,n.jsx)(l.qU,{color:t})}),t]})}return(0,n.jsx)(m.I.code,{children:t})}},text:{...o.text,react:e=>(0,l.fz)(e.content)}},url:o.url,link:{...o.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,n.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}},em:o.em,strong:o.strong},x=(0,i.memo)(e=>{let{text:t}=e,s=d(f)(t,{inline:!1});return((e,t,s)=>{let a=c(e,t,s),n=(e,t)=>u(a(e,t));return n.displayName="OutputFor_".concat(String(t)),n})(f,"react")(s)});x.displayName="AnthropicMarkDown";var h=s(7409),g=s(33200),p=s(90510),v=s(41417),j=s(27062),b=s(4705),y=s(82015),w=s(38583),_=s(46760),k=s(62971),N=s(70497);function M(){let e=(0,a._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return M=function(){return e},e}function C(){let e=(0,a._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return C=function(){return e},e}function A(){let e=(0,a._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return A=function(){return e},e}function S(){let e=(0,a._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return S=function(){return e},e}let E=p.J.div(M()),z=(0,p.J)(E)(C()),I=(0,p.J)(E)(A()),R=(0,p.J)(E)(S()),T=(0,i.memo)(function(e){let{message:t,messageWarningPropsFromParent:s,hasLink:a,hasCode:l,hasDriveDocWithImages:r,onRetry:o,onSendContinue:d,conversationSettings:c,isLastMessage:u}=e,m=(0,_.A)(),{value:f}=(0,g.N)(null!=c?c:{}),x=null==c?void 0:c.enabled_web_search,{value:h}=(0,j.fS)("claudeai_web_search"),p=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,n.jsx)("a",{...s,className:"underline"})}}),[]);if((null==s?void 0:s.style)==="prominent")return(0,n.jsxs)(I,{"data-testid":"message-warning",children:[(0,n.jsx)(b.N,{className:"shrink-0",size:16}),(0,n.jsx)(N.o,{components:p,children:s.contentMarkdown})]});let M="human"===t.sender;if(!M&&"error"===t.stop_reason&&o)return(0,n.jsxs)(R,{"data-testid":"message-warning",onClick:()=>o(t.parent_message_uuid),children:[(0,n.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,n.jsx)(b.N,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,n.jsx)(y.o,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,n.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,n.jsx)(k.A,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!M&&u&&"max_tokens"===t.stop_reason&&d)return(0,n.jsx)(z,{"data-testid":"message-warning",children:(0,n.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(w.R,{className:"shrink-0",size:16}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(k.A,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,n.jsx)("div",{className:"ml-6",children:(0,n.jsx)(v.$,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==d?void 0:d(),"aria-label":m.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,n.jsx)(k.A,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});let C=[];return(M?(a&&!x&&(h?C.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search to get up to date info from web links.",id:"fPI2JySdII"})):C.push(m.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"}))),r&&C.push(m.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(a&&!x&&(h?C.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search for up to date and accurate links.",id:"sN35Yf2Rzl"})):C.push(m.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"}))),l&&!f&&C.push(m.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),t.stop_reason,"conversation_length_limit"===t.stop_reason&&C.push(m.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),s&&C.push(s.contentMarkdown)),0===C.length)?null:(0,n.jsxs)(z,{"data-testid":"message-warning",children:[(0,n.jsx)(w.R,{className:"shrink-0",size:16}),(0,n.jsx)(N.o,{components:p,children:C.reverse().join(" ")})]})});var U=s(32987),L=s(1336);class F{isInsideStructure(){return this.inCodeBlock||this.inList||this.inTable||this.inBlockquote}processLine(e){let t=e.trim(),s=this.isInsideStructure();(t.startsWith("```")||t.startsWith("~~~"))&&(this.inCodeBlock?t.startsWith(this.codeBlockDelimiter)&&(this.inCodeBlock=!1,this.codeBlockDelimiter=""):(this.inCodeBlock=!0,this.codeBlockDelimiter=t.substring(0,3))),/^[-*+]|\d+\./.test(t)&&!this.inCodeBlock?this.inList=!0:this.inList&&""===t&&(this.inList=!1),t.includes("|")&&!this.inCodeBlock?this.inTable=!0:this.inTable&&""===t&&(this.inTable=!1);let a=t.startsWith(">");a&&!this.inCodeBlock?this.inBlockquote=!0:this.inBlockquote&&""===t&&!a&&(this.inBlockquote=!1);let n=this.lastLineWasEmpty;this.lastLineWasEmpty=""===t;let i=s&&!this.isInsideStructure();return{insideStructure:this.isInsideStructure(),structureJustClosed:i,previousLineWasEmpty:n}}reset(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}constructor(){this.inCodeBlock=!1,this.codeBlockDelimiter="",this.inList=!1,this.inTable=!1,this.inBlockquote=!1,this.lastLineWasEmpty=!0}}let O=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],hasLinkRef:a,hasCodeRef:i,className:l,linkTarget:r="_blank",flagShowCodeHeader:o,unsafeAllowNavigationWithoutConfirmation:d,onOpenArtifact:c,isLastMessage:u,publishedArtifacts:m,messageUuid:f,onLinkClick:x}=e;return(0,n.jsx)(L.fP,{text:t,blockCitations:s,hasLinkRef:a,hasCodeRef:i,className:l,linkTarget:r,isStreaming:!1,flagShowCodeHeader:o,unsafeAllowNavigationWithoutConfirmation:d,onOpenArtifact:c,isLastMessage:u,publishedArtifacts:m,messageUuid:f,onLinkClick:x})},(e,t)=>e.text===t.text);O.displayName="MemoizedMarkdownChunk";let D=(0,i.memo)(e=>{let{text:t,blockCitations:s=[],hasLinkRef:a,hasCodeRef:l,className:r,linkTarget:o="_blank",isStreaming:d=!1,flagShowCodeHeader:c,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:f,publishedArtifacts:x,messageUuid:h,onLinkClick:g}=e,{completedChunks:p,streamingChunk:v}=((e,t)=>{let[s,a]=(0,i.useState)([]),[n,l]=(0,i.useState)(""),r=(0,i.useRef)(new F);return(0,i.useEffect)(()=>{if(!e){a([]),l("");return}if(!t){a([e]),l(""),r.current.reset();return}let s=e.split("\n"),n=[],i=[],o=-1;r.current.reset();for(let e=0;e<s.length;e++){let t=s[e],{insideStructure:a,structureJustClosed:l,previousLineWasEmpty:d}=r.current.processLine(t);if(i.push(t),l||!a&&""===t.trim()&&i.length>1&&!d){for(;i.length>0&&""===i[i.length-1].trim();)i.pop();i.length>0&&(n.push(i.join("\n")),o=e,i=[])}}let d=s.slice(o+1).join("\n");a(n),l(d)},[e,t]),{completedChunks:s,streamingChunk:n}})(t,d);return(0,n.jsxs)("div",{className:(0,U.A)("grid-cols-1 grid gap-2.5 [&_>_*]:min-w-0",r),children:[p.map((e,t)=>(0,n.jsx)(O,{text:t>0?"\n\n"+e:e,blockCitations:s,hasLinkRef:a,hasCodeRef:l,className:"",linkTarget:o,flagShowCodeHeader:c,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:f,publishedArtifacts:x,messageUuid:h,onLinkClick:g},t)),v&&(0,n.jsx)(L.fP,{text:p.length>0?"\n\n"+v:v,blockCitations:s,hasLinkRef:a,hasCodeRef:l,className:"",linkTarget:o,isStreaming:!0,flagShowCodeHeader:c,unsafeAllowNavigationWithoutConfirmation:u,onOpenArtifact:m,isLastMessage:f,publishedArtifacts:x,messageUuid:h,onLinkClick:g})]})});D.displayName="ProgressiveStandardMarkDown";var P=s(74610),B=s(1761),W=s(93877),G=s(9537),J=s(54890),V=s(92007),H=s(77101),q=s(12655),K=s(21036),Y=s(37463),X=s(85717),Z=s(47546),Q=s(85644),$=s(2341),ee=s(60370),et=s(9786),es=s(53248),ea=s(49645),en=s(75006),ei=s(92075),el=s(45078),er=s(57383),eo=s(77186),ed=s(89697),ec=s(77187),eu=s(56370),em=s(18179),ef=s(37076),ex=s(96377),eh=s(92479),eg=s(20298);function ep(e){let{isOpen:t,onClose:s,conversationUUID:a,messageUUID:i,text:l}=e;return(0,n.jsx)(ef.aF,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,children:(0,n.jsx)(ev,{conversationUUID:a,messageUUID:i,text:l})})}function ev(e){let{conversationUUID:t,messageUUID:s,text:a}=e,{data:l,isPending:r,mutateAsync:o}=((e,t)=>{let{activeOrganization:s}=(0,B.YL)(),a=null==s?void 0:s.uuid;return(0,eo.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")})(t,s),{model:d}=(0,er.o)(),c=(0,el.vP)("paprika_mode"),u=(0,$.B)(),m=(0,eg.n)(u||{}),{codeStyle:f}=(0,ed.V)(),x=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let a=JSON.parse(s);e.logs.api_usage[t]=a}catch(e){}return e}(l),null,2):"",h=(0,ec.Z3)(t);(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:d||h,tools:m(),personalized_styles:[],paprika_mode:c})})()},[o,d,m,c,h]);let{didCopy:g,copyToClipboard:p}=(0,et.C)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ef.vW,{layout:"left",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("h2",{className:"font-ui tracking-tight text-accent-pro-000 text-xl font-medium",children:[(0,n.jsx)(k.A,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),"\xa0",(0,n.jsx)("span",{className:"ml-1 text-sm font-medium text-danger-000",children:(0,n.jsx)(k.A,{defaultMessage:"FOR INTERNAL USE ONLY",id:"ISVSjyq5f9"})})]})}),(0,n.jsxs)(v.$,{variant:"ghost",onClick:()=>{p(x)},disabled:r,children:[(0,n.jsx)(et.u,{didCopy:g,size:16,className:"mr-2"}),(0,n.jsx)(k.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})]}),(0,n.jsx)(ej,{text:a})]}),r?(0,n.jsx)("div",{className:"my-2 flex h-full w-full items-center justify-center",children:(0,n.jsx)(em.Loading,{})}):(0,n.jsx)(eh.A,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:f,children:x})]})}let ej=e=>{let{text:t}=e,{copyToClipboard:s}=(0,et.C)(),a=(0,_.A)();return(0,n.jsx)(eu.ms,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,n.jsx)(v.$,{variant:"ghost",size:"icon","aria-label":a.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:(0,n.jsx)(ex.H,{size:20})}),children:(0,n.jsx)(eu.tJ,{className:"text-md",onSelect:()=>{s(t)},children:(0,n.jsx)("div",{className:"flex items-center justify-between gap-1",children:(0,n.jsx)("div",{className:"flex grow items-center",children:(0,n.jsx)(k.A,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})})})})})};var eb=s(18395);function ey(e){var t,s;let{conversationUuid:a,message:l}=e,[r,o]=(0,i.useState)(void 0),[d,c]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o("flag"):"upvote"!==r&&o("upvote"),c(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.k,{className:(0,U.A)((null==(t=l.chat_feedback)?void 0:t.type.includes("upvote"))&&"bg-bg-200 !text-accent-secondary-100"),Icon:(0,n.jsx)(ee.twC,{size:16}),tooltipContent:(0,n.jsx)(k.A,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote")}),(0,n.jsx)(Z.k,{className:(0,U.A)((null==(s=l.chat_feedback)?void 0:s.type.includes("flag"))&&"bg-bg-200 !text-danger-100"),Icon:(0,n.jsx)(ee.SuN,{size:16}),tooltipContent:(0,n.jsx)(k.A,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag")}),(0,n.jsx)(eb.B,{conversationUuid:a,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:d,onClose:()=>c(!1)})]})}var ew=s(22529),e_=s(35368),ek=s(99272);function eN(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:a,parentMessageUUID:l,setPaprikaModeState:r}=e,[o,d]=(0,i.useState)(!1),c=(0,e_.Wi)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{a(e,t),r(t)},[a,r]);return(0,n.jsxs)(eu.ms,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:d,trigger:(0,n.jsxs)(v.$,{variant:"unstyled",size:"unset",className:"flex flex-row items-center gap-1 rounded-md p-2 py-1.5 text-sm transition-opacity delay-100 hover:bg-bg-300 select-none",children:[(0,n.jsx)(k.A,{defaultMessage:"Retry",id:"62nsdyMyIO"}),(0,n.jsx)(ek.a,{size:12,className:"text-text-500 shrink-0"})]}),children:[(0,n.jsx)(eu.tJ,{className:"text-sm",onClick:()=>a(l),children:(0,n.jsx)(k.A,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),c.map(e=>(0,n.jsx)(eu.tJ,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,n.jsx)(k.A,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,n.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,n.jsx)(ew.X5,{id:e.description_key}):e.description})]})},e.id))]})}var eM=s(65755);let eC={default:{allowed:"never"}},eA=en.z.record(en.z.object({allowed:en.z.enum(["never","first_turn","always"])}));function eS(e){var t,s,a,l,r,o,d,c;let{message:u,conversationUUID:m,isStreaming:f,isTemporary:x=!1,onRetry:h,isLastMessage:g,isLastHumanMessage:p=!1,isInteractive:v=!0,changeDisplayedConversationPath:b,editMessage:y,isFirstAssistantMessage:w,isResearchPending:_}=e,[N,M]=(0,i.useState)(!1),C=null!=(r=null==(t=(0,$.B)())?void 0:t.preview_feature_uses_artifacts)&&r,A="human"===u.sender,S="assistant"===u.sender,E=f&&g,{value:z}=(0,j.fS)("anthropic_internal_only_expose_chat_debug"),I=!f&&(null!=(o=u.nOptions)?o:0)>1&&b,R=!f&&!_&&y&&u.parent_message_uuid&&v,T=null==u||null==(s=u.content)?void 0:s.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),U=!f&&!_&&v&&!T,L=(0,es.C)(u),{didCopy:F,copyToClipboard:O}=(0,et.C)(),D=async()=>{let e=(C?(0,J.it)(L):L).trim();try{let t=(0,eM.u)(e);await O({text:e,html:t})}catch(t){await O(e)}},P=(0,ei.QY)(),{toggleConversationSetting:B}=(0,el.rX)(),W=(0,el.vP)("paprika_mode"),{model:G}=(0,er.o)(),{allModelOptions:V}=(0,Q.A9)(),H=(0,j.iW)("claude_ai_paprika_retry",eC,eA),q=null!=(c=null!=(d=G&&(null==(a=H[G])?void 0:a.allowed))?d:null==(l=H.default)?void 0:l.allowed)?c:"never";if(A&&!R&&!I)return null;let K=V.find(e=>e.model===G),Y=null==K?void 0:K.paprika_modes,X=Y&&Y.length>0&&!W&&("always"===q||"first_turn"===q&&w);return(0,n.jsx)(eE,{isStreaming:E,isLastMessage:g||p,isInteractive:v,isAssistant:S,children:(0,n.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[S&&z&&(0,n.jsx)(Z.k,{Icon:(0,n.jsx)(ee.IFY,{size:16}),tooltipContent:(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsx)(k.A,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),(0,n.jsx)("div",{className:"px-1 py-px -mr-0.5 text-xs bg-always-white/20 rounded",children:(0,n.jsx)(k.A,{defaultMessage:"Internal",id:"2KtWqT5Nl+"})})]}),onClick:()=>M(!0),isAssistant:S}),S&&z&&(0,n.jsx)(ep,{isOpen:N,onClose:()=>M(!1),messageUUID:u.uuid,text:L,conversationUUID:m}),A&&R&&(0,n.jsx)(Z.k,{onClick:()=>y(u,"test edit message"),isAssistant:S,children:(0,n.jsx)(k.A,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),S&&(0,n.jsx)(Z.k,{tooltipContent:(0,n.jsx)(k.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),onClick:D,isAssistant:S,"data-testid":"action-bar-copy",children:(0,n.jsx)("div",{children:(0,n.jsx)(et.u,{size:16,didCopy:F})})}),S&&!E&&!_&&v&&"error"!==u.stop_reason&&P&&!x&&(0,n.jsx)(ey,{conversationUuid:m,message:u}),(0,n.jsxs)("div",{className:"flex items-center gap-0.5",children:[I&&(0,n.jsx)(ez,{message:u,changeDisplayedConversationPath:b,isAssistant:S}),S&&U&&(X?(0,n.jsx)(eN,{paprikaMode:W,supportedPaprikaModes:Y,onRetry:h,parentMessageUUID:u.parent_message_uuid,setPaprikaModeState:e=>{B("paprika_mode",null!=e?e:null)}}):(0,n.jsx)(Z.k,{onClick:()=>h(u.parent_message_uuid),isAssistant:S,children:(0,n.jsx)(k.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})}let eE=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:a,isAssistant:i,children:l}=e;return(0,n.jsx)(ea.N,{children:!t&&(0,n.jsx)(Y.P.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,n.jsx)("div",{className:(0,U.A)("rounded-lg transition min-w-max pointer-events-auto",!i&&"translate-y-4 bg-bg-300/90 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",i&&"translate-x-2",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})};function ez(e){var t;let{message:s,changeDisplayedConversationPath:a,isAssistant:i}=e,l=(null!=(t=s.selectedOption)?t:0)+1,r=l===s.nOptions;return(0,n.jsxs)("div",{className:"flex text-xs",children:[(0,n.jsx)(Z.k,{className:(0,U.A)("px-0.5 mr-1",1===l&&"opacity-50 pointer-events-none"),onClick:()=>a(s,-1),isAssistant:i,children:(0,n.jsx)(ee.ZK0,{})}),(0,n.jsx)("span",{className:"self-center shrink-0 select-none",children:(0,n.jsx)(k.A,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:l,totalOptions:s.nOptions}})}),(0,n.jsx)(Z.k,{className:(0,U.A)("px-0.5 ml-1",r&&"opacity-50 pointer-events-none"),onClick:()=>a(s,1),isAssistant:i,children:(0,n.jsx)(ee.K3R,{})})]})}var eI=s(98518),eR=s(34059),eT=s(83848);let eU=()=>{let e=(0,eI.st)(),{initDriveAuth:t}=(0,X.cI)({});return(0,i.useEffect)(()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.displayed"})},[e]),(0,n.jsx)(eL,{title:(0,n.jsx)(k.A,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,n.jsx)(eT.g,{size:18}),cta:(0,n.jsxs)(v.$,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,n.jsx)(eR.ft,{size:16,className:"mr-1"}),(0,n.jsx)(k.A,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eL=e=>{let{title:t,icon:s,cta:a}=e;return(0,n.jsx)(Y.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,n.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,n.jsx)("div",{className:"px-2.5 py-2.5",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,n.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),a]})})})})},eF=e=>{let{previousMessage:t}=e,s=(0,X.LP)(),{isDriveAuthenticated:a}=(0,X.cI)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,j.fS)("pumpernickel_enabled"),o=(0,K.useLayer)("trials_freemium").get("free_integrations",!1);return(r||o)&&s&&!a&&l?(0,n.jsx)(eU,{}):null},eO=e=>{let{title:t,text:s}=e,a=(0,_.A)();t=t||a.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,et.C)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,eM.u)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,n.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-response-body",children:[(0,n.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,n.jsx)("span",{className:"flex-1",children:t}),(0,n.jsx)(v.$,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,n.jsx)(et.u,{didCopy:i,size:16})})]}),(0,n.jsx)(N.o,{className:"px-4 pt-2 pb-4",children:s})]})};var eD=s(91965),eP=s(38715),eB=s(57067),eW=s(25243),eG=s(60045);let eJ=["year","month","day","hour","minute","second","millisecond"],eV=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=eG.dw.fromDurationLike(t);return e.formatList(eJ.filter(e=>0!==n["".concat(e,"s")]).map(t=>e.formatNumber(n["".concat(t,"s")],{...a,style:"unit",unit:t})),{...a,style:s})}((0,_.A)(),t,s)};var eH=s(68864),eq=s(27261),eK=s.n(eq),eY=s(33792),eX=s(94748),eZ=s(67532);function eQ(){let e=(0,a._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 mx-4 mb-4 font-small"]);return eQ=function(){return e},e}function e$(e,t){if(!e)return;let s=(t?eH.c9.fromISO(t):eH.c9.now()).diff(eH.c9.fromISO(e),["hours","minutes","seconds"]);return 0>s.toMillis()?eH.dw.fromMillis(0):s}let e0=p.J.div(eQ()),e1=()=>(0,n.jsxs)(e0,{"data-testid":"message-warning",children:[(0,n.jsx)(ee.R2D,{className:"shrink-0",size:16}),(0,n.jsx)(k.A,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,n.jsx)(eK(),{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),e2=e=>{let{text:t,cutOff:s}=e;return(0,n.jsxs)("div",{className:"text-text-300 text-sm font-normal gap-0.5 relative font-claude-response",children:[(0,n.jsx)(L.fP,{className:"p-3 pt-0 pr-8",text:t}),!0!==s?null:(0,n.jsx)(e1,{})]})},e3=e=>{let t,{index:s,text:a,cutOff:l=!1,startTimestamp:r,stopTimestamp:o,isStreaming:d,mostRecentSummary:c,onToggle:u,messageUuid:m,isFirstBlockOfMessage:f,isLastBlockOfMessage:x,renderMode:h=eY.l.Standard,isFirstItemInGroup:g,isLastItemInGroup:p}=e,v=(0,K.useDynamicConfig)("claudeai_isp_thinking_ux"),j=v.get("enabled",!1),b=(0,_.A)(),y=b.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),w=b.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),k=b.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:N,setIsExpanded:M,snappyTransition:C}=(0,eZ.a)(!j&&d,String(s)),A=(0,eI.st)(),[S,E]=(0,i.useState)(()=>e$(r,o)),z=(0,i.useRef)(void 0),I=(0,i.useRef)(!1),[R,T]=(0,i.useState)(null),L=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eB.GN)(m)&&L.current.length>0&&(L.current.forEach(e=>{A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:m,timestamp:e.timestamp})}),L.current=[])},[m,A]),(0,i.useEffect)(()=>{d&&(I.current=!0)},[d]);let F=d||I.current?v.get("fallback_summary_debounce_ms",2e3):0;(0,eW.W)(()=>{!d&&a.length>0&&T(e5(a,v))},[a,d],F),(0,i.useEffect)(()=>{let e=()=>{let e=e$(r,void 0);z.current=e,E(e)};if(d){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!z.current&&o&&E(e$(r,o))},[r,o,d]);let O=null==c?void 0:c.summary;if(j)if(d)t=null!=O?O:w;else{var D;t=null!=(D=null!=O?O:R)?D:w}else t=null!=O?O:d?y:k;return(0,n.jsx)(eX.sH,{isStreaming:d,isExpanded:N,setIsExpanded:()=>{let e=new Date().toISOString();(0,eB.GN)(m)?A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!N,is_streaming:d,chat_message_uuid:m,timestamp:e}):L.current.push({isOpening:!N,wasStreamingWhenClicked:d,timestamp:e}),M(!N)},isFirstBlockOfMessage:f,isLastBlockOfMessage:x,text:N?k:d||z.current?(0,n.jsx)(ea.N,{mode:"wait",children:(0,n.jsx)(Y.P.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,n.jsx)("span",{className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:S&&S.as("seconds")>=10?(0,n.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,n.jsx)(ee.Sw4,{className:(0,U.A)("text-text-300 transition-all duration-300 ease-in-out opacity-50",d?"!opacity-0 scale-50":"scale-100 opacity-100"),size:12}),(0,n.jsx)("span",{className:"tabular-nums",children:(0,n.jsx)(eV,{value:S,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:h,isFirstItemInGroup:g,isLastItemInGroup:p,children:(0,n.jsx)(eX.NG,{isExpanded:N,snappyTransition:C,onTransitionEnd:u,isScrollable:!0,children:(0,n.jsx)(e2,{text:a,cutOff:l})})})},e5=(e,t)=>{let s=t.get("fallback_summary_min_len",50),a=t.get("fallback_summary_max_len",100),n=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|。)")),i=e.substring(0,a),l=n.exec(i);if(l)return l[0];for(let e=i.length-1;e>=s;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i};var e6=s(56326),e4=s(95675),e7=s(56273),e9=s(11480),e8=s(99965),te=s(92947),tt=s(28871);function ts(){let e=(0,a._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return ts=function(){return e},e}function ta(){let e=(0,a._)(["\n  group\n  relative\n  -tracking-[0.015em]\n"]);return ta=function(){return e},e}function tn(){let e=(0,a._)(["\n  font-claude-response\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&>div>div>:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&>div>div>:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return tn=function(){return e},e}let ti={initial:!1,animate:{y:0,opacity:1}},tl={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},tr={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},to={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},td=[],tc=e=>{var t,s,a;let{conversationUuid:l,block:r,message:o,updatedMessage:d,index:c,isShared:u,isStreaming:m,isLastMessage:f,publishedArtifacts:x,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,renderMode:p,isFirstItemInGroup:v,isLastItemInGroup:j}=e,{renderToolUseCell:b}=(0,e6.Q)(),y=(0,q.Y)(r),w=r.name,_=r.id,k=r.context,N=null==(t=d.content)?void 0:t[c+1],M=(null==N?void 0:N.type)==="tool_result"?N:void 0,C=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{name:a,id:n,approval_options:l,approval_key:r,buffered_input:o}=t,d=null!=o?o:"{}",{servers:c}=(0,te.gt)(),u=(0,eg.M)(),{track:m}=(0,eI.st)(),f=(0,e8.p9)(),x=(0,te.HJ)(),{mutate:h}=(0,e8.p4)(e),{getApprovalSetting:g}=(0,te.BN)(),{toggleMcpToolAlwaysApproved:p}=(0,te.es)(),{account:v}=(0,B.YL)(),j=(0,i.useMemo)(()=>{var e;return Object.entries(null!=(e=null==v?void 0:v.settings.enabled_mcp_tools)?e:{}).filter(e=>{let[t,s]=e;return!!s}).map(e=>{let[t]=e;return t})},[null==v?void 0:v.settings.enabled_mcp_tools]),b=(0,i.useRef)(!1),y=null,w=null;for(let e of c){let t=e.tools.find(t=>"".concat(e.name,":").concat(t.name)===a);if(t){y=t,w=e;break}}let _=f&&(null==w?void 0:w.type)==="remote",{approvalSetting:k,alwaysAllowEnabled:N}=g(null==y?void 0:y.serverName,y),M=l?l.includes("always"):N,C=x&&!!t.id,A=b.current||s,S=C&&!!y&&(f?!!l&&!!r:!("never"===k||j.includes(y.alwaysApprovedKey))),E=(0,i.useCallback)(t=>{if(C&&y&&!A){if("always"!==t||r||p(y.alwaysApprovedKey,!0),"deny"===t)if(_)h({tool_use_id:n,is_approved:!1,approval_key:r});else{var s;u(e,a,n,d,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),m({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(s=(0,tt.p)(d))?s:{}).length})}else _?h({tool_use_id:n,is_approved:!0,approval_key:r,approval_option:t}):u(e,a,n,d);b.current=!0}},[C,A,y,r,p,_,h,u,e,a,n,d,m]);return!C||S||A||_||!o||(u(e,a,n,d),b.current=!0),{approvalRequired:S,disabled:!o,approved:A,submitToolApproval:E,showAlwaysAllowed:M}}(l,r,!!M),A={integrationName:r.integration_name,integrationIcon:r.integration_icon_url,message:(null==M?void 0:M.message)||r.message,input:r.display_content,result:null==M?void 0:M.display_content},S=!!d.content&&d.content.length<=c+1&&m,E=((e,t,s)=>{var a,n,i,l;let r,o,d,c=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=(e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0})(s.partial_json)):r=null==(n=s.input)?void 0:n.id,u&&(o=null==e||null==(i=e.input)?void 0:i.id),!c||(null==t?void 0:t.partial_json)||(d=null==t||null==(l=t.input)?void 0:l.id);let m=r===o,f=r===d,x="individual_cell_create",h=null==(a=s.input)?void 0:a.command;if(h&&(x=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),!c&&!u)return x;if(c&&u)if(!m&&!f)return x;else if(m&&!f)return"multi_edit_last";else return"multi_edit_not_last";if(c&&!u)if(!f)return x;else return"multi_edit_not_last";if(!c&&u&&m)return"multi_edit_last";return x})(null==(s=d.content)?void 0:s[c-2],null==(a=d.content)?void 0:a[c+2],r);if(!b)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let z=b({toolUseId:_,input:y,isLastMessage:f,message:o,publishedArtifacts:x,isStreaming:S,toolName:w,toolResult:M,displayData:A,approvalData:C,artifactCellType:E,isFirstBlockOfMessage:h,isLastBlockOfMessage:g,isShared:u,context:k,renderMode:p,groupItemKey:String(c),isFirstItemInGroup:v,isLastItemInGroup:j});return(0,n.jsx)(i.Fragment,{children:z})},tu=e=>{var t,s,a;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,textAreaRef:d,finishEdit:c,cancelEdit:u,author:m,loggedInAccount:f,message:x,selectAttachment:g,showSharedImageMissing:p=!1,showSharedFileMissing:j=!1}=e;(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),c()),"Escape"===e.key&&(e.preventDefault(),u()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===d.current){var t;null==(t=d.current)||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[c,u,d]);let b=null!=(a=x.files_v2)?a:x.files,y=p||j||x.attachments.length+b.length+((null==x||null==(t=x.sync_sources)?void 0:t.length)||0)>0;return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),c()},children:[y&&(0,n.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[b.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e},t)),x.attachments.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e,onClick:()=>null==g?void 0:g(e)},t)),null==x||null==(s=x.sync_sources)?void 0:s.map(e=>(0,n.jsx)(eP.V,{uuid:e.uuid,syncSource:e},e.uuid)),p&&(0,n.jsx)(h.sv,{}),j&&!p&&(0,n.jsx)(h.lD,{})]}),(0,n.jsx)(tx,{...l?tr:ti,className:"w-full",children:(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"flex shrink-0 items-center",children:(0,n.jsx)(W.e,{name:m||(null==f?void 0:f.full_name)||"",size:"sm"})}),(0,n.jsxs)("div",{className:"font-ui mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,n.jsx)(G.fs,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:d}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,n.jsx)(w.R,{"aria-hidden":"true",className:"shrink-0"}),(0,n.jsx)("div",{children:(0,n.jsx)(k.A,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(v.$,{onClick:u,variant:"secondary",children:(0,n.jsx)(k.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsx)(v.$,{type:"submit",disabled:0===r.length,children:(0,n.jsx)(k.A,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})},tm=(0,i.memo)(function(e){var t,s,a,l,r,o,d;let{lastHumanMessageRef:c,lastAssistantMessageRef:u,isLastMessage:m,isLastHumanMessage:f,selectAttachment:g,author:p,isInteractive:v=!0,onOpenArtifact:j,onOpenWiggleFile:b,onResize:y,editable:w,conversationSettings:_,publishedArtifacts:k=td,messageWarningProps:N,showSharedImageMissing:M=!1,showSharedFileMissing:C=!1,isFirstAssistantMessage:A,isShared:S,isTemporary:E=!1,actionEmitter:z,onSendContinue:I,isResearchPending:R=!1,...F}=e,{previousMessage:O,message:G,isStreaming:q,conversationUUID:Z}=F,[Q,$]=(0,i.useState)(!1),[ee,et]=(0,i.useState)(""),es=(0,i.useRef)(null),ea=(0,i.useRef)(1);(0,i.useEffect)(()=>{m||(ea.current+=1)});let en=null!=(d=G.files_v2)?d:G.files,ei=((e,t)=>{let s=(0,V.n)(),a=(0,i.useCallback)(e=>{if("text"!==e.type)return e;let a=e.text;return s&&e.citations&&e.citations.length>0&&(a=(0,P.k0)(e.citations,a)),a=t?(0,J.Tm)(a):(0,J.it)(a),{...e,text:a}},[t,s]);return(0,i.useMemo)(()=>{var t;let s=e.content,n=null==(t=e.content)?void 0:t[0];(null==n?void 0:n.type)==="text"&&""===n.text.trim()&&(s=null==s?void 0:s.slice(1));let i=(null==s?void 0:s.map(e=>a(e)))||[];return{...e,content:i}},[e,a])})(G,j),el="",er=null==(t=ei.content)?void 0:t.find(e=>"text"===e.type);er&&"text"in er&&(el=er.text);let eo=(0,i.useRef)(!1),ed=(0,i.useRef)(!1),{account:ec,activeOrganization:eu}=(0,B.YL)(),em=(0,K.useExperiment)("smoother_optimization").get("enabled",!1)||!1,ef=(0,i.useCallback)((e,t)=>{null==z||z.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[z]),ex=w?()=>{et(el),$(!0)}:void 0,eh=(0,i.useCallback)(()=>{0!==ee.length&&z&&(z.emit("edit",{message:ei,text:ee}),$(!1),et(""))},[ee,z,ei]),eg=(0,i.useCallback)(e=>null==j?void 0:j(e,ei.uuid),[j,ei.uuid]),{dispatchChatResource:ep}=(0,e7.i)(),{setIsDrawerExpanded:ev}=(0,e4.x)(),ej=(0,i.useMemo)(()=>void 0,[null==eu?void 0:eu.uuid,Z,ep,ev,ei.uuid]);(0,i.useMemo)(()=>void 0,[null==eu?void 0:eu.uuid,Z]),(0,i.useMemo)(()=>void 0,[null==eu?void 0:eu.uuid,Z]);let eb="human"===ei.sender,ey="assistant"===ei.sender,ew=null==(s=ei.content)?void 0:s.some(e=>"text"===e.type&&""!==e.text),e_=m&&q,ek=M||C||ei.attachments.length+en.length+((null==ei||null==(a=ei.sync_sources)?void 0:a.length)||0)>0,eN=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=G.sync_sources)?void 0:e.filter(e=>e.type===H.v8.GDRIVE).map(e=>e.config.uri))?t:[]},[G.sync_sources]),eM=(0,X.qL)(eN),eC=(0,i.useMemo)(()=>eM.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[eM]),eA="voice"===ei.input_mode||"speech_input"===ei.input_mode,eE=(0,K.useDynamicConfig)("claudeai_isp_thinking_ux");if(Q)return(0,n.jsx)(tu,{isStreaming:q,currentEdit:ee,setCurrentEdit:et,textAreaRef:es,finishEdit:eh,cancelEdit:()=>{$(!1),et("")},author:p,loggedInAccount:ec,message:ei,selectAttachment:g,showSharedImageMissing:M,showSharedFileMissing:C});let ez=function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:eY.l.Standard,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=s[t+1],d=(null==o?void 0:o.type)==="tool_result",c=0===t,u=!!s.length&&t===s.length-1-!!d;if("thinking"===e.type){var f;return(0,n.jsx)(e3,{index:t,text:e.thinking,cutOff:e.cut_off,startTimestamp:e.start_timestamp,stopTimestamp:e.stop_timestamp,isStreaming:e_&&!e.stop_timestamp,mostRecentSummary:null==(f=e.summaries)?void 0:f.at(-1),messageUuid:ei.uuid,onToggle:()=>{y&&y()},isFirstBlockOfMessage:c,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t)}if("tool_use"===e.type)return(0,n.jsx)(tc,{conversationUuid:Z,block:e,message:G,updatedMessage:ei,index:t,isShared:S,isStreaming:q,isLastMessage:m,publishedArtifacts:k,isFirstBlockOfMessage:c,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t);if("text"===e.type){if(0===t&&""===e.text)return;return(0,n.jsxs)(i.Fragment,{children:[e_&&em?(0,n.jsx)(D,{text:e.text,blockCitations:e.citations,hasLinkRef:eo,hasCodeRef:ed,isStreaming:q,onOpenArtifact:eg,isLastMessage:m,publishedArtifacts:void 0,onLinkClick:ej}):(0,n.jsx)(L.fP,{text:e.text,blockCitations:e.citations,hasLinkRef:eo,hasCodeRef:ed,isStreaming:q,onOpenArtifact:eg,isLastMessage:m,publishedArtifacts:k,onLinkClick:ej}),""]},"".concat(t,"-").concat(e_?"streaming":"static"))}};return(0,n.jsxs)("div",{ref:f?c:m?u:null,"data-test-render-count":ea.current,children:[eb&&(0,n.jsxs)("div",{className:"mb-1 mt-1",children:[ek&&(0,n.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[en.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e},t)),ei.attachments.map((e,t)=>(0,n.jsx)(h.NM,{size:"lg",file:e,onClick:()=>null==g?void 0:g(e)},t)),null==ei||null==(l=ei.sync_sources)?void 0:l.map(e=>(0,n.jsx)(eP.V,{uuid:e.uuid,syncSource:e},e.uuid)),M&&(0,n.jsx)(h.sv,{}),C&&!M&&(0,n.jsx)(h.lD,{})]}),(0,n.jsxs)(tx,{className:ew?"pr-6":"pr-[2.5px]",...q?tr:ti,children:[(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"shrink-0",children:S?(0,n.jsx)(W.e,{name:p||null,size:"sm"}):(0,n.jsx)(eD.J,{size:"sm"})}),(0,n.jsx)("div",{"data-testid":"user-message",className:(0,U.A)("font-ui grid grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6 tracking-tight",{italic:eA}),children:null==(r=ei.content)?void 0:r.map((e,t)=>"text"!==e.type?null:(0,n.jsx)(x,{text:e.text},t))})]}),(0,n.jsx)(T,{message:G,isLastMessage:m,hasLink:eo.current,hasDriveDocWithImages:eC,conversationSettings:_,messageWarningPropsFromParent:N}),(0,n.jsx)(eS,{isLastMessage:m,isInteractive:v,editMessage:ex,onRetry:ef,isResearchPending:R,isTemporary:E,...F})]})]}),ey&&(0,n.jsx)(n.Fragment,{children:ei.content&&ei.content[0]&&(0,n.jsx)(Y.P.div,{style:{height:"auto"},...q?to:ti,children:(0,n.jsxs)(th,{"data-is-streaming":e_,...q?tl:ti,className:m?"pb-3":"pb-8",children:[(0,n.jsx)(tg,{children:(()=>{let e=ei.content,t=[],s=Array(e.length).fill(!1);for(let a=0;a<e.length;a++){let i,l=e[a],r=[],o=!1;if(eE.get("timeline_enabled",!1)&&(0,e9.Ih)(l,eE)){if(r.push([l,a,(0,e9.h4)(l)]),s[a])continue;for(let t=a+1;t<e.length;t++){let s=e[t];if(!(0,e9.Ih)(s,eE))break;r.push([s,t,(0,e9.h4)(s)]),t===e.length-1&&(o=!0)}}if(eE.get("timeline_artifacts_enabled",!1)){let e=r.findLastIndex(e=>{let[t]=e;return"tool_use"===t.type&&"artifacts"===t.name});if(e>=0){r=r.slice(0,e);for(let e=0;e<r.length;e++){let t=r[e],s=t[0];"tool_use"===s.type&&"artifacts"===s.name&&(t[2]=!1)}}}let d=0;for(let[,,e]of r)e&&d++;d>1?(r.forEach(e=>{let[,t]=e;s[t]=!0}),i=(0,n.jsx)(e9.DT,{isFirstBlockOfMessage:0===a,isLastBlockOfMessage:o,isStreaming:q,children:r.map((t,s)=>{let[a,n,i]=t;if(i)return ez(a,n,e,eY.l.TimelineGroup,0===s,s===r.length-1)})},"group-".concat(a))):i=ez(l,a,e),t.push(i)}return t})()}),null==(o=ei.content)?void 0:o.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,n.jsx)(eO,{text:e.text,title:e.title},t)}),!q&&m&&(0,n.jsx)(eF,{previousMessage:O}),(0,n.jsx)(eS,{isLastMessage:m,isInteractive:v,isFirstAssistantMessage:A,onRetry:ef,isResearchPending:R,isTemporary:E,...F}),(0,n.jsx)(T,{message:G,isLastMessage:m,messageWarningPropsFromParent:N,conversationSettings:_,hasLink:eo.current,hasCode:ed.current,onRetry:ef,onSendContinue:I})]})})})]})}),tf=()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,n.jsx)(tx,{children:(0,n.jsx)("div",{className:(0,U.A)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})}),tx=(0,p.J)(Y.P.div)(ts()),th=(0,p.J)(Y.P.div)(ta()),tg=p.J.div(tn())}}]);